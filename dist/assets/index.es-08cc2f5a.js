import{g as Dc,a as ns,c as yr,b as re,d as H_,w as cf,r as uf,f as jc,t as xo,e as k_,h as wi,D as V_,k as B_,N as X,j as K_,i as vc,l as G_,V as W_,R as J_,F as Qh,K as Q_,x as Y_,L as X_,m as Yh,$ as Z_,p as e1,n as Xn,Z as Xh,J as t1,X as r1,_ as hf,o as Lr,q as i1,s as n1,u as hn,v as Lt,U as tr,y as mi,z as ur,A as s1,B as ln,C as lf,E as o1,G as a1,H as c1,I as ff,M as u1,O as pf,P as df,Q as pn,S as _c,T as yo,W as yn,Y as h1,a0 as vo,a1 as l1,a2 as f1,a3 as p1,a4 as lo,a5 as d1,a6 as g1,a7 as tc,a8 as Zh,a9 as y1,aa as v1,ab as _1,ac as el,ad as m1,ae as w1,af as b1,ag as E1,ah as x1,ai as I1,aj as S1,ak as P1,al as Wn,am as gf,an as rc,ao as O1,ap as R1,aq as C1}from"./index-d1400642.js";var qc={exports:{}},dn=typeof Reflect=="object"?Reflect:null,tl=dn&&typeof dn.apply=="function"?dn.apply:function(r,t,n){return Function.prototype.apply.call(r,t,n)},_o;dn&&typeof dn.ownKeys=="function"?_o=dn.ownKeys:Object.getOwnPropertySymbols?_o=function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:_o=function(r){return Object.getOwnPropertyNames(r)};function A1(o){console&&console.warn&&console.warn(o)}var yf=Number.isNaN||function(r){return r!==r};function He(){He.init.call(this)}qc.exports=He;qc.exports.once=L1;He.EventEmitter=He;He.prototype._events=void 0;He.prototype._eventsCount=0;He.prototype._maxListeners=void 0;var rl=10;function Io(o){if(typeof o!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof o)}Object.defineProperty(He,"defaultMaxListeners",{enumerable:!0,get:function(){return rl},set:function(o){if(typeof o!="number"||o<0||yf(o))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+o+".");rl=o}});He.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};He.prototype.setMaxListeners=function(r){if(typeof r!="number"||r<0||yf(r))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+r+".");return this._maxListeners=r,this};function vf(o){return o._maxListeners===void 0?He.defaultMaxListeners:o._maxListeners}He.prototype.getMaxListeners=function(){return vf(this)};He.prototype.emit=function(r){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var s=r==="error",c=this._events;if(c!==void 0)s=s&&c.error===void 0;else if(!s)return!1;if(s){var l;if(t.length>0&&(l=t[0]),l instanceof Error)throw l;var p=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw p.context=l,p}var _=c[r];if(_===void 0)return!1;if(typeof _=="function")tl(_,this,t);else for(var y=_.length,S=Ef(_,y),n=0;n<y;++n)tl(S[n],this,t);return!0};function _f(o,r,t,n){var s,c,l;if(Io(t),c=o._events,c===void 0?(c=o._events=Object.create(null),o._eventsCount=0):(c.newListener!==void 0&&(o.emit("newListener",r,t.listener?t.listener:t),c=o._events),l=c[r]),l===void 0)l=c[r]=t,++o._eventsCount;else if(typeof l=="function"?l=c[r]=n?[t,l]:[l,t]:n?l.unshift(t):l.push(t),s=vf(o),s>0&&l.length>s&&!l.warned){l.warned=!0;var p=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");p.name="MaxListenersExceededWarning",p.emitter=o,p.type=r,p.count=l.length,A1(p)}return o}He.prototype.addListener=function(r,t){return _f(this,r,t,!1)};He.prototype.on=He.prototype.addListener;He.prototype.prependListener=function(r,t){return _f(this,r,t,!0)};function T1(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function mf(o,r,t){var n={fired:!1,wrapFn:void 0,target:o,type:r,listener:t},s=T1.bind(n);return s.listener=t,n.wrapFn=s,s}He.prototype.once=function(r,t){return Io(t),this.on(r,mf(this,r,t)),this};He.prototype.prependOnceListener=function(r,t){return Io(t),this.prependListener(r,mf(this,r,t)),this};He.prototype.removeListener=function(r,t){var n,s,c,l,p;if(Io(t),s=this._events,s===void 0)return this;if(n=s[r],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete s[r],s.removeListener&&this.emit("removeListener",r,n.listener||t));else if(typeof n!="function"){for(c=-1,l=n.length-1;l>=0;l--)if(n[l]===t||n[l].listener===t){p=n[l].listener,c=l;break}if(c<0)return this;c===0?n.shift():N1(n,c),n.length===1&&(s[r]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",r,p||t)}return this};He.prototype.off=He.prototype.removeListener;He.prototype.removeAllListeners=function(r){var t,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[r]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[r]),this;if(arguments.length===0){var c=Object.keys(n),l;for(s=0;s<c.length;++s)l=c[s],l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[r],typeof t=="function")this.removeListener(r,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(r,t[s]);return this};function wf(o,r,t){var n=o._events;if(n===void 0)return[];var s=n[r];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?$1(s):Ef(s,s.length)}He.prototype.listeners=function(r){return wf(this,r,!0)};He.prototype.rawListeners=function(r){return wf(this,r,!1)};He.listenerCount=function(o,r){return typeof o.listenerCount=="function"?o.listenerCount(r):bf.call(o,r)};He.prototype.listenerCount=bf;function bf(o){var r=this._events;if(r!==void 0){var t=r[o];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}He.prototype.eventNames=function(){return this._eventsCount>0?_o(this._events):[]};function Ef(o,r){for(var t=new Array(r),n=0;n<r;++n)t[n]=o[n];return t}function N1(o,r){for(;r+1<o.length;r++)o[r]=o[r+1];o.pop()}function $1(o){for(var r=new Array(o.length),t=0;t<r.length;++t)r[t]=o[t].listener||o[t];return r}function L1(o,r){return new Promise(function(t,n){function s(l){o.removeListener(r,c),n(l)}function c(){typeof o.removeListener=="function"&&o.removeListener("error",s),t([].slice.call(arguments))}xf(o,r,c,{once:!0}),r!=="error"&&F1(o,s,{once:!0})})}function F1(o,r,t){typeof o.on=="function"&&xf(o,"error",r,t)}function xf(o,r,t,n){if(typeof o.on=="function")n.once?o.once(r,t):o.on(r,t);else if(typeof o.addEventListener=="function")o.addEventListener(r,function s(c){n.once&&o.removeEventListener(r,s),t(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof o)}var vr=qc.exports;const Mc=Dc(vr);var So={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var mc=function(o,r){return mc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])},mc(o,r)};function D1(o,r){mc(o,r);function t(){this.constructor=o}o.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}var wc=function(){return wc=Object.assign||function(r){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(r[c]=t[c])}return r},wc.apply(this,arguments)};function j1(o,r){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&r.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(o);s<n.length;s++)r.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(o,n[s])&&(t[n[s]]=o[n[s]]);return t}function q1(o,r,t,n){var s=arguments.length,c=s<3?r:n===null?n=Object.getOwnPropertyDescriptor(r,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,r,t,n);else for(var p=o.length-1;p>=0;p--)(l=o[p])&&(c=(s<3?l(c):s>3?l(r,t,c):l(r,t))||c);return s>3&&c&&Object.defineProperty(r,t,c),c}function M1(o,r){return function(t,n){r(t,n,o)}}function z1(o,r){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,r)}function U1(o,r,t,n){function s(c){return c instanceof t?c:new t(function(l){l(c)})}return new(t||(t=Promise))(function(c,l){function p(S){try{y(n.next(S))}catch(D){l(D)}}function _(S){try{y(n.throw(S))}catch(D){l(D)}}function y(S){S.done?c(S.value):s(S.value).then(p,_)}y((n=n.apply(o,r||[])).next())})}function H1(o,r){var t={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,s,c,l;return l={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function p(y){return function(S){return _([y,S])}}function _(y){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(c=y[0]&2?s.return:y[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,y[1])).done)return c;switch(s=0,c&&(y=[y[0]&2,c.value]),y[0]){case 0:case 1:c=y;break;case 4:return t.label++,{value:y[1],done:!1};case 5:t.label++,s=y[1],y=[0];continue;case 7:y=t.ops.pop(),t.trys.pop();continue;default:if(c=t.trys,!(c=c.length>0&&c[c.length-1])&&(y[0]===6||y[0]===2)){t=0;continue}if(y[0]===3&&(!c||y[1]>c[0]&&y[1]<c[3])){t.label=y[1];break}if(y[0]===6&&t.label<c[1]){t.label=c[1],c=y;break}if(c&&t.label<c[2]){t.label=c[2],t.ops.push(y);break}c[2]&&t.ops.pop(),t.trys.pop();continue}y=r.call(o,t)}catch(S){y=[6,S],s=0}finally{n=c=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function k1(o,r,t,n){n===void 0&&(n=t),o[n]=r[t]}function V1(o,r){for(var t in o)t!=="default"&&!r.hasOwnProperty(t)&&(r[t]=o[t])}function bc(o){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&o[r],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function If(o,r){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var n=t.call(o),s,c=[],l;try{for(;(r===void 0||r-- >0)&&!(s=n.next()).done;)c.push(s.value)}catch(p){l={error:p}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(l)throw l.error}}return c}function B1(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(If(arguments[r]));return o}function K1(){for(var o=0,r=0,t=arguments.length;r<t;r++)o+=arguments[r].length;for(var n=Array(o),s=0,r=0;r<t;r++)for(var c=arguments[r],l=0,p=c.length;l<p;l++,s++)n[s]=c[l];return n}function Zn(o){return this instanceof Zn?(this.v=o,this):new Zn(o)}function G1(o,r,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,r||[]),s,c=[];return s={},l("next"),l("throw"),l("return"),s[Symbol.asyncIterator]=function(){return this},s;function l(O){n[O]&&(s[O]=function(M){return new Promise(function(U,V){c.push([O,M,U,V])>1||p(O,M)})})}function p(O,M){try{_(n[O](M))}catch(U){D(c[0][3],U)}}function _(O){O.value instanceof Zn?Promise.resolve(O.value.v).then(y,S):D(c[0][2],O)}function y(O){p("next",O)}function S(O){p("throw",O)}function D(O,M){O(M),c.shift(),c.length&&p(c[0][0],c[0][1])}}function W1(o){var r,t;return r={},n("next"),n("throw",function(s){throw s}),n("return"),r[Symbol.iterator]=function(){return this},r;function n(s,c){r[s]=o[s]?function(l){return(t=!t)?{value:Zn(o[s](l)),done:s==="return"}:c?c(l):l}:c}}function J1(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=o[Symbol.asyncIterator],t;return r?r.call(o):(o=typeof bc=="function"?bc(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(c){t[c]=o[c]&&function(l){return new Promise(function(p,_){l=o[c](l),s(p,_,l.done,l.value)})}}function s(c,l,p,_){Promise.resolve(_).then(function(y){c({value:y,done:p})},l)}}function Q1(o,r){return Object.defineProperty?Object.defineProperty(o,"raw",{value:r}):o.raw=r,o}function Y1(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var t in o)Object.hasOwnProperty.call(o,t)&&(r[t]=o[t]);return r.default=o,r}function X1(o){return o&&o.__esModule?o:{default:o}}function Z1(o,r){if(!r.has(o))throw new TypeError("attempted to get private field on non-instance");return r.get(o)}function em(o,r,t){if(!r.has(o))throw new TypeError("attempted to set private field on non-instance");return r.set(o,t),t}const tm=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return wc},__asyncDelegator:W1,__asyncGenerator:G1,__asyncValues:J1,__await:Zn,__awaiter:U1,__classPrivateFieldGet:Z1,__classPrivateFieldSet:em,__createBinding:k1,__decorate:q1,__exportStar:V1,__extends:D1,__generator:H1,__importDefault:X1,__importStar:Y1,__makeTemplateObject:Q1,__metadata:z1,__param:M1,__read:If,__rest:j1,__spread:B1,__spreadArrays:K1,__values:bc},Symbol.toStringTag,{value:"Module"})),Sf=ns(tm);var ss={};Object.defineProperty(ss,"__esModule",{value:!0});function rm(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return JSON.parse(o)}catch{return o}}ss.safeJsonParse=rm;function im(o){return typeof o=="string"?o:JSON.stringify(o,(r,t)=>typeof t>"u"?null:t)}ss.safeJsonStringify=im;var qn={exports:{}},il;function nm(){return il||(il=1,function(){let o;function r(){}o=r,o.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},o.prototype.setItem=function(t,n){this[t]=String(n)},o.prototype.removeItem=function(t){delete this[t]},o.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(n){t[n]=void 0,delete t[n]})},o.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof yr<"u"&&yr.localStorage?qn.exports=yr.localStorage:typeof window<"u"&&window.localStorage?qn.exports=window.localStorage:qn.exports=new r}()),qn.exports}var ic={},Mn={},nl;function sm(){if(nl)return Mn;nl=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.IKeyValueStorage=void 0;class o{}return Mn.IKeyValueStorage=o,Mn}var zn={},sl;function om(){if(sl)return zn;sl=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.parseEntry=void 0;const o=ss;function r(t){var n;return[t[0],o.safeJsonParse((n=t[1])!==null&&n!==void 0?n:"")]}return zn.parseEntry=r,zn}var ol;function am(){return ol||(ol=1,function(o){Object.defineProperty(o,"__esModule",{value:!0});const r=Sf;r.__exportStar(sm(),o),r.__exportStar(om(),o)}(ic)),ic}Object.defineProperty(So,"__esModule",{value:!0});So.KeyValueStorage=void 0;const fn=Sf,al=ss,cm=fn.__importDefault(nm()),um=am();class Pf{constructor(){this.localStorage=cm.default}getKeys(){return fn.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return fn.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(um.parseEntry)})}getItem(r){return fn.__awaiter(this,void 0,void 0,function*(){const t=this.localStorage.getItem(r);if(t!==null)return al.safeJsonParse(t)})}setItem(r,t){return fn.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(r,al.safeJsonStringify(t))})}removeItem(r){return fn.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(r)})}}So.KeyValueStorage=Pf;var hm=So.default=Pf,vn={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ec=function(o,r){return Ec=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])},Ec(o,r)};function lm(o,r){Ec(o,r);function t(){this.constructor=o}o.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}var xc=function(){return xc=Object.assign||function(r){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(r[c]=t[c])}return r},xc.apply(this,arguments)};function fm(o,r){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&r.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(o);s<n.length;s++)r.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(o,n[s])&&(t[n[s]]=o[n[s]]);return t}function pm(o,r,t,n){var s=arguments.length,c=s<3?r:n===null?n=Object.getOwnPropertyDescriptor(r,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,r,t,n);else for(var p=o.length-1;p>=0;p--)(l=o[p])&&(c=(s<3?l(c):s>3?l(r,t,c):l(r,t))||c);return s>3&&c&&Object.defineProperty(r,t,c),c}function dm(o,r){return function(t,n){r(t,n,o)}}function gm(o,r){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,r)}function ym(o,r,t,n){function s(c){return c instanceof t?c:new t(function(l){l(c)})}return new(t||(t=Promise))(function(c,l){function p(S){try{y(n.next(S))}catch(D){l(D)}}function _(S){try{y(n.throw(S))}catch(D){l(D)}}function y(S){S.done?c(S.value):s(S.value).then(p,_)}y((n=n.apply(o,r||[])).next())})}function vm(o,r){var t={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,s,c,l;return l={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function p(y){return function(S){return _([y,S])}}function _(y){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(c=y[0]&2?s.return:y[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,y[1])).done)return c;switch(s=0,c&&(y=[y[0]&2,c.value]),y[0]){case 0:case 1:c=y;break;case 4:return t.label++,{value:y[1],done:!1};case 5:t.label++,s=y[1],y=[0];continue;case 7:y=t.ops.pop(),t.trys.pop();continue;default:if(c=t.trys,!(c=c.length>0&&c[c.length-1])&&(y[0]===6||y[0]===2)){t=0;continue}if(y[0]===3&&(!c||y[1]>c[0]&&y[1]<c[3])){t.label=y[1];break}if(y[0]===6&&t.label<c[1]){t.label=c[1],c=y;break}if(c&&t.label<c[2]){t.label=c[2],t.ops.push(y);break}c[2]&&t.ops.pop(),t.trys.pop();continue}y=r.call(o,t)}catch(S){y=[6,S],s=0}finally{n=c=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function _m(o,r,t,n){n===void 0&&(n=t),o[n]=r[t]}function mm(o,r){for(var t in o)t!=="default"&&!r.hasOwnProperty(t)&&(r[t]=o[t])}function Ic(o){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&o[r],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function Of(o,r){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var n=t.call(o),s,c=[],l;try{for(;(r===void 0||r-- >0)&&!(s=n.next()).done;)c.push(s.value)}catch(p){l={error:p}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(l)throw l.error}}return c}function wm(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(Of(arguments[r]));return o}function bm(){for(var o=0,r=0,t=arguments.length;r<t;r++)o+=arguments[r].length;for(var n=Array(o),s=0,r=0;r<t;r++)for(var c=arguments[r],l=0,p=c.length;l<p;l++,s++)n[s]=c[l];return n}function es(o){return this instanceof es?(this.v=o,this):new es(o)}function Em(o,r,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,r||[]),s,c=[];return s={},l("next"),l("throw"),l("return"),s[Symbol.asyncIterator]=function(){return this},s;function l(O){n[O]&&(s[O]=function(M){return new Promise(function(U,V){c.push([O,M,U,V])>1||p(O,M)})})}function p(O,M){try{_(n[O](M))}catch(U){D(c[0][3],U)}}function _(O){O.value instanceof es?Promise.resolve(O.value.v).then(y,S):D(c[0][2],O)}function y(O){p("next",O)}function S(O){p("throw",O)}function D(O,M){O(M),c.shift(),c.length&&p(c[0][0],c[0][1])}}function xm(o){var r,t;return r={},n("next"),n("throw",function(s){throw s}),n("return"),r[Symbol.iterator]=function(){return this},r;function n(s,c){r[s]=o[s]?function(l){return(t=!t)?{value:es(o[s](l)),done:s==="return"}:c?c(l):l}:c}}function Im(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=o[Symbol.asyncIterator],t;return r?r.call(o):(o=typeof Ic=="function"?Ic(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(c){t[c]=o[c]&&function(l){return new Promise(function(p,_){l=o[c](l),s(p,_,l.done,l.value)})}}function s(c,l,p,_){Promise.resolve(_).then(function(y){c({value:y,done:p})},l)}}function Sm(o,r){return Object.defineProperty?Object.defineProperty(o,"raw",{value:r}):o.raw=r,o}function Pm(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var t in o)Object.hasOwnProperty.call(o,t)&&(r[t]=o[t]);return r.default=o,r}function Om(o){return o&&o.__esModule?o:{default:o}}function Rm(o,r){if(!r.has(o))throw new TypeError("attempted to get private field on non-instance");return r.get(o)}function Cm(o,r,t){if(!r.has(o))throw new TypeError("attempted to set private field on non-instance");return r.set(o,t),t}const Am=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return xc},__asyncDelegator:xm,__asyncGenerator:Em,__asyncValues:Im,__await:es,__awaiter:ym,__classPrivateFieldGet:Rm,__classPrivateFieldSet:Cm,__createBinding:_m,__decorate:pm,__exportStar:mm,__extends:lm,__generator:vm,__importDefault:Om,__importStar:Pm,__makeTemplateObject:Sm,__metadata:gm,__param:dm,__read:Of,__rest:fm,__spread:wm,__spreadArrays:bm,__values:Ic},Symbol.toStringTag,{value:"Module"})),Po=ns(Am);var Un={},nc={},Hn={};let zi=class{};const Tm=Object.freeze(Object.defineProperty({__proto__:null,IEvents:zi},Symbol.toStringTag,{value:"Module"})),Nm=ns(Tm);var cl;function $m(){if(cl)return Hn;cl=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.IHeartBeat=void 0;const o=Nm;class r extends o.IEvents{constructor(n){super()}}return Hn.IHeartBeat=r,Hn}var ul;function Rf(){return ul||(ul=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Po.__exportStar($m(),o)}(nc)),nc}var sc={},qi={},hl;function Lm(){if(hl)return qi;hl=1,Object.defineProperty(qi,"__esModule",{value:!0}),qi.HEARTBEAT_EVENTS=qi.HEARTBEAT_INTERVAL=void 0;const o=re;return qi.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,qi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},qi}var ll;function Cf(){return ll||(ll=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Po.__exportStar(Lm(),o)}(sc)),sc}var fl;function Fm(){if(fl)return Un;fl=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.HeartBeat=void 0;const o=Po,r=vr,t=re,n=Rf(),s=Cf();class c extends n.IHeartBeat{constructor(p){super(p),this.events=new r.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(p==null?void 0:p.interval)||s.HEARTBEAT_INTERVAL}static init(p){return o.__awaiter(this,void 0,void 0,function*(){const _=new c(p);return yield _.init(),_})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(p,_){this.events.on(p,_)}once(p,_){this.events.once(p,_)}off(p,_){this.events.off(p,_)}removeListener(p,_){this.events.removeListener(p,_)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return Un.HeartBeat=c,Un}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const r=Po;r.__exportStar(Fm(),o),r.__exportStar(Rf(),o),r.__exportStar(Cf(),o)})(vn);var Re={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Sc=function(o,r){return Sc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])},Sc(o,r)};function Dm(o,r){Sc(o,r);function t(){this.constructor=o}o.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}var Pc=function(){return Pc=Object.assign||function(r){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(r[c]=t[c])}return r},Pc.apply(this,arguments)};function jm(o,r){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&r.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(o);s<n.length;s++)r.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(o,n[s])&&(t[n[s]]=o[n[s]]);return t}function qm(o,r,t,n){var s=arguments.length,c=s<3?r:n===null?n=Object.getOwnPropertyDescriptor(r,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,r,t,n);else for(var p=o.length-1;p>=0;p--)(l=o[p])&&(c=(s<3?l(c):s>3?l(r,t,c):l(r,t))||c);return s>3&&c&&Object.defineProperty(r,t,c),c}function Mm(o,r){return function(t,n){r(t,n,o)}}function zm(o,r){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,r)}function Um(o,r,t,n){function s(c){return c instanceof t?c:new t(function(l){l(c)})}return new(t||(t=Promise))(function(c,l){function p(S){try{y(n.next(S))}catch(D){l(D)}}function _(S){try{y(n.throw(S))}catch(D){l(D)}}function y(S){S.done?c(S.value):s(S.value).then(p,_)}y((n=n.apply(o,r||[])).next())})}function Hm(o,r){var t={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,s,c,l;return l={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function p(y){return function(S){return _([y,S])}}function _(y){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(c=y[0]&2?s.return:y[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,y[1])).done)return c;switch(s=0,c&&(y=[y[0]&2,c.value]),y[0]){case 0:case 1:c=y;break;case 4:return t.label++,{value:y[1],done:!1};case 5:t.label++,s=y[1],y=[0];continue;case 7:y=t.ops.pop(),t.trys.pop();continue;default:if(c=t.trys,!(c=c.length>0&&c[c.length-1])&&(y[0]===6||y[0]===2)){t=0;continue}if(y[0]===3&&(!c||y[1]>c[0]&&y[1]<c[3])){t.label=y[1];break}if(y[0]===6&&t.label<c[1]){t.label=c[1],c=y;break}if(c&&t.label<c[2]){t.label=c[2],t.ops.push(y);break}c[2]&&t.ops.pop(),t.trys.pop();continue}y=r.call(o,t)}catch(S){y=[6,S],s=0}finally{n=c=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function km(o,r,t,n){n===void 0&&(n=t),o[n]=r[t]}function Vm(o,r){for(var t in o)t!=="default"&&!r.hasOwnProperty(t)&&(r[t]=o[t])}function Oc(o){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&o[r],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function Af(o,r){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var n=t.call(o),s,c=[],l;try{for(;(r===void 0||r-- >0)&&!(s=n.next()).done;)c.push(s.value)}catch(p){l={error:p}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(l)throw l.error}}return c}function Bm(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(Af(arguments[r]));return o}function Km(){for(var o=0,r=0,t=arguments.length;r<t;r++)o+=arguments[r].length;for(var n=Array(o),s=0,r=0;r<t;r++)for(var c=arguments[r],l=0,p=c.length;l<p;l++,s++)n[s]=c[l];return n}function ts(o){return this instanceof ts?(this.v=o,this):new ts(o)}function Gm(o,r,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,r||[]),s,c=[];return s={},l("next"),l("throw"),l("return"),s[Symbol.asyncIterator]=function(){return this},s;function l(O){n[O]&&(s[O]=function(M){return new Promise(function(U,V){c.push([O,M,U,V])>1||p(O,M)})})}function p(O,M){try{_(n[O](M))}catch(U){D(c[0][3],U)}}function _(O){O.value instanceof ts?Promise.resolve(O.value.v).then(y,S):D(c[0][2],O)}function y(O){p("next",O)}function S(O){p("throw",O)}function D(O,M){O(M),c.shift(),c.length&&p(c[0][0],c[0][1])}}function Wm(o){var r,t;return r={},n("next"),n("throw",function(s){throw s}),n("return"),r[Symbol.iterator]=function(){return this},r;function n(s,c){r[s]=o[s]?function(l){return(t=!t)?{value:ts(o[s](l)),done:s==="return"}:c?c(l):l}:c}}function Jm(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=o[Symbol.asyncIterator],t;return r?r.call(o):(o=typeof Oc=="function"?Oc(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(c){t[c]=o[c]&&function(l){return new Promise(function(p,_){l=o[c](l),s(p,_,l.done,l.value)})}}function s(c,l,p,_){Promise.resolve(_).then(function(y){c({value:y,done:p})},l)}}function Qm(o,r){return Object.defineProperty?Object.defineProperty(o,"raw",{value:r}):o.raw=r,o}function Ym(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var t in o)Object.hasOwnProperty.call(o,t)&&(r[t]=o[t]);return r.default=o,r}function Xm(o){return o&&o.__esModule?o:{default:o}}function Zm(o,r){if(!r.has(o))throw new TypeError("attempted to get private field on non-instance");return r.get(o)}function ew(o,r,t){if(!r.has(o))throw new TypeError("attempted to set private field on non-instance");return r.set(o,t),t}const tw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Pc},__asyncDelegator:Wm,__asyncGenerator:Gm,__asyncValues:Jm,__await:ts,__awaiter:Um,__classPrivateFieldGet:Zm,__classPrivateFieldSet:ew,__createBinding:km,__decorate:qm,__exportStar:Vm,__extends:Dm,__generator:Hm,__importDefault:Xm,__importStar:Ym,__makeTemplateObject:Qm,__metadata:zm,__param:Mm,__read:Af,__rest:jm,__spread:Bm,__spreadArrays:Km,__values:Oc},Symbol.toStringTag,{value:"Module"})),rw=ns(tw);var oc,pl;function iw(){if(pl)return oc;pl=1;function o(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}oc=r;function r(t,n,s){var c=s&&s.stringify||o,l=1;if(typeof t=="object"&&t!==null){var p=n.length+l;if(p===1)return t;var _=new Array(p);_[0]=c(t);for(var y=1;y<p;y++)_[y]=c(n[y]);return _.join(" ")}if(typeof t!="string")return t;var S=n.length;if(S===0)return t;for(var D="",O=1-l,M=-1,U=t&&t.length||0,V=0;V<U;){if(t.charCodeAt(V)===37&&V+1<U){switch(M=M>-1?M:0,t.charCodeAt(V+1)){case 100:case 102:if(O>=S||n[O]==null)break;M<V&&(D+=t.slice(M,V)),D+=Number(n[O]),M=V+2,V++;break;case 105:if(O>=S||n[O]==null)break;M<V&&(D+=t.slice(M,V)),D+=Math.floor(Number(n[O])),M=V+2,V++;break;case 79:case 111:case 106:if(O>=S||n[O]===void 0)break;M<V&&(D+=t.slice(M,V));var oe=typeof n[O];if(oe==="string"){D+="'"+n[O]+"'",M=V+2,V++;break}if(oe==="function"){D+=n[O].name||"<anonymous>",M=V+2,V++;break}D+=c(n[O]),M=V+2,V++;break;case 115:if(O>=S)break;M<V&&(D+=t.slice(M,V)),D+=String(n[O]),M=V+2,V++;break;case 37:M<V&&(D+=t.slice(M,V)),D+="%",M=V+2,V++,O--;break}++O}++V}return M===-1?t:(M<U&&(D+=t.slice(M)),D)}return oc}var ac,dl;function nw(){if(dl)return ac;dl=1;const o=iw();ac=s;const r=he().console||{},t={mapHttpRequest:U,mapHttpResponse:U,wrapRequestSerializer:V,wrapResponseSerializer:V,wrapErrorSerializer:V,req:U,res:U,err:O};function n(N,H){return Array.isArray(N)?N.filter(function(ge){return ge!=="!stdSerializers.err"}):N===!0?Object.keys(H):!1}function s(N){N=N||{},N.browser=N.browser||{};const H=N.browser.transmit;if(H&&typeof H.send!="function")throw Error("pino: transmit option must have a send function");const W=N.browser.write||r;N.browser.write&&(N.browser.asObject=!0);const ge=N.serializers||{},te=n(N.browser.serialize,ge);let Ee=N.browser.serialize;Array.isArray(N.browser.serialize)&&N.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Ce=["error","fatal","warn","info","debug","trace"];typeof W=="function"&&(W.error=W.fatal=W.warn=W.info=W.debug=W.trace=W),N.enabled===!1&&(N.level="silent");const tt=N.level||"info",C=Object.create(W);C.log||(C.log=oe),Object.defineProperty(C,"levelVal",{get:Me}),Object.defineProperty(C,"level",{get:Ae,set:J});const j={transmit:H,serialize:te,asObject:N.browser.asObject,levels:Ce,timestamp:M(N)};C.levels=s.levels,C.level=tt,C.setMaxListeners=C.getMaxListeners=C.emit=C.addListener=C.on=C.prependListener=C.once=C.prependOnceListener=C.removeListener=C.removeAllListeners=C.listeners=C.listenerCount=C.eventNames=C.write=C.flush=oe,C.serializers=ge,C._serialize=te,C._stdErrSerialize=Ee,C.child=B,H&&(C._logEvent=D());function Me(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Ae(){return this._level}function J(k){if(k!=="silent"&&!this.levels.values[k])throw Error("unknown level "+k);this._level=k,c(j,C,"error","log"),c(j,C,"fatal","error"),c(j,C,"warn","error"),c(j,C,"info","log"),c(j,C,"debug","log"),c(j,C,"trace","log")}function B(k,K){if(!k)throw new Error("missing bindings for child Pino");K=K||{},te&&k.serializers&&(K.serializers=k.serializers);const ut=K.serializers;if(te&&ut){var ke=Object.assign({},ge,ut),Dr=N.browser.serialize===!0?Object.keys(ke):te;delete k.serializers,_([k],Dr,ke,this._stdErrSerialize)}function me(It){this._childLevel=(It._childLevel|0)+1,this.error=y(It,k,"error"),this.fatal=y(It,k,"fatal"),this.warn=y(It,k,"warn"),this.info=y(It,k,"info"),this.debug=y(It,k,"debug"),this.trace=y(It,k,"trace"),ke&&(this.serializers=ke,this._serialize=Dr),H&&(this._logEvent=D([].concat(It._logEvent.bindings,k)))}return me.prototype=this,new me(this)}return C}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=t,s.stdTimeFunctions=Object.assign({},{nullTime:be,epochTime:de,unixTime:pe,isoTime:ue});function c(N,H,W,ge){const te=Object.getPrototypeOf(H);H[W]=H.levelVal>H.levels.values[W]?oe:te[W]?te[W]:r[W]||r[ge]||oe,l(N,H,W)}function l(N,H,W){!N.transmit&&H[W]===oe||(H[W]=function(ge){return function(){const Ee=N.timestamp(),Ce=new Array(arguments.length),tt=Object.getPrototypeOf&&Object.getPrototypeOf(this)===r?r:this;for(var C=0;C<Ce.length;C++)Ce[C]=arguments[C];if(N.serialize&&!N.asObject&&_(Ce,this._serialize,this.serializers,this._stdErrSerialize),N.asObject?ge.call(tt,p(this,W,Ce,Ee)):ge.apply(tt,Ce),N.transmit){const j=N.transmit.level||H.level,Me=s.levels.values[j],Ae=s.levels.values[W];if(Ae<Me)return;S(this,{ts:Ee,methodLevel:W,methodValue:Ae,transmitLevel:j,transmitValue:s.levels.values[N.transmit.level||H.level],send:N.transmit.send,val:H.levelVal},Ce)}}}(H[W]))}function p(N,H,W,ge){N._serialize&&_(W,N._serialize,N.serializers,N._stdErrSerialize);const te=W.slice();let Ee=te[0];const Ce={};ge&&(Ce.time=ge),Ce.level=s.levels.values[H];let tt=(N._childLevel|0)+1;if(tt<1&&(tt=1),Ee!==null&&typeof Ee=="object"){for(;tt--&&typeof te[0]=="object";)Object.assign(Ce,te.shift());Ee=te.length?o(te.shift(),te):void 0}else typeof Ee=="string"&&(Ee=o(te.shift(),te));return Ee!==void 0&&(Ce.msg=Ee),Ce}function _(N,H,W,ge){for(const te in N)if(ge&&N[te]instanceof Error)N[te]=s.stdSerializers.err(N[te]);else if(typeof N[te]=="object"&&!Array.isArray(N[te]))for(const Ee in N[te])H&&H.indexOf(Ee)>-1&&Ee in W&&(N[te][Ee]=W[Ee](N[te][Ee]))}function y(N,H,W){return function(){const ge=new Array(1+arguments.length);ge[0]=H;for(var te=1;te<ge.length;te++)ge[te]=arguments[te-1];return N[W].apply(this,ge)}}function S(N,H,W){const ge=H.send,te=H.ts,Ee=H.methodLevel,Ce=H.methodValue,tt=H.val,C=N._logEvent.bindings;_(W,N._serialize||Object.keys(N.serializers),N.serializers,N._stdErrSerialize===void 0?!0:N._stdErrSerialize),N._logEvent.ts=te,N._logEvent.messages=W.filter(function(j){return C.indexOf(j)===-1}),N._logEvent.level.label=Ee,N._logEvent.level.value=Ce,ge(Ee,N._logEvent,tt),N._logEvent=D(C)}function D(N){return{ts:0,messages:[],bindings:N||[],level:{label:"",value:0}}}function O(N){const H={type:N.constructor.name,msg:N.message,stack:N.stack};for(const W in N)H[W]===void 0&&(H[W]=N[W]);return H}function M(N){return typeof N.timestamp=="function"?N.timestamp:N.timestamp===!1?be:de}function U(){return{}}function V(N){return N}function oe(){}function be(){return!1}function de(){return Date.now()}function pe(){return Math.round(Date.now()/1e3)}function ue(){return new Date(Date.now()).toISOString()}function he(){function N(H){return typeof H<"u"&&H}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return N(self)||N(window)||N(this)||{}}}return ac}var Mi={},gl;function Tf(){return gl||(gl=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.PINO_CUSTOM_CONTEXT_KEY=Mi.PINO_LOGGER_DEFAULTS=void 0,Mi.PINO_LOGGER_DEFAULTS={level:"info"},Mi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Mi}var er={},yl;function sw(){if(yl)return er;yl=1,Object.defineProperty(er,"__esModule",{value:!0}),er.generateChildLogger=er.formatChildLoggerContext=er.getLoggerContext=er.setBrowserLoggerContext=er.getBrowserLoggerContext=er.getDefaultLoggerOptions=void 0;const o=Tf();function r(p){return Object.assign(Object.assign({},p),{level:(p==null?void 0:p.level)||o.PINO_LOGGER_DEFAULTS.level})}er.getDefaultLoggerOptions=r;function t(p,_=o.PINO_CUSTOM_CONTEXT_KEY){return p[_]||""}er.getBrowserLoggerContext=t;function n(p,_,y=o.PINO_CUSTOM_CONTEXT_KEY){return p[y]=_,p}er.setBrowserLoggerContext=n;function s(p,_=o.PINO_CUSTOM_CONTEXT_KEY){let y="";return typeof p.bindings>"u"?y=t(p,_):y=p.bindings().context||"",y}er.getLoggerContext=s;function c(p,_,y=o.PINO_CUSTOM_CONTEXT_KEY){const S=s(p,y);return S.trim()?`${S}/${_}`:_}er.formatChildLoggerContext=c;function l(p,_,y=o.PINO_CUSTOM_CONTEXT_KEY){const S=c(p,_,y),D=p.child({context:S});return n(D,S,y)}return er.generateChildLogger=l,er}(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.pino=void 0;const r=rw,t=r.__importDefault(nw());Object.defineProperty(o,"pino",{enumerable:!0,get:function(){return t.default}}),r.__exportStar(Tf(),o),r.__exportStar(sw(),o)})(Re);class ow extends zi{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}class aw extends zi{constructor(r,t){super(),this.core=r,this.logger=t,this.records=new Map}}class cw{constructor(r,t){this.logger=r,this.core=t}}let uw=class extends zi{constructor(r,t){super(),this.relayer=r,this.logger=t}},hw=class extends zi{constructor(r){super()}},lw=class{constructor(r,t,n,s){this.core=r,this.logger=t,this.name=n}};class fw extends zi{constructor(r,t){super(),this.relayer=r,this.logger=t}}let pw=class extends zi{constructor(r,t){super(),this.core=r,this.logger=t}},dw=class{constructor(r,t){this.projectId=r,this.logger=t}},gw=class{constructor(r){this.opts=r,this.protocol="wc",this.version=2}},yw=class{constructor(r){this.client=r}};const vw=o=>JSON.stringify(o,(r,t)=>typeof t=="bigint"?t.toString()+"n":t),_w=o=>{const r=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=o.replace(r,'$1"$2n"$3');return JSON.parse(t,(n,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function zc(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return _w(o)}catch{return o}}function rs(o){return typeof o=="string"?o:vw(o)||""}var Uc={},Nf={};(function(o){Object.defineProperty(o,"__esModule",{value:!0});var r=H_,t=cf;o.DIGEST_LENGTH=64,o.BLOCK_SIZE=128;var n=function(){function p(){this.digestLength=o.DIGEST_LENGTH,this.blockSize=o.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return p.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},p.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},p.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},p.prototype.update=function(_,y){if(y===void 0&&(y=_.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var S=0;if(this._bytesHashed+=y,this._bufferLength>0){for(;this._bufferLength<o.BLOCK_SIZE&&y>0;)this._buffer[this._bufferLength++]=_[S++],y--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(y>=this.blockSize&&(S=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,_,S,y),y%=this.blockSize);y>0;)this._buffer[this._bufferLength++]=_[S++],y--;return this},p.prototype.finish=function(_){if(!this._finished){var y=this._bytesHashed,S=this._bufferLength,D=y/536870912|0,O=y<<3,M=y%128<112?128:256;this._buffer[S]=128;for(var U=S+1;U<M-8;U++)this._buffer[U]=0;r.writeUint32BE(D,this._buffer,M-8),r.writeUint32BE(O,this._buffer,M-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,M),this._finished=!0}for(var U=0;U<this.digestLength/8;U++)r.writeUint32BE(this._stateHi[U],_,U*8),r.writeUint32BE(this._stateLo[U],_,U*8+4);return this},p.prototype.digest=function(){var _=new Uint8Array(this.digestLength);return this.finish(_),_},p.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},p.prototype.restoreState=function(_){return this._stateHi.set(_.stateHi),this._stateLo.set(_.stateLo),this._bufferLength=_.bufferLength,_.buffer&&this._buffer.set(_.buffer),this._bytesHashed=_.bytesHashed,this._finished=!1,this},p.prototype.cleanSavedState=function(_){t.wipe(_.stateHi),t.wipe(_.stateLo),_.buffer&&t.wipe(_.buffer),_.bufferLength=0,_.bytesHashed=0},p}();o.SHA512=n;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(p,_,y,S,D,O,M){for(var U=y[0],V=y[1],oe=y[2],be=y[3],de=y[4],pe=y[5],ue=y[6],he=y[7],N=S[0],H=S[1],W=S[2],ge=S[3],te=S[4],Ee=S[5],Ce=S[6],tt=S[7],C,j,Me,Ae,J,B,k,K;M>=128;){for(var ut=0;ut<16;ut++){var ke=8*ut+O;p[ut]=r.readUint32BE(D,ke),_[ut]=r.readUint32BE(D,ke+4)}for(var ut=0;ut<80;ut++){var Dr=U,me=V,It=oe,T=be,A=de,P=pe,h=ue,b=he,Z=N,ae=H,ve=W,Te=ge,$e=te,Ie=Ee,St=Ce,_t=tt;if(C=he,j=tt,J=j&65535,B=j>>>16,k=C&65535,K=C>>>16,C=(de>>>14|te<<32-14)^(de>>>18|te<<32-18)^(te>>>41-32|de<<32-(41-32)),j=(te>>>14|de<<32-14)^(te>>>18|de<<32-18)^(de>>>41-32|te<<32-(41-32)),J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,C=de&pe^~de&ue,j=te&Ee^~te&Ce,J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,C=s[ut*2],j=s[ut*2+1],J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,C=p[ut%16],j=_[ut%16],J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,B+=J>>>16,k+=B>>>16,K+=k>>>16,Me=k&65535|K<<16,Ae=J&65535|B<<16,C=Me,j=Ae,J=j&65535,B=j>>>16,k=C&65535,K=C>>>16,C=(U>>>28|N<<32-28)^(N>>>34-32|U<<32-(34-32))^(N>>>39-32|U<<32-(39-32)),j=(N>>>28|U<<32-28)^(U>>>34-32|N<<32-(34-32))^(U>>>39-32|N<<32-(39-32)),J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,C=U&V^U&oe^V&oe,j=N&H^N&W^H&W,J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,B+=J>>>16,k+=B>>>16,K+=k>>>16,b=k&65535|K<<16,_t=J&65535|B<<16,C=T,j=Te,J=j&65535,B=j>>>16,k=C&65535,K=C>>>16,C=Me,j=Ae,J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,B+=J>>>16,k+=B>>>16,K+=k>>>16,T=k&65535|K<<16,Te=J&65535|B<<16,V=Dr,oe=me,be=It,de=T,pe=A,ue=P,he=h,U=b,H=Z,W=ae,ge=ve,te=Te,Ee=$e,Ce=Ie,tt=St,N=_t,ut%16===15)for(var ke=0;ke<16;ke++)C=p[ke],j=_[ke],J=j&65535,B=j>>>16,k=C&65535,K=C>>>16,C=p[(ke+9)%16],j=_[(ke+9)%16],J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,Me=p[(ke+1)%16],Ae=_[(ke+1)%16],C=(Me>>>1|Ae<<32-1)^(Me>>>8|Ae<<32-8)^Me>>>7,j=(Ae>>>1|Me<<32-1)^(Ae>>>8|Me<<32-8)^(Ae>>>7|Me<<32-7),J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,Me=p[(ke+14)%16],Ae=_[(ke+14)%16],C=(Me>>>19|Ae<<32-19)^(Ae>>>61-32|Me<<32-(61-32))^Me>>>6,j=(Ae>>>19|Me<<32-19)^(Me>>>61-32|Ae<<32-(61-32))^(Ae>>>6|Me<<32-6),J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,B+=J>>>16,k+=B>>>16,K+=k>>>16,p[ke]=k&65535|K<<16,_[ke]=J&65535|B<<16}C=U,j=N,J=j&65535,B=j>>>16,k=C&65535,K=C>>>16,C=y[0],j=S[0],J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,B+=J>>>16,k+=B>>>16,K+=k>>>16,y[0]=U=k&65535|K<<16,S[0]=N=J&65535|B<<16,C=V,j=H,J=j&65535,B=j>>>16,k=C&65535,K=C>>>16,C=y[1],j=S[1],J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,B+=J>>>16,k+=B>>>16,K+=k>>>16,y[1]=V=k&65535|K<<16,S[1]=H=J&65535|B<<16,C=oe,j=W,J=j&65535,B=j>>>16,k=C&65535,K=C>>>16,C=y[2],j=S[2],J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,B+=J>>>16,k+=B>>>16,K+=k>>>16,y[2]=oe=k&65535|K<<16,S[2]=W=J&65535|B<<16,C=be,j=ge,J=j&65535,B=j>>>16,k=C&65535,K=C>>>16,C=y[3],j=S[3],J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,B+=J>>>16,k+=B>>>16,K+=k>>>16,y[3]=be=k&65535|K<<16,S[3]=ge=J&65535|B<<16,C=de,j=te,J=j&65535,B=j>>>16,k=C&65535,K=C>>>16,C=y[4],j=S[4],J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,B+=J>>>16,k+=B>>>16,K+=k>>>16,y[4]=de=k&65535|K<<16,S[4]=te=J&65535|B<<16,C=pe,j=Ee,J=j&65535,B=j>>>16,k=C&65535,K=C>>>16,C=y[5],j=S[5],J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,B+=J>>>16,k+=B>>>16,K+=k>>>16,y[5]=pe=k&65535|K<<16,S[5]=Ee=J&65535|B<<16,C=ue,j=Ce,J=j&65535,B=j>>>16,k=C&65535,K=C>>>16,C=y[6],j=S[6],J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,B+=J>>>16,k+=B>>>16,K+=k>>>16,y[6]=ue=k&65535|K<<16,S[6]=Ce=J&65535|B<<16,C=he,j=tt,J=j&65535,B=j>>>16,k=C&65535,K=C>>>16,C=y[7],j=S[7],J+=j&65535,B+=j>>>16,k+=C&65535,K+=C>>>16,B+=J>>>16,k+=B>>>16,K+=k>>>16,y[7]=he=k&65535|K<<16,S[7]=tt=J&65535|B<<16,O+=128,M-=128}return O}function l(p){var _=new n;_.update(p);var y=_.digest();return _.clean(),y}o.hash=l})(Nf);(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.convertSecretKeyToX25519=o.convertPublicKeyToX25519=o.verify=o.sign=o.extractPublicKeyFromSecretKey=o.generateKeyPair=o.generateKeyPairFromSeed=o.SEED_LENGTH=o.SECRET_KEY_LENGTH=o.PUBLIC_KEY_LENGTH=o.SIGNATURE_LENGTH=void 0;const r=uf,t=Nf,n=cf;o.SIGNATURE_LENGTH=64,o.PUBLIC_KEY_LENGTH=32,o.SECRET_KEY_LENGTH=64,o.SEED_LENGTH=32;function s(T){const A=new Float64Array(16);if(T)for(let P=0;P<T.length;P++)A[P]=T[P];return A}const c=new Uint8Array(32);c[0]=9;const l=s(),p=s([1]),_=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),y=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),S=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),D=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),O=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function M(T,A){for(let P=0;P<16;P++)T[P]=A[P]|0}function U(T){let A=1;for(let P=0;P<16;P++){let h=T[P]+A+65535;A=Math.floor(h/65536),T[P]=h-A*65536}T[0]+=A-1+37*(A-1)}function V(T,A,P){const h=~(P-1);for(let b=0;b<16;b++){const Z=h&(T[b]^A[b]);T[b]^=Z,A[b]^=Z}}function oe(T,A){const P=s(),h=s();for(let b=0;b<16;b++)h[b]=A[b];U(h),U(h),U(h);for(let b=0;b<2;b++){P[0]=h[0]-65517;for(let ae=1;ae<15;ae++)P[ae]=h[ae]-65535-(P[ae-1]>>16&1),P[ae-1]&=65535;P[15]=h[15]-32767-(P[14]>>16&1);const Z=P[15]>>16&1;P[14]&=65535,V(h,P,1-Z)}for(let b=0;b<16;b++)T[2*b]=h[b]&255,T[2*b+1]=h[b]>>8}function be(T,A){let P=0;for(let h=0;h<32;h++)P|=T[h]^A[h];return(1&P-1>>>8)-1}function de(T,A){const P=new Uint8Array(32),h=new Uint8Array(32);return oe(P,T),oe(h,A),be(P,h)}function pe(T){const A=new Uint8Array(32);return oe(A,T),A[0]&1}function ue(T,A){for(let P=0;P<16;P++)T[P]=A[2*P]+(A[2*P+1]<<8);T[15]&=32767}function he(T,A,P){for(let h=0;h<16;h++)T[h]=A[h]+P[h]}function N(T,A,P){for(let h=0;h<16;h++)T[h]=A[h]-P[h]}function H(T,A,P){let h,b,Z=0,ae=0,ve=0,Te=0,$e=0,Ie=0,St=0,_t=0,st=0,Fe=0,Qe=0,Ye=0,ot=0,ze=0,Xe=0,Ne=0,Ve=0,ht=0,je=0,Pt=0,Ft=0,Ut=0,Ht=0,qt=0,Wt=0,rr=0,jr=0,Jt=0,Br=0,ci=0,Ii=0,lt=P[0],rt=P[1],ft=P[2],pt=P[3],at=P[4],it=P[5],Ot=P[6],Rt=P[7],dt=P[8],Ct=P[9],gt=P[10],mt=P[11],yt=P[12],Je=P[13],At=P[14],Tt=P[15];h=A[0],Z+=h*lt,ae+=h*rt,ve+=h*ft,Te+=h*pt,$e+=h*at,Ie+=h*it,St+=h*Ot,_t+=h*Rt,st+=h*dt,Fe+=h*Ct,Qe+=h*gt,Ye+=h*mt,ot+=h*yt,ze+=h*Je,Xe+=h*At,Ne+=h*Tt,h=A[1],ae+=h*lt,ve+=h*rt,Te+=h*ft,$e+=h*pt,Ie+=h*at,St+=h*it,_t+=h*Ot,st+=h*Rt,Fe+=h*dt,Qe+=h*Ct,Ye+=h*gt,ot+=h*mt,ze+=h*yt,Xe+=h*Je,Ne+=h*At,Ve+=h*Tt,h=A[2],ve+=h*lt,Te+=h*rt,$e+=h*ft,Ie+=h*pt,St+=h*at,_t+=h*it,st+=h*Ot,Fe+=h*Rt,Qe+=h*dt,Ye+=h*Ct,ot+=h*gt,ze+=h*mt,Xe+=h*yt,Ne+=h*Je,Ve+=h*At,ht+=h*Tt,h=A[3],Te+=h*lt,$e+=h*rt,Ie+=h*ft,St+=h*pt,_t+=h*at,st+=h*it,Fe+=h*Ot,Qe+=h*Rt,Ye+=h*dt,ot+=h*Ct,ze+=h*gt,Xe+=h*mt,Ne+=h*yt,Ve+=h*Je,ht+=h*At,je+=h*Tt,h=A[4],$e+=h*lt,Ie+=h*rt,St+=h*ft,_t+=h*pt,st+=h*at,Fe+=h*it,Qe+=h*Ot,Ye+=h*Rt,ot+=h*dt,ze+=h*Ct,Xe+=h*gt,Ne+=h*mt,Ve+=h*yt,ht+=h*Je,je+=h*At,Pt+=h*Tt,h=A[5],Ie+=h*lt,St+=h*rt,_t+=h*ft,st+=h*pt,Fe+=h*at,Qe+=h*it,Ye+=h*Ot,ot+=h*Rt,ze+=h*dt,Xe+=h*Ct,Ne+=h*gt,Ve+=h*mt,ht+=h*yt,je+=h*Je,Pt+=h*At,Ft+=h*Tt,h=A[6],St+=h*lt,_t+=h*rt,st+=h*ft,Fe+=h*pt,Qe+=h*at,Ye+=h*it,ot+=h*Ot,ze+=h*Rt,Xe+=h*dt,Ne+=h*Ct,Ve+=h*gt,ht+=h*mt,je+=h*yt,Pt+=h*Je,Ft+=h*At,Ut+=h*Tt,h=A[7],_t+=h*lt,st+=h*rt,Fe+=h*ft,Qe+=h*pt,Ye+=h*at,ot+=h*it,ze+=h*Ot,Xe+=h*Rt,Ne+=h*dt,Ve+=h*Ct,ht+=h*gt,je+=h*mt,Pt+=h*yt,Ft+=h*Je,Ut+=h*At,Ht+=h*Tt,h=A[8],st+=h*lt,Fe+=h*rt,Qe+=h*ft,Ye+=h*pt,ot+=h*at,ze+=h*it,Xe+=h*Ot,Ne+=h*Rt,Ve+=h*dt,ht+=h*Ct,je+=h*gt,Pt+=h*mt,Ft+=h*yt,Ut+=h*Je,Ht+=h*At,qt+=h*Tt,h=A[9],Fe+=h*lt,Qe+=h*rt,Ye+=h*ft,ot+=h*pt,ze+=h*at,Xe+=h*it,Ne+=h*Ot,Ve+=h*Rt,ht+=h*dt,je+=h*Ct,Pt+=h*gt,Ft+=h*mt,Ut+=h*yt,Ht+=h*Je,qt+=h*At,Wt+=h*Tt,h=A[10],Qe+=h*lt,Ye+=h*rt,ot+=h*ft,ze+=h*pt,Xe+=h*at,Ne+=h*it,Ve+=h*Ot,ht+=h*Rt,je+=h*dt,Pt+=h*Ct,Ft+=h*gt,Ut+=h*mt,Ht+=h*yt,qt+=h*Je,Wt+=h*At,rr+=h*Tt,h=A[11],Ye+=h*lt,ot+=h*rt,ze+=h*ft,Xe+=h*pt,Ne+=h*at,Ve+=h*it,ht+=h*Ot,je+=h*Rt,Pt+=h*dt,Ft+=h*Ct,Ut+=h*gt,Ht+=h*mt,qt+=h*yt,Wt+=h*Je,rr+=h*At,jr+=h*Tt,h=A[12],ot+=h*lt,ze+=h*rt,Xe+=h*ft,Ne+=h*pt,Ve+=h*at,ht+=h*it,je+=h*Ot,Pt+=h*Rt,Ft+=h*dt,Ut+=h*Ct,Ht+=h*gt,qt+=h*mt,Wt+=h*yt,rr+=h*Je,jr+=h*At,Jt+=h*Tt,h=A[13],ze+=h*lt,Xe+=h*rt,Ne+=h*ft,Ve+=h*pt,ht+=h*at,je+=h*it,Pt+=h*Ot,Ft+=h*Rt,Ut+=h*dt,Ht+=h*Ct,qt+=h*gt,Wt+=h*mt,rr+=h*yt,jr+=h*Je,Jt+=h*At,Br+=h*Tt,h=A[14],Xe+=h*lt,Ne+=h*rt,Ve+=h*ft,ht+=h*pt,je+=h*at,Pt+=h*it,Ft+=h*Ot,Ut+=h*Rt,Ht+=h*dt,qt+=h*Ct,Wt+=h*gt,rr+=h*mt,jr+=h*yt,Jt+=h*Je,Br+=h*At,ci+=h*Tt,h=A[15],Ne+=h*lt,Ve+=h*rt,ht+=h*ft,je+=h*pt,Pt+=h*at,Ft+=h*it,Ut+=h*Ot,Ht+=h*Rt,qt+=h*dt,Wt+=h*Ct,rr+=h*gt,jr+=h*mt,Jt+=h*yt,Br+=h*Je,ci+=h*At,Ii+=h*Tt,Z+=38*Ve,ae+=38*ht,ve+=38*je,Te+=38*Pt,$e+=38*Ft,Ie+=38*Ut,St+=38*Ht,_t+=38*qt,st+=38*Wt,Fe+=38*rr,Qe+=38*jr,Ye+=38*Jt,ot+=38*Br,ze+=38*ci,Xe+=38*Ii,b=1,h=Z+b+65535,b=Math.floor(h/65536),Z=h-b*65536,h=ae+b+65535,b=Math.floor(h/65536),ae=h-b*65536,h=ve+b+65535,b=Math.floor(h/65536),ve=h-b*65536,h=Te+b+65535,b=Math.floor(h/65536),Te=h-b*65536,h=$e+b+65535,b=Math.floor(h/65536),$e=h-b*65536,h=Ie+b+65535,b=Math.floor(h/65536),Ie=h-b*65536,h=St+b+65535,b=Math.floor(h/65536),St=h-b*65536,h=_t+b+65535,b=Math.floor(h/65536),_t=h-b*65536,h=st+b+65535,b=Math.floor(h/65536),st=h-b*65536,h=Fe+b+65535,b=Math.floor(h/65536),Fe=h-b*65536,h=Qe+b+65535,b=Math.floor(h/65536),Qe=h-b*65536,h=Ye+b+65535,b=Math.floor(h/65536),Ye=h-b*65536,h=ot+b+65535,b=Math.floor(h/65536),ot=h-b*65536,h=ze+b+65535,b=Math.floor(h/65536),ze=h-b*65536,h=Xe+b+65535,b=Math.floor(h/65536),Xe=h-b*65536,h=Ne+b+65535,b=Math.floor(h/65536),Ne=h-b*65536,Z+=b-1+37*(b-1),b=1,h=Z+b+65535,b=Math.floor(h/65536),Z=h-b*65536,h=ae+b+65535,b=Math.floor(h/65536),ae=h-b*65536,h=ve+b+65535,b=Math.floor(h/65536),ve=h-b*65536,h=Te+b+65535,b=Math.floor(h/65536),Te=h-b*65536,h=$e+b+65535,b=Math.floor(h/65536),$e=h-b*65536,h=Ie+b+65535,b=Math.floor(h/65536),Ie=h-b*65536,h=St+b+65535,b=Math.floor(h/65536),St=h-b*65536,h=_t+b+65535,b=Math.floor(h/65536),_t=h-b*65536,h=st+b+65535,b=Math.floor(h/65536),st=h-b*65536,h=Fe+b+65535,b=Math.floor(h/65536),Fe=h-b*65536,h=Qe+b+65535,b=Math.floor(h/65536),Qe=h-b*65536,h=Ye+b+65535,b=Math.floor(h/65536),Ye=h-b*65536,h=ot+b+65535,b=Math.floor(h/65536),ot=h-b*65536,h=ze+b+65535,b=Math.floor(h/65536),ze=h-b*65536,h=Xe+b+65535,b=Math.floor(h/65536),Xe=h-b*65536,h=Ne+b+65535,b=Math.floor(h/65536),Ne=h-b*65536,Z+=b-1+37*(b-1),T[0]=Z,T[1]=ae,T[2]=ve,T[3]=Te,T[4]=$e,T[5]=Ie,T[6]=St,T[7]=_t,T[8]=st,T[9]=Fe,T[10]=Qe,T[11]=Ye,T[12]=ot,T[13]=ze,T[14]=Xe,T[15]=Ne}function W(T,A){H(T,A,A)}function ge(T,A){const P=s();let h;for(h=0;h<16;h++)P[h]=A[h];for(h=253;h>=0;h--)W(P,P),h!==2&&h!==4&&H(P,P,A);for(h=0;h<16;h++)T[h]=P[h]}function te(T,A){const P=s();let h;for(h=0;h<16;h++)P[h]=A[h];for(h=250;h>=0;h--)W(P,P),h!==1&&H(P,P,A);for(h=0;h<16;h++)T[h]=P[h]}function Ee(T,A){const P=s(),h=s(),b=s(),Z=s(),ae=s(),ve=s(),Te=s(),$e=s(),Ie=s();N(P,T[1],T[0]),N(Ie,A[1],A[0]),H(P,P,Ie),he(h,T[0],T[1]),he(Ie,A[0],A[1]),H(h,h,Ie),H(b,T[3],A[3]),H(b,b,y),H(Z,T[2],A[2]),he(Z,Z,Z),N(ae,h,P),N(ve,Z,b),he(Te,Z,b),he($e,h,P),H(T[0],ae,ve),H(T[1],$e,Te),H(T[2],Te,ve),H(T[3],ae,$e)}function Ce(T,A,P){for(let h=0;h<4;h++)V(T[h],A[h],P)}function tt(T,A){const P=s(),h=s(),b=s();ge(b,A[2]),H(P,A[0],b),H(h,A[1],b),oe(T,h),T[31]^=pe(P)<<7}function C(T,A,P){M(T[0],l),M(T[1],p),M(T[2],p),M(T[3],l);for(let h=255;h>=0;--h){const b=P[h/8|0]>>(h&7)&1;Ce(T,A,b),Ee(A,T),Ee(T,T),Ce(T,A,b)}}function j(T,A){const P=[s(),s(),s(),s()];M(P[0],S),M(P[1],D),M(P[2],p),H(P[3],S,D),C(T,P,A)}function Me(T){if(T.length!==o.SEED_LENGTH)throw new Error(`ed25519: seed must be ${o.SEED_LENGTH} bytes`);const A=(0,t.hash)(T);A[0]&=248,A[31]&=127,A[31]|=64;const P=new Uint8Array(32),h=[s(),s(),s(),s()];j(h,A),tt(P,h);const b=new Uint8Array(64);return b.set(T),b.set(P,32),{publicKey:P,secretKey:b}}o.generateKeyPairFromSeed=Me;function Ae(T){const A=(0,r.randomBytes)(32,T),P=Me(A);return(0,n.wipe)(A),P}o.generateKeyPair=Ae;function J(T){if(T.length!==o.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${o.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(T.subarray(32))}o.extractPublicKeyFromSecretKey=J;const B=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function k(T,A){let P,h,b,Z;for(h=63;h>=32;--h){for(P=0,b=h-32,Z=h-12;b<Z;++b)A[b]+=P-16*A[h]*B[b-(h-32)],P=Math.floor((A[b]+128)/256),A[b]-=P*256;A[b]+=P,A[h]=0}for(P=0,b=0;b<32;b++)A[b]+=P-(A[31]>>4)*B[b],P=A[b]>>8,A[b]&=255;for(b=0;b<32;b++)A[b]-=P*B[b];for(h=0;h<32;h++)A[h+1]+=A[h]>>8,T[h]=A[h]&255}function K(T){const A=new Float64Array(64);for(let P=0;P<64;P++)A[P]=T[P];for(let P=0;P<64;P++)T[P]=0;k(T,A)}function ut(T,A){const P=new Float64Array(64),h=[s(),s(),s(),s()],b=(0,t.hash)(T.subarray(0,32));b[0]&=248,b[31]&=127,b[31]|=64;const Z=new Uint8Array(64);Z.set(b.subarray(32),32);const ae=new t.SHA512;ae.update(Z.subarray(32)),ae.update(A);const ve=ae.digest();ae.clean(),K(ve),j(h,ve),tt(Z,h),ae.reset(),ae.update(Z.subarray(0,32)),ae.update(T.subarray(32)),ae.update(A);const Te=ae.digest();K(Te);for(let $e=0;$e<32;$e++)P[$e]=ve[$e];for(let $e=0;$e<32;$e++)for(let Ie=0;Ie<32;Ie++)P[$e+Ie]+=Te[$e]*b[Ie];return k(Z.subarray(32),P),Z}o.sign=ut;function ke(T,A){const P=s(),h=s(),b=s(),Z=s(),ae=s(),ve=s(),Te=s();return M(T[2],p),ue(T[1],A),W(b,T[1]),H(Z,b,_),N(b,b,T[2]),he(Z,T[2],Z),W(ae,Z),W(ve,ae),H(Te,ve,ae),H(P,Te,b),H(P,P,Z),te(P,P),H(P,P,b),H(P,P,Z),H(P,P,Z),H(T[0],P,Z),W(h,T[0]),H(h,h,Z),de(h,b)&&H(T[0],T[0],O),W(h,T[0]),H(h,h,Z),de(h,b)?-1:(pe(T[0])===A[31]>>7&&N(T[0],l,T[0]),H(T[3],T[0],T[1]),0)}function Dr(T,A,P){const h=new Uint8Array(32),b=[s(),s(),s(),s()],Z=[s(),s(),s(),s()];if(P.length!==o.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${o.SIGNATURE_LENGTH} bytes`);if(ke(Z,T))return!1;const ae=new t.SHA512;ae.update(P.subarray(0,32)),ae.update(T),ae.update(A);const ve=ae.digest();return K(ve),C(b,Z,ve),j(Z,P.subarray(32)),Ee(b,Z),tt(h,b),!be(P,h)}o.verify=Dr;function me(T){let A=[s(),s(),s(),s()];if(ke(A,T))throw new Error("Ed25519: invalid public key");let P=s(),h=s(),b=A[1];he(P,p,b),N(h,p,b),ge(h,h),H(P,P,h);let Z=new Uint8Array(32);return oe(Z,P),Z}o.convertPublicKeyToX25519=me;function It(T){const A=(0,t.hash)(T.subarray(0,32));A[0]&=248,A[31]&=127,A[31]|=64;const P=new Uint8Array(A.subarray(0,32));return(0,n.wipe)(A),P}o.convertSecretKeyToX25519=It})(Uc);const mw="EdDSA",ww="JWT",$f=".",Lf="base64url",bw="utf8",Ew="utf8",xw=":",Iw="did",Sw="key",vl="base58btc",Pw="z",Ow="K36",Rw=32;function wo(o){return xo(jc(rs(o),bw),Lf)}function Ff(o){const r=jc(Ow,vl),t=Pw+xo(k_([r,o]),vl);return[Iw,Sw,t].join(xw)}function Cw(o){return xo(o,Lf)}function Aw(o){return jc([wo(o.header),wo(o.payload)].join($f),Ew)}function Tw(o){return[wo(o.header),wo(o.payload),Cw(o.signature)].join($f)}function _l(o=uf.randomBytes(Rw)){return Uc.generateKeyPairFromSeed(o)}async function Nw(o,r,t,n,s=re.fromMiliseconds(Date.now())){const c={alg:mw,typ:ww},l=Ff(n.publicKey),p=s+t,_={iss:l,sub:o,aud:r,iat:s,exp:p},y=Aw({header:c,payload:_}),S=Uc.sign(n.secretKey,y);return Tw({header:c,payload:_,signature:S})}const $w="PARSE_ERROR",Lw="INVALID_REQUEST",Fw="METHOD_NOT_FOUND",Dw="INVALID_PARAMS",Df="INTERNAL_ERROR",Hc="SERVER_ERROR",jw=[-32700,-32600,-32601,-32602,-32603],Yn={[$w]:{code:-32700,message:"Parse error"},[Lw]:{code:-32600,message:"Invalid Request"},[Fw]:{code:-32601,message:"Method not found"},[Dw]:{code:-32602,message:"Invalid params"},[Df]:{code:-32603,message:"Internal error"},[Hc]:{code:-32e3,message:"Server error"}},jf=Hc;function qw(o){return jw.includes(o)}function ml(o){return Object.keys(Yn).includes(o)?Yn[o]:Yn[jf]}function Mw(o){const r=Object.values(Yn).find(t=>t.code===o);return r||Yn[jf]}function qf(o,r,t){return o.message.includes("getaddrinfo ENOTFOUND")||o.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${r}`):o}var Mf={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Rc=function(o,r){return Rc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])},Rc(o,r)};function zw(o,r){Rc(o,r);function t(){this.constructor=o}o.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}var Cc=function(){return Cc=Object.assign||function(r){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(r[c]=t[c])}return r},Cc.apply(this,arguments)};function Uw(o,r){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&r.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(o);s<n.length;s++)r.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(o,n[s])&&(t[n[s]]=o[n[s]]);return t}function Hw(o,r,t,n){var s=arguments.length,c=s<3?r:n===null?n=Object.getOwnPropertyDescriptor(r,t):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,r,t,n);else for(var p=o.length-1;p>=0;p--)(l=o[p])&&(c=(s<3?l(c):s>3?l(r,t,c):l(r,t))||c);return s>3&&c&&Object.defineProperty(r,t,c),c}function kw(o,r){return function(t,n){r(t,n,o)}}function Vw(o,r){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,r)}function Bw(o,r,t,n){function s(c){return c instanceof t?c:new t(function(l){l(c)})}return new(t||(t=Promise))(function(c,l){function p(S){try{y(n.next(S))}catch(D){l(D)}}function _(S){try{y(n.throw(S))}catch(D){l(D)}}function y(S){S.done?c(S.value):s(S.value).then(p,_)}y((n=n.apply(o,r||[])).next())})}function Kw(o,r){var t={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,s,c,l;return l={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function p(y){return function(S){return _([y,S])}}function _(y){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(c=y[0]&2?s.return:y[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,y[1])).done)return c;switch(s=0,c&&(y=[y[0]&2,c.value]),y[0]){case 0:case 1:c=y;break;case 4:return t.label++,{value:y[1],done:!1};case 5:t.label++,s=y[1],y=[0];continue;case 7:y=t.ops.pop(),t.trys.pop();continue;default:if(c=t.trys,!(c=c.length>0&&c[c.length-1])&&(y[0]===6||y[0]===2)){t=0;continue}if(y[0]===3&&(!c||y[1]>c[0]&&y[1]<c[3])){t.label=y[1];break}if(y[0]===6&&t.label<c[1]){t.label=c[1],c=y;break}if(c&&t.label<c[2]){t.label=c[2],t.ops.push(y);break}c[2]&&t.ops.pop(),t.trys.pop();continue}y=r.call(o,t)}catch(S){y=[6,S],s=0}finally{n=c=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function Gw(o,r,t,n){n===void 0&&(n=t),o[n]=r[t]}function Ww(o,r){for(var t in o)t!=="default"&&!r.hasOwnProperty(t)&&(r[t]=o[t])}function Ac(o){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&o[r],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function zf(o,r){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var n=t.call(o),s,c=[],l;try{for(;(r===void 0||r-- >0)&&!(s=n.next()).done;)c.push(s.value)}catch(p){l={error:p}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(l)throw l.error}}return c}function Jw(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(zf(arguments[r]));return o}function Qw(){for(var o=0,r=0,t=arguments.length;r<t;r++)o+=arguments[r].length;for(var n=Array(o),s=0,r=0;r<t;r++)for(var c=arguments[r],l=0,p=c.length;l<p;l++,s++)n[s]=c[l];return n}function is(o){return this instanceof is?(this.v=o,this):new is(o)}function Yw(o,r,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,r||[]),s,c=[];return s={},l("next"),l("throw"),l("return"),s[Symbol.asyncIterator]=function(){return this},s;function l(O){n[O]&&(s[O]=function(M){return new Promise(function(U,V){c.push([O,M,U,V])>1||p(O,M)})})}function p(O,M){try{_(n[O](M))}catch(U){D(c[0][3],U)}}function _(O){O.value instanceof is?Promise.resolve(O.value.v).then(y,S):D(c[0][2],O)}function y(O){p("next",O)}function S(O){p("throw",O)}function D(O,M){O(M),c.shift(),c.length&&p(c[0][0],c[0][1])}}function Xw(o){var r,t;return r={},n("next"),n("throw",function(s){throw s}),n("return"),r[Symbol.iterator]=function(){return this},r;function n(s,c){r[s]=o[s]?function(l){return(t=!t)?{value:is(o[s](l)),done:s==="return"}:c?c(l):l}:c}}function Zw(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=o[Symbol.asyncIterator],t;return r?r.call(o):(o=typeof Ac=="function"?Ac(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(c){t[c]=o[c]&&function(l){return new Promise(function(p,_){l=o[c](l),s(p,_,l.done,l.value)})}}function s(c,l,p,_){Promise.resolve(_).then(function(y){c({value:y,done:p})},l)}}function eb(o,r){return Object.defineProperty?Object.defineProperty(o,"raw",{value:r}):o.raw=r,o}function tb(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var t in o)Object.hasOwnProperty.call(o,t)&&(r[t]=o[t]);return r.default=o,r}function rb(o){return o&&o.__esModule?o:{default:o}}function ib(o,r){if(!r.has(o))throw new TypeError("attempted to get private field on non-instance");return r.get(o)}function nb(o,r,t){if(!r.has(o))throw new TypeError("attempted to set private field on non-instance");return r.set(o,t),t}const sb=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Cc},__asyncDelegator:Xw,__asyncGenerator:Yw,__asyncValues:Zw,__await:is,__awaiter:Bw,__classPrivateFieldGet:ib,__classPrivateFieldSet:nb,__createBinding:Gw,__decorate:Hw,__exportStar:Ww,__extends:zw,__generator:Kw,__importDefault:rb,__importStar:tb,__makeTemplateObject:eb,__metadata:Vw,__param:kw,__read:zf,__rest:Uw,__spread:Jw,__spreadArrays:Qw,__values:Ac},Symbol.toStringTag,{value:"Module"})),ob=ns(sb);var ii={},wl;function ab(){if(wl)return ii;wl=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.isBrowserCryptoAvailable=ii.getSubtleCrypto=ii.getBrowerCrypto=void 0;function o(){return(yr===null||yr===void 0?void 0:yr.crypto)||(yr===null||yr===void 0?void 0:yr.msCrypto)||{}}ii.getBrowerCrypto=o;function r(){const n=o();return n.subtle||n.webkitSubtle}ii.getSubtleCrypto=r;function t(){return!!o()&&!!r()}return ii.isBrowserCryptoAvailable=t,ii}var ni={},bl;function cb(){if(bl)return ni;bl=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.isBrowser=ni.isNode=ni.isReactNative=void 0;function o(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}ni.isReactNative=o;function r(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}ni.isNode=r;function t(){return!o()&&!r()}return ni.isBrowser=t,ni}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const r=ob;r.__exportStar(ab(),o),r.__exportStar(cb(),o)})(Mf);function kc(o=3){const r=Date.now()*Math.pow(10,o),t=Math.floor(Math.random()*Math.pow(10,o));return r+t}function Uf(o=6){return BigInt(kc(o))}function gn(o,r,t){return{id:t||kc(),jsonrpc:"2.0",method:o,params:r}}function Vc(o,r){return{id:o,jsonrpc:"2.0",result:r}}function Oo(o,r,t){return{id:o,jsonrpc:"2.0",error:ub(r,t)}}function ub(o,r){return typeof o>"u"?ml(Df):(typeof o=="string"&&(o=Object.assign(Object.assign({},ml(Hc)),{message:o})),typeof r<"u"&&(o.data=r),qw(o.code)&&(o=Mw(o.code)),o)}class hb{}class lb extends hb{constructor(){super()}}class fb extends lb{constructor(r){super()}}const pb="^https?:",db="^wss?:";function gb(o){const r=o.match(new RegExp(/^\w+:/,"gi"));if(!(!r||!r.length))return r[0]}function Hf(o,r){const t=gb(o);return typeof t>"u"?!1:new RegExp(r).test(t)}function El(o){return Hf(o,pb)}function xl(o){return Hf(o,db)}function yb(o){return new RegExp("wss?://localhost(:d{2,5})?").test(o)}function kf(o){return typeof o=="object"&&"id"in o&&"jsonrpc"in o&&o.jsonrpc==="2.0"}function Bc(o){return kf(o)&&"method"in o}function Ro(o){return kf(o)&&(ai(o)||Fr(o))}function ai(o){return"result"in o}function Fr(o){return"error"in o}class Ei extends fb{constructor(r){super(r),this.events=new vr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(r),this.connection.connected&&this.registerEventListeners()}async connect(r=this.connection){await this.open(r)}async disconnect(){await this.close()}on(r,t){this.events.on(r,t)}once(r,t){this.events.once(r,t)}off(r,t){this.events.off(r,t)}removeListener(r,t){this.events.removeListener(r,t)}async request(r,t){return this.requestStrict(gn(r.method,r.params||[],r.id||Uf().toString()),t)}async requestStrict(r,t){return new Promise(async(n,s)=>{if(!this.connection.connected)try{await this.open()}catch(c){s(c)}this.events.on(`${r.id}`,c=>{Fr(c)?s(c.error):n(c.result)});try{await this.connection.send(r,t)}catch(c){s(c)}})}setConnection(r=this.connection){return r}onPayload(r){this.events.emit("payload",r),Ro(r)?this.events.emit(`${r.id}`,r):this.events.emit("message",{type:r.method,data:r.params})}onClose(r){r&&r.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${r.code} ${r.reason?`(${r.reason})`:""}`)),this.events.emit("disconnect")}async open(r=this.connection){this.connection===r&&this.connection.connected||(this.connection.connected&&this.close(),typeof r=="string"&&(await this.connection.open(r),r=this.connection),this.connection=this.setConnection(r),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",r=>this.onPayload(r)),this.connection.on("close",r=>this.onClose(r)),this.connection.on("error",r=>this.events.emit("error",r)),this.connection.on("register_error",r=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const vb=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),_b=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Il=o=>o.split("?")[0],Sl=10,mb=vb();class wb{constructor(r){if(this.url=r,this.events=new vr.EventEmitter,this.registering=!1,!xl(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);this.url=r}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(r,t){this.events.on(r,t)}once(r,t){this.events.once(r,t)}off(r,t){this.events.off(r,t)}removeListener(r,t){this.events.removeListener(r,t)}async open(r=this.url){await this.register(r)}async close(){return new Promise((r,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),r()},this.socket.close()})}async send(r,t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(rs(r))}catch(n){this.onError(r.id,n)}}register(r=this.url){if(!xl(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((n,s)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),s(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=r,this.registering=!0,new Promise((t,n)=>{const s=Mf.isReactNative()?void 0:{rejectUnauthorized:!yb(r)},c=new mb(r,[],s);_b()?c.onerror=l=>{const p=l;n(this.emitError(p.error))}:c.on("error",l=>{n(this.emitError(l))}),c.onopen=()=>{this.onOpen(c),t(c)}})}onOpen(r){r.onmessage=t=>this.onPayload(t),r.onclose=t=>this.onClose(t),this.socket=r,this.registering=!1,this.events.emit("open")}onClose(r){this.socket=void 0,this.registering=!1,this.events.emit("close",r)}onPayload(r){if(typeof r.data>"u")return;const t=typeof r.data=="string"?zc(r.data):r.data;this.events.emit("payload",t)}onError(r,t){const n=this.parseError(t),s=n.message||n.toString(),c=Oo(r,s);this.events.emit("payload",c)}parseError(r,t=this.url){return qf(r,Il(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Sl&&this.events.setMaxListeners(Sl)}emitError(r){const t=this.parseError(new Error((r==null?void 0:r.message)||`WebSocket connection failed for host: ${Il(this.url)}`));return this.events.emit("register_error",t),t}}var bo={exports:{}};bo.exports;(function(o,r){var t=200,n="__lodash_hash_undefined__",s=1,c=2,l=9007199254740991,p="[object Arguments]",_="[object Array]",y="[object AsyncFunction]",S="[object Boolean]",D="[object Date]",O="[object Error]",M="[object Function]",U="[object GeneratorFunction]",V="[object Map]",oe="[object Number]",be="[object Null]",de="[object Object]",pe="[object Promise]",ue="[object Proxy]",he="[object RegExp]",N="[object Set]",H="[object String]",W="[object Symbol]",ge="[object Undefined]",te="[object WeakMap]",Ee="[object ArrayBuffer]",Ce="[object DataView]",tt="[object Float32Array]",C="[object Float64Array]",j="[object Int8Array]",Me="[object Int16Array]",Ae="[object Int32Array]",J="[object Uint8Array]",B="[object Uint8ClampedArray]",k="[object Uint16Array]",K="[object Uint32Array]",ut=/[\\^$.*+?()[\]{}|]/g,ke=/^\[object .+?Constructor\]$/,Dr=/^(?:0|[1-9]\d*)$/,me={};me[tt]=me[C]=me[j]=me[Me]=me[Ae]=me[J]=me[B]=me[k]=me[K]=!0,me[p]=me[_]=me[Ee]=me[S]=me[Ce]=me[D]=me[O]=me[M]=me[V]=me[oe]=me[de]=me[he]=me[N]=me[H]=me[te]=!1;var It=typeof yr=="object"&&yr&&yr.Object===Object&&yr,T=typeof self=="object"&&self&&self.Object===Object&&self,A=It||T||Function("return this")(),P=r&&!r.nodeType&&r,h=P&&!0&&o&&!o.nodeType&&o,b=h&&h.exports===P,Z=b&&It.process,ae=function(){try{return Z&&Z.binding&&Z.binding("util")}catch{}}(),ve=ae&&ae.isTypedArray;function Te(v,E){for(var q=-1,Q=v==null?0:v.length,Ke=0,le=[];++q<Q;){var Ze=v[q];E(Ze,q,v)&&(le[Ke++]=Ze)}return le}function $e(v,E){for(var q=-1,Q=E.length,Ke=v.length;++q<Q;)v[Ke+q]=E[q];return v}function Ie(v,E){for(var q=-1,Q=v==null?0:v.length;++q<Q;)if(E(v[q],q,v))return!0;return!1}function St(v,E){for(var q=-1,Q=Array(v);++q<v;)Q[q]=E(q);return Q}function _t(v){return function(E){return v(E)}}function st(v,E){return v.has(E)}function Fe(v,E){return v==null?void 0:v[E]}function Qe(v){var E=-1,q=Array(v.size);return v.forEach(function(Q,Ke){q[++E]=[Ke,Q]}),q}function Ye(v,E){return function(q){return v(E(q))}}function ot(v){var E=-1,q=Array(v.size);return v.forEach(function(Q){q[++E]=Q}),q}var ze=Array.prototype,Xe=Function.prototype,Ne=Object.prototype,Ve=A["__core-js_shared__"],ht=Xe.toString,je=Ne.hasOwnProperty,Pt=function(){var v=/[^.]+$/.exec(Ve&&Ve.keys&&Ve.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Ft=Ne.toString,Ut=RegExp("^"+ht.call(je).replace(ut,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ht=b?A.Buffer:void 0,qt=A.Symbol,Wt=A.Uint8Array,rr=Ne.propertyIsEnumerable,jr=ze.splice,Jt=qt?qt.toStringTag:void 0,Br=Object.getOwnPropertySymbols,ci=Ht?Ht.isBuffer:void 0,Ii=Ye(Object.keys,Object),lt=hr(A,"DataView"),rt=hr(A,"Map"),ft=hr(A,"Promise"),pt=hr(A,"Set"),at=hr(A,"WeakMap"),it=hr(Object,"create"),Ot=Gr(lt),Rt=Gr(rt),dt=Gr(ft),Ct=Gr(pt),gt=Gr(at),mt=qt?qt.prototype:void 0,yt=mt?mt.valueOf:void 0;function Je(v){var E=-1,q=v==null?0:v.length;for(this.clear();++E<q;){var Q=v[E];this.set(Q[0],Q[1])}}function At(){this.__data__=it?it(null):{},this.size=0}function Tt(v){var E=this.has(v)&&delete this.__data__[v];return this.size-=E?1:0,E}function To(v){var E=this.__data__;if(it){var q=E[v];return q===n?void 0:q}return je.call(E,v)?E[v]:void 0}function No(v){var E=this.__data__;return it?E[v]!==void 0:je.call(E,v)}function $o(v,E){var q=this.__data__;return this.size+=this.has(v)?0:1,q[v]=it&&E===void 0?n:E,this}Je.prototype.clear=At,Je.prototype.delete=Tt,Je.prototype.get=To,Je.prototype.has=No,Je.prototype.set=$o;function _r(v){var E=-1,q=v==null?0:v.length;for(this.clear();++E<q;){var Q=v[E];this.set(Q[0],Q[1])}}function Lo(){this.__data__=[],this.size=0}function Fo(v){var E=this.__data__,q=Si(E,v);if(q<0)return!1;var Q=E.length-1;return q==Q?E.pop():jr.call(E,q,1),--this.size,!0}function Do(v){var E=this.__data__,q=Si(E,v);return q<0?void 0:E[q][1]}function jo(v){return Si(this.__data__,v)>-1}function qo(v,E){var q=this.__data__,Q=Si(q,v);return Q<0?(++this.size,q.push([v,E])):q[Q][1]=E,this}_r.prototype.clear=Lo,_r.prototype.delete=Fo,_r.prototype.get=Do,_r.prototype.has=jo,_r.prototype.set=qo;function Kr(v){var E=-1,q=v==null?0:v.length;for(this.clear();++E<q;){var Q=v[E];this.set(Q[0],Q[1])}}function ki(){this.size=0,this.__data__={hash:new Je,map:new(rt||_r),string:new Je}}function Mo(v){var E=ui(this,v).delete(v);return this.size-=E?1:0,E}function Vi(v){return ui(this,v).get(v)}function zo(v){return ui(this,v).has(v)}function Uo(v,E){var q=ui(this,v),Q=q.size;return q.set(v,E),this.size+=q.size==Q?0:1,this}Kr.prototype.clear=ki,Kr.prototype.delete=Mo,Kr.prototype.get=Vi,Kr.prototype.has=zo,Kr.prototype.set=Uo;function Bi(v){var E=-1,q=v==null?0:v.length;for(this.__data__=new Kr;++E<q;)this.add(v[E])}function as(v){return this.__data__.set(v,n),this}function cs(v){return this.__data__.has(v)}Bi.prototype.add=Bi.prototype.push=as,Bi.prototype.has=cs;function Rr(v){var E=this.__data__=new _r(v);this.size=E.size}function Ho(){this.__data__=new _r,this.size=0}function ko(v){var E=this.__data__,q=E.delete(v);return this.size=E.size,q}function Vo(v){return this.__data__.get(v)}function Bo(v){return this.__data__.has(v)}function us(v,E){var q=this.__data__;if(q instanceof _r){var Q=q.__data__;if(!rt||Q.length<t-1)return Q.push([v,E]),this.size=++q.size,this;q=this.__data__=new Kr(Q)}return q.set(v,E),this.size=q.size,this}Rr.prototype.clear=Ho,Rr.prototype.delete=ko,Rr.prototype.get=Vo,Rr.prototype.has=Bo,Rr.prototype.set=us;function hs(v,E){var q=Wi(v),Q=!q&&Es(v),Ke=!q&&!Q&&bn(v),le=!q&&!Q&&!Ke&&Ss(v),Ze=q||Q||Ke||le,Nt=Ze?St(v.length,String):[],Pe=Nt.length;for(var Ge in v)(E||je.call(v,Ge))&&!(Ze&&(Ge=="length"||Ke&&(Ge=="offset"||Ge=="parent")||le&&(Ge=="buffer"||Ge=="byteLength"||Ge=="byteOffset")||vs(Ge,Pe)))&&Nt.push(Ge);return Nt}function Si(v,E){for(var q=v.length;q--;)if(bs(v[q][0],E))return q;return-1}function mn(v,E,q){var Q=E(v);return Wi(v)?Q:$e(Q,q(v))}function Pi(v){return v==null?v===void 0?ge:be:Jt&&Jt in Object(v)?gs(v):Wo(v)}function wn(v){return Ri(v)&&Pi(v)==p}function Oi(v,E,q,Q,Ke){return v===E?!0:v==null||E==null||!Ri(v)&&!Ri(E)?v!==v&&E!==E:ls(v,E,q,Q,Oi,Ke)}function ls(v,E,q,Q,Ke,le){var Ze=Wi(v),Nt=Wi(E),Pe=Ze?_:qr(v),Ge=Nt?_:qr(E);Pe=Pe==p?de:Pe,Ge=Ge==p?de:Ge;var wt=Pe==de,ir=Ge==de,$t=Pe==Ge;if($t&&bn(v)){if(!bn(E))return!1;Ze=!0,wt=!1}if($t&&!wt)return le||(le=new Rr),Ze||Ss(v)?Ki(v,E,q,Q,Ke,le):Go(v,E,Pe,q,Q,Ke,le);if(!(q&s)){var et=wt&&je.call(v,"__wrapped__"),Qt=ir&&je.call(E,"__wrapped__");if(et||Qt){var Cr=et?v.value():v,mr=Qt?E.value():E;return le||(le=new Rr),Ke(Cr,mr,q,Q,le)}}return $t?(le||(le=new Rr),ds(v,E,q,Q,Ke,le)):!1}function Ko(v){if(!Is(v)||ms(v))return!1;var E=Ji(v)?Ut:ke;return E.test(Gr(v))}function fs(v){return Ri(v)&&xs(v.length)&&!!me[Pi(v)]}function ps(v){if(!ws(v))return Ii(v);var E=[];for(var q in Object(v))je.call(v,q)&&q!="constructor"&&E.push(q);return E}function Ki(v,E,q,Q,Ke,le){var Ze=q&s,Nt=v.length,Pe=E.length;if(Nt!=Pe&&!(Ze&&Pe>Nt))return!1;var Ge=le.get(v);if(Ge&&le.get(E))return Ge==E;var wt=-1,ir=!0,$t=q&c?new Bi:void 0;for(le.set(v,E),le.set(E,v);++wt<Nt;){var et=v[wt],Qt=E[wt];if(Q)var Cr=Ze?Q(Qt,et,wt,E,v,le):Q(et,Qt,wt,v,E,le);if(Cr!==void 0){if(Cr)continue;ir=!1;break}if($t){if(!Ie(E,function(mr,Mr){if(!st($t,Mr)&&(et===mr||Ke(et,mr,q,Q,le)))return $t.push(Mr)})){ir=!1;break}}else if(!(et===Qt||Ke(et,Qt,q,Q,le))){ir=!1;break}}return le.delete(v),le.delete(E),ir}function Go(v,E,q,Q,Ke,le,Ze){switch(q){case Ce:if(v.byteLength!=E.byteLength||v.byteOffset!=E.byteOffset)return!1;v=v.buffer,E=E.buffer;case Ee:return!(v.byteLength!=E.byteLength||!le(new Wt(v),new Wt(E)));case S:case D:case oe:return bs(+v,+E);case O:return v.name==E.name&&v.message==E.message;case he:case H:return v==E+"";case V:var Nt=Qe;case N:var Pe=Q&s;if(Nt||(Nt=ot),v.size!=E.size&&!Pe)return!1;var Ge=Ze.get(v);if(Ge)return Ge==E;Q|=c,Ze.set(v,E);var wt=Ki(Nt(v),Nt(E),Q,Ke,le,Ze);return Ze.delete(v),wt;case W:if(yt)return yt.call(v)==yt.call(E)}return!1}function ds(v,E,q,Q,Ke,le){var Ze=q&s,Nt=Gi(v),Pe=Nt.length,Ge=Gi(E),wt=Ge.length;if(Pe!=wt&&!Ze)return!1;for(var ir=Pe;ir--;){var $t=Nt[ir];if(!(Ze?$t in E:je.call(E,$t)))return!1}var et=le.get(v);if(et&&le.get(E))return et==E;var Qt=!0;le.set(v,E),le.set(E,v);for(var Cr=Ze;++ir<Pe;){$t=Nt[ir];var mr=v[$t],Mr=E[$t];if(Q)var En=Ze?Q(Mr,mr,$t,E,v,le):Q(mr,Mr,$t,v,E,le);if(!(En===void 0?mr===Mr||Ke(mr,Mr,q,Q,le):En)){Qt=!1;break}Cr||(Cr=$t=="constructor")}if(Qt&&!Cr){var Ci=v.constructor,Mt=E.constructor;Ci!=Mt&&"constructor"in v&&"constructor"in E&&!(typeof Ci=="function"&&Ci instanceof Ci&&typeof Mt=="function"&&Mt instanceof Mt)&&(Qt=!1)}return le.delete(v),le.delete(E),Qt}function Gi(v){return mn(v,Yo,ys)}function ui(v,E){var q=v.__data__;return _s(E)?q[typeof E=="string"?"string":"hash"]:q.map}function hr(v,E){var q=Fe(v,E);return Ko(q)?q:void 0}function gs(v){var E=je.call(v,Jt),q=v[Jt];try{v[Jt]=void 0;var Q=!0}catch{}var Ke=Ft.call(v);return Q&&(E?v[Jt]=q:delete v[Jt]),Ke}var ys=Br?function(v){return v==null?[]:(v=Object(v),Te(Br(v),function(E){return rr.call(v,E)}))}:Be,qr=Pi;(lt&&qr(new lt(new ArrayBuffer(1)))!=Ce||rt&&qr(new rt)!=V||ft&&qr(ft.resolve())!=pe||pt&&qr(new pt)!=N||at&&qr(new at)!=te)&&(qr=function(v){var E=Pi(v),q=E==de?v.constructor:void 0,Q=q?Gr(q):"";if(Q)switch(Q){case Ot:return Ce;case Rt:return V;case dt:return pe;case Ct:return N;case gt:return te}return E});function vs(v,E){return E=E??l,!!E&&(typeof v=="number"||Dr.test(v))&&v>-1&&v%1==0&&v<E}function _s(v){var E=typeof v;return E=="string"||E=="number"||E=="symbol"||E=="boolean"?v!=="__proto__":v===null}function ms(v){return!!Pt&&Pt in v}function ws(v){var E=v&&v.constructor,q=typeof E=="function"&&E.prototype||Ne;return v===q}function Wo(v){return Ft.call(v)}function Gr(v){if(v!=null){try{return ht.call(v)}catch{}try{return v+""}catch{}}return""}function bs(v,E){return v===E||v!==v&&E!==E}var Es=wn(function(){return arguments}())?wn:function(v){return Ri(v)&&je.call(v,"callee")&&!rr.call(v,"callee")},Wi=Array.isArray;function Jo(v){return v!=null&&xs(v.length)&&!Ji(v)}var bn=ci||Ue;function Qo(v,E){return Oi(v,E)}function Ji(v){if(!Is(v))return!1;var E=Pi(v);return E==M||E==U||E==y||E==ue}function xs(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=l}function Is(v){var E=typeof v;return v!=null&&(E=="object"||E=="function")}function Ri(v){return v!=null&&typeof v=="object"}var Ss=ve?_t(ve):fs;function Yo(v){return Jo(v)?hs(v):ps(v)}function Be(){return[]}function Ue(){return!1}o.exports=Qo})(bo,bo.exports);var bb=bo.exports;const Eb=Dc(bb);function xb(o,r){if(o.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<o.length;s++){var c=o.charAt(s),l=c.charCodeAt(0);if(t[l]!==255)throw new TypeError(c+" is ambiguous");t[l]=s}var p=o.length,_=o.charAt(0),y=Math.log(p)/Math.log(256),S=Math.log(256)/Math.log(p);function D(U){if(U instanceof Uint8Array||(ArrayBuffer.isView(U)?U=new Uint8Array(U.buffer,U.byteOffset,U.byteLength):Array.isArray(U)&&(U=Uint8Array.from(U))),!(U instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(U.length===0)return"";for(var V=0,oe=0,be=0,de=U.length;be!==de&&U[be]===0;)be++,V++;for(var pe=(de-be)*S+1>>>0,ue=new Uint8Array(pe);be!==de;){for(var he=U[be],N=0,H=pe-1;(he!==0||N<oe)&&H!==-1;H--,N++)he+=256*ue[H]>>>0,ue[H]=he%p>>>0,he=he/p>>>0;if(he!==0)throw new Error("Non-zero carry");oe=N,be++}for(var W=pe-oe;W!==pe&&ue[W]===0;)W++;for(var ge=_.repeat(V);W<pe;++W)ge+=o.charAt(ue[W]);return ge}function O(U){if(typeof U!="string")throw new TypeError("Expected String");if(U.length===0)return new Uint8Array;var V=0;if(U[V]!==" "){for(var oe=0,be=0;U[V]===_;)oe++,V++;for(var de=(U.length-V)*y+1>>>0,pe=new Uint8Array(de);U[V];){var ue=t[U.charCodeAt(V)];if(ue===255)return;for(var he=0,N=de-1;(ue!==0||he<be)&&N!==-1;N--,he++)ue+=p*pe[N]>>>0,pe[N]=ue%256>>>0,ue=ue/256>>>0;if(ue!==0)throw new Error("Non-zero carry");be=he,V++}if(U[V]!==" "){for(var H=de-be;H!==de&&pe[H]===0;)H++;for(var W=new Uint8Array(oe+(de-H)),ge=oe;H!==de;)W[ge++]=pe[H++];return W}}}function M(U){var V=O(U);if(V)return V;throw new Error(`Non-${r} character`)}return{encode:D,decodeUnsafe:O,decode:M}}var Ib=xb,Sb=Ib;const Vf=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},Pb=o=>new TextEncoder().encode(o),Ob=o=>new TextDecoder().decode(o);class Rb{constructor(r,t,n){this.name=r,this.prefix=t,this.baseEncode=n}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class Cb{constructor(r,t,n){if(this.name=r,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return Bf(this,r)}}class Ab{constructor(r){this.decoders=r}or(r){return Bf(this,r)}decode(r){const t=r[0],n=this.decoders[t];if(n)return n.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Bf=(o,r)=>new Ab({...o.decoders||{[o.prefix]:o},...r.decoders||{[r.prefix]:r}});class Tb{constructor(r,t,n,s){this.name=r,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Rb(r,t,n),this.decoder=new Cb(r,t,s)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const Co=({name:o,prefix:r,encode:t,decode:n})=>new Tb(o,r,t,n),os=({prefix:o,name:r,alphabet:t})=>{const{encode:n,decode:s}=Sb(t,r);return Co({prefix:o,name:r,encode:n,decode:c=>Vf(s(c))})},Nb=(o,r,t,n)=>{const s={};for(let S=0;S<r.length;++S)s[r[S]]=S;let c=o.length;for(;o[c-1]==="=";)--c;const l=new Uint8Array(c*t/8|0);let p=0,_=0,y=0;for(let S=0;S<c;++S){const D=s[o[S]];if(D===void 0)throw new SyntaxError(`Non-${n} character`);_=_<<t|D,p+=t,p>=8&&(p-=8,l[y++]=255&_>>p)}if(p>=t||255&_<<8-p)throw new SyntaxError("Unexpected end of data");return l},$b=(o,r,t)=>{const n=r[r.length-1]==="=",s=(1<<t)-1;let c="",l=0,p=0;for(let _=0;_<o.length;++_)for(p=p<<8|o[_],l+=8;l>t;)l-=t,c+=r[s&p>>l];if(l&&(c+=r[s&p<<t-l]),n)for(;c.length*t&7;)c+="=";return c},Vt=({name:o,prefix:r,bitsPerChar:t,alphabet:n})=>Co({prefix:r,name:o,encode(s){return $b(s,n,t)},decode(s){return Nb(s,n,t,o)}}),Lb=Co({prefix:"\0",name:"identity",encode:o=>Ob(o),decode:o=>Pb(o)});var Fb=Object.freeze({__proto__:null,identity:Lb});const Db=Vt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var jb=Object.freeze({__proto__:null,base2:Db});const qb=Vt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Mb=Object.freeze({__proto__:null,base8:qb});const zb=os({prefix:"9",name:"base10",alphabet:"0123456789"});var Ub=Object.freeze({__proto__:null,base10:zb});const Hb=Vt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),kb=Vt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Vb=Object.freeze({__proto__:null,base16:Hb,base16upper:kb});const Bb=Vt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Kb=Vt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Gb=Vt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Wb=Vt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Jb=Vt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Qb=Vt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Yb=Vt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Xb=Vt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Zb=Vt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var eE=Object.freeze({__proto__:null,base32:Bb,base32upper:Kb,base32pad:Gb,base32padupper:Wb,base32hex:Jb,base32hexupper:Qb,base32hexpad:Yb,base32hexpadupper:Xb,base32z:Zb});const tE=os({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),rE=os({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var iE=Object.freeze({__proto__:null,base36:tE,base36upper:rE});const nE=os({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),sE=os({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var oE=Object.freeze({__proto__:null,base58btc:nE,base58flickr:sE});const aE=Vt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),cE=Vt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),uE=Vt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),hE=Vt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var lE=Object.freeze({__proto__:null,base64:aE,base64pad:cE,base64url:uE,base64urlpad:hE});const Kf=Array.from(""),fE=Kf.reduce((o,r,t)=>(o[t]=r,o),[]),pE=Kf.reduce((o,r,t)=>(o[r.codePointAt(0)]=t,o),[]);function dE(o){return o.reduce((r,t)=>(r+=fE[t],r),"")}function gE(o){const r=[];for(const t of o){const n=pE[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);r.push(n)}return new Uint8Array(r)}const yE=Co({prefix:"",name:"base256emoji",encode:dE,decode:gE});var vE=Object.freeze({__proto__:null,base256emoji:yE}),_E=Gf,Pl=128,mE=127,wE=~mE,bE=Math.pow(2,31);function Gf(o,r,t){r=r||[],t=t||0;for(var n=t;o>=bE;)r[t++]=o&255|Pl,o/=128;for(;o&wE;)r[t++]=o&255|Pl,o>>>=7;return r[t]=o|0,Gf.bytes=t-n+1,r}var EE=Tc,xE=128,Ol=127;function Tc(o,n){var t=0,n=n||0,s=0,c=n,l,p=o.length;do{if(c>=p)throw Tc.bytes=0,new RangeError("Could not decode varint");l=o[c++],t+=s<28?(l&Ol)<<s:(l&Ol)*Math.pow(2,s),s+=7}while(l>=xE);return Tc.bytes=c-n,t}var IE=Math.pow(2,7),SE=Math.pow(2,14),PE=Math.pow(2,21),OE=Math.pow(2,28),RE=Math.pow(2,35),CE=Math.pow(2,42),AE=Math.pow(2,49),TE=Math.pow(2,56),NE=Math.pow(2,63),$E=function(o){return o<IE?1:o<SE?2:o<PE?3:o<OE?4:o<RE?5:o<CE?6:o<AE?7:o<TE?8:o<NE?9:10},LE={encode:_E,decode:EE,encodingLength:$E},Wf=LE;const Rl=(o,r,t=0)=>(Wf.encode(o,r,t),r),Cl=o=>Wf.encodingLength(o),Nc=(o,r)=>{const t=r.byteLength,n=Cl(o),s=n+Cl(t),c=new Uint8Array(s+t);return Rl(o,c,0),Rl(t,c,n),c.set(r,s),new FE(o,t,r,c)};class FE{constructor(r,t,n,s){this.code=r,this.size=t,this.digest=n,this.bytes=s}}const Jf=({name:o,code:r,encode:t})=>new DE(o,r,t);class DE{constructor(r,t,n){this.name=r,this.code=t,this.encode=n}digest(r){if(r instanceof Uint8Array){const t=this.encode(r);return t instanceof Uint8Array?Nc(this.code,t):t.then(n=>Nc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Qf=o=>async r=>new Uint8Array(await crypto.subtle.digest(o,r)),jE=Jf({name:"sha2-256",code:18,encode:Qf("SHA-256")}),qE=Jf({name:"sha2-512",code:19,encode:Qf("SHA-512")});var ME=Object.freeze({__proto__:null,sha256:jE,sha512:qE});const Yf=0,zE="identity",Xf=Vf,UE=o=>Nc(Yf,Xf(o)),HE={code:Yf,name:zE,encode:Xf,digest:UE};var kE=Object.freeze({__proto__:null,identity:HE});new TextEncoder,new TextDecoder;const Al={...Fb,...jb,...Mb,...Ub,...Vb,...eE,...iE,...oE,...lE,...vE};({...ME,...kE});function Zf(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function VE(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Zf(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function ep(o,r,t,n){return{name:o,prefix:r,encoder:{name:o,prefix:r,encode:t},decoder:{decode:n}}}const Tl=ep("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),cc=ep("ascii","a",o=>{let r="a";for(let t=0;t<o.length;t++)r+=String.fromCharCode(o[t]);return r},o=>{o=o.substring(1);const r=VE(o.length);for(let t=0;t<o.length;t++)r[t]=o.charCodeAt(t);return r}),BE={utf8:Tl,"utf-8":Tl,hex:Al.base16,latin1:cc,ascii:cc,binary:cc,...Al};function KE(o,r="utf8"){const t=BE[r];if(!t)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Zf(globalThis.Buffer.from(o,"utf-8")):t.decoder.decode(`${t.prefix}${o}`)}const tp="wc",GE=2,Kc="core",bi=`${tp}@2:${Kc}:`,WE={name:Kc,logger:"error"},JE={database:":memory:"},QE="crypto",Nl="client_ed25519_seed",YE=re.ONE_DAY,XE="keychain",ZE="0.3",ex="messages",tx="0.3",rx=re.SIX_HOURS,ix="publisher",rp="irn",nx="error",ip="wss://relay.walletconnect.com",$l="wss://relay.walletconnect.org",sx="relayer",Gt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ox="_subscription",si={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},ax=re.ONE_SECOND,cx="2.10.1",ux=1e4,hx="0.3",lx="WALLETCONNECT_CLIENT_ID",Vr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},fx="subscription",px="0.3",dx=re.FIVE_SECONDS*1e3,gx="pairing",yx="0.3",kn={wc_pairingDelete:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:re.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:re.ONE_DAY,prompt:!1,tag:0},res:{ttl:re.ONE_DAY,prompt:!1,tag:0}}},Jn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},kr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},vx="history",_x="0.3",mx="expirer",Or={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},wx="0.3",uc="verify-api",mo="https://verify.walletconnect.com",Ll="https://verify.walletconnect.org";class bx{constructor(r,t){this.core=r,this.logger=t,this.keychain=new Map,this.name=XE,this.version=ZE,this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,s)=>{this.isInitialized(),this.keychain.set(n,s),await this.persist()},this.get=n=>{this.isInitialized();const s=this.keychain.get(n);if(typeof s>"u"){const{message:c}=X("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(c)}return s},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=r,this.logger=Re.generateChildLogger(t,this.name)}get context(){return Re.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,pf(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?df(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Ex{constructor(r,t,n){this.core=r,this.logger=t,this.name=QE,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),c=_l(s);return Ff(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=K_();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const c=await this.getClientSeed(),l=_l(c),p=vc();return await Nw(p,s,YE,l)},this.generateSharedKey=(s,c,l)=>{this.isInitialized();const p=this.getPrivateKey(s),_=G_(p,c);return this.setSymKey(_,l)},this.setSymKey=async(s,c)=>{this.isInitialized();const l=c||W_(s);return await this.keychain.set(l,s),l},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,c,l)=>{this.isInitialized();const p=J_(l),_=rs(c);if(Qh(p)){const O=p.senderPublicKey,M=p.receiverPublicKey;s=await this.generateSharedKey(O,M)}const y=this.getSymKey(s),{type:S,senderPublicKey:D}=p;return Q_({type:S,symKey:y,message:_,senderPublicKey:D})},this.decode=async(s,c,l)=>{this.isInitialized();const p=Y_(c,l);if(Qh(p)){const _=p.receiverPublicKey,y=p.senderPublicKey;s=await this.generateSharedKey(_,y)}try{const _=this.getSymKey(s),y=X_({symKey:_,encoded:c});return zc(y)}catch(_){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(_)}},this.getPayloadType=s=>{const c=Yh(s);return Z_(c.type)},this.getPayloadSenderPublicKey=s=>{const c=Yh(s);return c.senderPublicKey?xo(c.senderPublicKey,e1):void 0},this.core=r,this.logger=Re.generateChildLogger(t,this.name),this.keychain=n||new bx(this.core,this.logger)}get context(){return Re.getLoggerContext(this.logger)}async setPrivateKey(r,t){return await this.keychain.set(r,t),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(Nl)}catch{r=vc(),await this.keychain.set(Nl,r)}return KE(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}}class xx extends cw{constructor(r,t){super(r,t),this.logger=r,this.core=t,this.messages=new Map,this.name=ex,this.version=tx,this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,s)=>{this.isInitialized();const c=pn(s);let l=this.messages.get(n);return typeof l>"u"&&(l={}),typeof l[c]<"u"||(l[c]=s,this.messages.set(n,l),await this.persist()),c},this.get=n=>{this.isInitialized();let s=this.messages.get(n);return typeof s>"u"&&(s={}),s},this.has=(n,s)=>{this.isInitialized();const c=this.get(n),l=pn(s);return typeof c[l]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Re.generateChildLogger(r,this.name),this.core=t}get context(){return Re.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,pf(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?df(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Ix extends uw{constructor(r,t){super(r,t),this.relayer=r,this.logger=t,this.events=new vr.EventEmitter,this.name=ix,this.queue=new Map,this.publishTimeout=re.toMiliseconds(re.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,s,c)=>{var l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:s,opts:c}});try{const p=(c==null?void 0:c.ttl)||rx,_=_c(c),y=(c==null?void 0:c.prompt)||!1,S=(c==null?void 0:c.tag)||0,D=(c==null?void 0:c.id)||Uf().toString(),O={topic:n,message:s,opts:{ttl:p,relay:_,prompt:y,tag:S,id:D}},M=setTimeout(()=>this.queue.set(D,O),this.publishTimeout);try{await await Xn(this.rpcPublish(n,s,p,_,y,S,D),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(D),this.relayer.events.emit(Gt.publish,O)}catch(U){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(l=c==null?void 0:c.internal)!=null&&l.throwOnFailedPublish)throw this.removeRequestFromQueue(D),U;return}finally{clearTimeout(M)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:s,opts:c}})}catch(p){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(p),p}},this.on=(n,s)=>{this.events.on(n,s)},this.once=(n,s)=>{this.events.once(n,s)},this.off=(n,s)=>{this.events.off(n,s)},this.removeListener=(n,s)=>{this.events.removeListener(n,s)},this.relayer=r,this.logger=Re.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return Re.getLoggerContext(this.logger)}rpcPublish(r,t,n,s,c,l,p){var _,y,S,D;const O={method:yo(s.protocol).publish,params:{topic:r,message:t,ttl:n,prompt:c,tag:l},id:p};return wi((_=O.params)==null?void 0:_.prompt)&&((y=O.params)==null||delete y.prompt),wi((S=O.params)==null?void 0:S.tag)&&((D=O.params)==null||delete D.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:O}),this.relayer.request(O)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:t,message:n,opts:s}=r;await this.publish(t,n,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(vn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Gt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Gt.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class Sx{constructor(){this.map=new Map,this.set=(r,t)=>{const n=this.get(r);this.exists(r,t)||this.map.set(r,[...n,t])},this.get=r=>this.map.get(r)||[],this.exists=(r,t)=>this.get(r).includes(t),this.delete=(r,t)=>{if(typeof t>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const n=this.get(r);if(!this.exists(r,t))return;const s=n.filter(c=>c!==t);if(!s.length){this.map.delete(r);return}this.map.set(r,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Px=Object.defineProperty,Ox=Object.defineProperties,Rx=Object.getOwnPropertyDescriptors,Fl=Object.getOwnPropertySymbols,Cx=Object.prototype.hasOwnProperty,Ax=Object.prototype.propertyIsEnumerable,Dl=(o,r,t)=>r in o?Px(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,Vn=(o,r)=>{for(var t in r||(r={}))Cx.call(r,t)&&Dl(o,t,r[t]);if(Fl)for(var t of Fl(r))Ax.call(r,t)&&Dl(o,t,r[t]);return o},hc=(o,r)=>Ox(o,Rx(r));class Tx extends fw{constructor(r,t){super(r,t),this.relayer=r,this.logger=t,this.subscriptions=new Map,this.topicMap=new Sx,this.events=new vr.EventEmitter,this.name=fx,this.version=px,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=bi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,s)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}});try{const c=_c(s),l={topic:n,relay:c};this.pending.set(n,l);const p=await this.rpcSubscribe(n,c);return this.onSubscribe(p,l),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}}),p}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(n,s)=>{await this.restartToComplete(),this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(n,s.id,s):await this.unsubscribeByTopic(n,s)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((s,c)=>{const l=new re.Watch;l.start(this.pendingSubscriptionWatchLabel);const p=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(p),l.stop(this.pendingSubscriptionWatchLabel),s(!0)),l.elapsed(this.pendingSubscriptionWatchLabel)>=dx&&(clearInterval(p),l.stop(this.pendingSubscriptionWatchLabel),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,s)=>{this.events.on(n,s)},this.once=(n,s)=>{this.events.once(n,s)},this.off=(n,s)=>{this.events.off(n,s)},this.removeListener=(n,s)=>{this.events.removeListener(n,s)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=Re.generateChildLogger(t,this.name),this.clientId=""}get context(){return Re.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,t){let n=!1;try{n=this.getSubscription(r).topic===t}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,t){const n=this.topicMap.get(r);await Promise.all(n.map(async s=>await this.unsubscribeById(r,s,t)))}async unsubscribeById(r,t,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:t,opts:n}});try{const s=_c(n);await this.rpcUnsubscribe(r,t,s);const c=tr("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,t,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:t,opts:n}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(r,t){const n={method:yo(t.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Xn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}return pn(r+this.clientId)}async rpcBatchSubscribe(r){if(!r.length)return;const t=r[0].relay,n={method:yo(t.protocol).batchSubscribe,params:{topics:r.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Xn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}}rpcUnsubscribe(r,t,n){const s={method:yo(n.protocol).unsubscribe,params:{topic:r,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(r,t){this.setSubscription(r,hc(Vn({},t),{id:r})),this.pending.delete(t.topic)}onBatchSubscribe(r){r.length&&r.forEach(t=>{this.setSubscription(t.id,Vn({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(r,t,n){this.events.removeAllListeners(t),this.hasSubscription(t,r)&&this.deleteSubscription(t,n),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,t){this.subscriptions.has(r)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:t}),this.addSubscription(r,t))}addSubscription(r,t){this.subscriptions.set(r,Vn({},t)),this.topicMap.set(t.topic,r),this.events.emit(Vr.created,t)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const t=this.subscriptions.get(r);if(!t){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return t}deleteSubscription(r,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:t});const n=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(n.topic,r),this.events.emit(Vr.deleted,hc(Vn({},n),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Vr.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<r;t++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Vr.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:t}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const t=await this.rpcBatchSubscribe(r);yn(t)&&this.onBatchSubscribe(t.map((n,s)=>hc(Vn({},r[s]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const r=[];this.pending.forEach(t=>{r.push(t)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(vn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Gt.connect,async()=>{await this.onConnect()}),this.relayer.on(Gt.disconnect,()=>{this.onDisconnect()}),this.events.on(Vr.created,async r=>{const t=Vr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),await this.persist()}),this.events.on(Vr.deleted,async r=>{const t=Vr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),r())},this.pollingInterval)})}}var Nx=Object.defineProperty,jl=Object.getOwnPropertySymbols,$x=Object.prototype.hasOwnProperty,Lx=Object.prototype.propertyIsEnumerable,ql=(o,r,t)=>r in o?Nx(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,Fx=(o,r)=>{for(var t in r||(r={}))$x.call(r,t)&&ql(o,t,r[t]);if(jl)for(var t of jl(r))Lx.call(r,t)&&ql(o,t,r[t]);return o};class Dx extends hw{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new vr.EventEmitter,this.name=sx,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async t=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(t)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=t=>{this.onProviderPayload(t)},this.onConnectHandler=()=>{this.events.emit(Gt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=t=>{this.logger.error(t),this.events.emit(Gt.error,t),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(si.payload,this.onPayloadHandler),this.provider.on(si.connect,this.onConnectHandler),this.provider.on(si.disconnect,this.onDisconnectHandler),this.provider.on(si.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?Re.generateChildLogger(r.logger,this.name):Re.pino(Re.getDefaultLoggerOptions({level:r.logger||nx})),this.messages=new xx(this.logger,r.core),this.subscriber=new Tx(this,this.logger),this.publisher=new Ix(this,this.logger),this.relayUrl=(r==null?void 0:r.relayUrl)||ip,this.projectId=r.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${$l}...`),await this.restartTransport($l)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},ux)}get context(){return Re.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(r,t,n){this.isInitialized(),await this.publisher.publish(r,t,n),await this.recordMessageEvent({topic:r,message:t,publishedAt:Date.now()})}async subscribe(r,t){var n;this.isInitialized();let s=((n=this.subscriber.topicMap.get(r))==null?void 0:n[0])||"";return s||(await Promise.all([new Promise(c=>{this.subscriber.once(Vr.created,l=>{l.topic===r&&c()})}),new Promise(async c=>{s=await this.subscriber.subscribe(r,t),c()})]),s)}async unsubscribe(r,t){this.isInitialized(),await this.subscriber.unsubscribe(r,t)}on(r,t){this.events.on(r,t)}once(r,t){this.events.once(r,t)}off(r,t){this.events.off(r,t)}removeListener(r,t){this.events.removeListener(r,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Xn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(r){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(t=>{if(!this.initialized)return t();this.subscriber.once(Vr.resubscribed,()=>{t()})}),new Promise(async(t,n)=>{try{await Xn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(s){n(s);return}t()})])}catch(t){this.logger.error(t);const n=t;if(!this.isConnectionStalled(n.message))throw t;this.provider.events.emit(si.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(r){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=r||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Xh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(r){return this.staleConnectionErrors.some(t=>r.includes(t))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ei(new wb(t1({sdkVersion:cx,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:t,message:n}=r;await this.messages.set(t,n)}async shouldIgnoreMessageEvent(r){const{topic:t,message:n}=r;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.debug(`Ignoring message for non-subscribed topic ${t}`),!0;const s=this.messages.has(t,n);return s&&this.logger.debug(`Ignoring duplicate message: ${n}`),s}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),Bc(r)){if(!r.method.endsWith(ox))return;const t=r.params,{topic:n,message:s,publishedAt:c}=t.data,l={topic:n,message:s,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Fx({type:"event",event:t.id},l)),this.events.emit(t.id,l),await this.acknowledgePayload(r),await this.onMessageEvent(l)}else Ro(r)&&this.events.emit(Gt.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(Gt.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const t=Vc(r.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(si.payload,this.onPayloadHandler),this.provider.off(si.connect,this.onConnectHandler),this.provider.off(si.disconnect,this.onDisconnectHandler),this.provider.off(si.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Gt.connection_stalled,()=>{this.restartTransport().catch(t=>this.logger.error(t))});let r=await Xh();r1(async t=>{this.initialized&&r!==t&&(r=t,t?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Gt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(r=>this.logger.error(r))},re.toMiliseconds(ax)))}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(r=>{const t=setInterval(()=>{this.connected&&(clearInterval(t),r())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var jx=Object.defineProperty,Ml=Object.getOwnPropertySymbols,qx=Object.prototype.hasOwnProperty,Mx=Object.prototype.propertyIsEnumerable,zl=(o,r,t)=>r in o?jx(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,Ul=(o,r)=>{for(var t in r||(r={}))qx.call(r,t)&&zl(o,t,r[t]);if(Ml)for(var t of Ml(r))Mx.call(r,t)&&zl(o,t,r[t]);return o};class Ao extends lw{constructor(r,t,n,s=bi,c=void 0){super(r,t,n,s),this.core=r,this.logger=t,this.name=n,this.map=new Map,this.version=hx,this.cached=[],this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(l=>{this.getKey&&l!==null&&!wi(l)?this.map.set(this.getKey(l),l):V_(l)?this.map.set(l.id,l):B_(l)&&this.map.set(l.topic,l)}),this.cached=[],this.initialized=!0)},this.set=async(l,p)=>{this.isInitialized(),this.map.has(l)?await this.update(l,p):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:l,value:p}),this.map.set(l,p),await this.persist())},this.get=l=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:l}),this.getData(l)),this.getAll=l=>(this.isInitialized(),l?this.values.filter(p=>Object.keys(l).every(_=>Eb(p[_],l[_]))):this.values),this.update=async(l,p)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:l,update:p});const _=Ul(Ul({},this.getData(l)),p);this.map.set(l,_),await this.persist()},this.delete=async(l,p)=>{this.isInitialized(),this.map.has(l)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:l,reason:p}),this.map.delete(l),await this.persist())},this.logger=Re.generateChildLogger(t,this.name),this.storagePrefix=s,this.getKey=c}get context(){return Re.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const t=this.map.get(r);if(!t){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:t}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}}class zx{constructor(r,t){this.core=r,this.logger=t,this.name=gx,this.version=yx,this.events=new Mc,this.initialized=!1,this.storagePrefix=bi,this.ignoredPayloadTypes=[hf],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=vc(),s=await this.core.crypto.setSymKey(n),c=Lr(re.FIVE_MINUTES),l={protocol:rp},p={topic:s,expiry:c,relay:l,active:!1},_=i1({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:n,relay:l});return await this.pairings.set(s,p),await this.core.relayer.subscribe(s),this.core.expirer.set(s,c),{topic:s,uri:_}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:s,symKey:c,relay:l}=n1(n.uri);let p;if(this.pairings.keys.includes(s)&&(p=this.pairings.get(s),p.active))throw new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(s)||(await this.core.crypto.setSymKey(c,s),await this.core.relayer.subscribe(s,{relay:l}));const _=Lr(re.FIVE_MINUTES),y={topic:s,relay:l,expiry:_,active:!1};return await this.pairings.set(s,y),this.core.expirer.set(s,_),n.activatePairing&&await this.activate({topic:s}),this.events.emit(Jn.create,y),y},this.activate=async({topic:n})=>{this.isInitialized();const s=Lr(re.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:s}),this.core.expirer.set(n,s)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:s}=n;if(this.pairings.keys.includes(s)){const c=await this.sendRequest(s,"wc_pairingPing",{}),{done:l,resolve:p,reject:_}=hn();this.events.once(Lt("pairing_ping",c),({error:y})=>{y?_(y):p()}),await l()}},this.updateExpiry=async({topic:n,expiry:s})=>{this.isInitialized(),await this.pairings.update(n,{expiry:s})},this.updateMetadata=async({topic:n,metadata:s})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:s}=n;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",tr("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(n,s,c)=>{const l=gn(s,c),p=await this.core.crypto.encode(n,l),_=kn[s].req;return this.core.history.set(n,l),this.core.relayer.publish(n,p,_),l.id},this.sendResult=async(n,s,c)=>{const l=Vc(n,c),p=await this.core.crypto.encode(s,l),_=await this.core.history.get(s,n),y=kn[_.request.method].res;await this.core.relayer.publish(s,p,y),await this.core.history.resolve(l)},this.sendError=async(n,s,c)=>{const l=Oo(n,c),p=await this.core.crypto.encode(s,l),_=await this.core.history.get(s,n),y=kn[_.request.method]?kn[_.request.method].res:kn.unregistered_method.res;await this.core.relayer.publish(s,p,y),await this.core.history.resolve(l)},this.deletePairing=async(n,s)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,tr("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),s?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(s=>mi(s.expiry));await Promise.all(n.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=n=>{const{topic:s,payload:c}=n;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(s,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,c);default:return this.onUnknownRpcMethodRequest(s,c)}},this.onRelayEventResponse=async n=>{const{topic:s,payload:c}=n,l=(await this.core.history.get(s,c.id)).request.method;switch(l){case"wc_pairingPing":return this.onPairingPingResponse(s,c);default:return this.onUnknownRpcMethodResponse(l)}},this.onPairingPingRequest=async(n,s)=>{const{id:c}=s;try{this.isValidPing({topic:n}),await this.sendResult(c,n,!0),this.events.emit(Jn.ping,{id:c,topic:n})}catch(l){await this.sendError(c,n,l),this.logger.error(l)}},this.onPairingPingResponse=(n,s)=>{const{id:c}=s;setTimeout(()=>{ai(s)?this.events.emit(Lt("pairing_ping",c),{}):Fr(s)&&this.events.emit(Lt("pairing_ping",c),{error:s.error})},500)},this.onPairingDeleteRequest=async(n,s)=>{const{id:c}=s;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Jn.delete,{id:c,topic:n})}catch(l){await this.sendError(c,n,l),this.logger.error(l)}},this.onUnknownRpcMethodRequest=async(n,s)=>{const{id:c,method:l}=s;try{if(this.registeredMethods.includes(l))return;const p=tr("WC_METHOD_UNSUPPORTED",l);await this.sendError(c,n,p),this.logger.error(p)}catch(p){await this.sendError(c,n,p),this.logger.error(p)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(tr("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!ur(n)){const{message:s}=X("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(s)}if(!s1(n.uri)){const{message:s}=X("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(s)}},this.isValidPing=async n=>{if(!ur(n)){const{message:c}=X("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(c)}const{topic:s}=n;await this.isValidPairingTopic(s)},this.isValidDisconnect=async n=>{if(!ur(n)){const{message:c}=X("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(c)}const{topic:s}=n;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async n=>{if(!ln(n,!1)){const{message:s}=X("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(s)}if(!this.pairings.keys.includes(n)){const{message:s}=X("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(s)}if(mi(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:s}=X("EXPIRED",`pairing topic: ${n}`);throw new Error(s)}},this.core=r,this.logger=Re.generateChildLogger(t,this.name),this.pairings=new Ao(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Re.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(Gt.message,async r=>{const{topic:t,message:n}=r;if(!this.pairings.keys.includes(t)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const s=await this.core.crypto.decode(t,n);try{Bc(s)?(this.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):Ro(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:t,payload:s}),this.core.history.delete(t,s.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(Or.expired,async r=>{const{topic:t}=lf(r.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(Jn.expire,{topic:t}))})}}class Ux extends aw{constructor(r,t){super(r,t),this.core=r,this.logger=t,this.records=new Map,this.events=new vr.EventEmitter,this.name=vx,this.version=_x,this.cached=[],this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,s,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:s,chainId:c}),this.records.has(s.id))return;const l={id:s.id,topic:n,request:{method:s.method,params:s.params||null},chainId:c,expiry:Lr(re.THIRTY_DAYS)};this.records.set(l.id,l),this.events.emit(kr.created,l)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const s=await this.getRecord(n.id);typeof s.response>"u"&&(s.response=Fr(n)?{error:n.error}:{result:n.result},this.records.set(s.id,s),this.events.emit(kr.updated,s))},this.get=async(n,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:s}),await this.getRecord(s)),this.delete=(n,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(c=>{if(c.topic===n){if(typeof s<"u"&&c.id!==s)return;this.records.delete(c.id),this.events.emit(kr.deleted,c)}})},this.exists=async(n,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===n:!1),this.on=(n,s)=>{this.events.on(n,s)},this.once=(n,s)=>{this.events.once(n,s)},this.off=(n,s)=>{this.events.off(n,s)},this.removeListener=(n,s)=>{this.events.removeListener(n,s)},this.logger=Re.generateChildLogger(t,this.name)}get context(){return Re.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const n={topic:t.topic,request:gn(t.request.method,t.request.params,t.id),chainId:t.chainId};return r.push(n)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const t=this.records.get(r);if(!t){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(kr.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:t}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(kr.created,r=>{const t=kr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:r}),this.persist()}),this.events.on(kr.updated,r=>{const t=kr.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:r}),this.persist()}),this.events.on(kr.deleted,r=>{const t=kr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:r}),this.persist()}),this.core.heartbeat.on(vn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(r=>{re.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.delete(r.topic,r.id))})}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Hx extends pw{constructor(r,t){super(r,t),this.core=r,this.logger=t,this.expirations=new Map,this.events=new vr.EventEmitter,this.name=mx,this.version=wx,this.cached=[],this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const s=this.formatTarget(n);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(n,s)=>{this.isInitialized();const c=this.formatTarget(n),l={target:c,expiry:s};this.expirations.set(c,l),this.checkExpiry(c,l),this.events.emit(Or.created,{target:c,expiration:l})},this.get=n=>{this.isInitialized();const s=this.formatTarget(n);return this.getExpiration(s)},this.del=n=>{if(this.isInitialized(),this.has(n)){const s=this.formatTarget(n),c=this.getExpiration(s);this.expirations.delete(s),this.events.emit(Or.deleted,{target:s,expiration:c})}},this.on=(n,s)=>{this.events.on(n,s)},this.once=(n,s)=>{this.events.once(n,s)},this.off=(n,s)=>{this.events.off(n,s)},this.removeListener=(n,s)=>{this.events.removeListener(n,s)},this.logger=Re.generateChildLogger(t,this.name)}get context(){return Re.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return o1(r);if(typeof r=="number")return a1(r);const{message:t}=X("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(t)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Or.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:t}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const t=this.expirations.get(r);if(!t){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return t}checkExpiry(r,t){const{expiry:n}=t;re.toMiliseconds(n)-Date.now()<=0&&this.expire(r,t)}expire(r,t){this.expirations.delete(r),this.events.emit(Or.expired,{target:r,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,t)=>this.checkExpiry(t,r))}registerEventListeners(){this.core.heartbeat.on(vn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Or.created,r=>{const t=Or.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),this.persist()}),this.events.on(Or.expired,r=>{const t=Or.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),this.persist()}),this.events.on(Or.deleted,r=>{const t=Or.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}}class kx extends dw{constructor(r,t){super(r,t),this.projectId=r,this.logger=t,this.name=uc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||c1()||!ff())return;const s=(n==null?void 0:n.verifyUrl)||mo;this.verifyUrl!==s&&this.removeIframe(),this.verifyUrl=s;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Ll;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const s=(n==null?void 0:n.verifyUrl)||mo;let c;try{c=await this.fetchAttestation(n.attestationId,s)}catch(l){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${s}`),this.logger.info(l),c=await this.fetchAttestation(n.attestationId,Ll)}return c},this.fetchAttestation=async(n,s)=>{this.logger.info(`resolving attestation: ${n} from url: ${s}`);const c=this.startAbortTimer(re.ONE_SECOND*2),l=await fetch(`${s}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(c),l.status===200?await l.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var s;try{if(!this.iframe)return;(s=this.iframe.contentWindow)==null||s.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const s=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",s),n())};await Promise.race([new Promise(c=>{if(document.getElementById(uc))return c();window.addEventListener("message",s);const l=document.createElement("iframe");l.id=uc,l.src=`${this.verifyUrl}/${this.projectId}`,l.style.display="none",document.body.append(l),this.iframe=l,n=c}),new Promise((c,l)=>setTimeout(()=>{window.removeEventListener("message",s),l("verify iframe load timeout")},re.toMiliseconds(re.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Re.generateChildLogger(t,this.name),this.verifyUrl=mo,this.abortController=new AbortController,this.isDevEnv=u1()&&{}.IS_VITEST}get context(){return Re.getLoggerContext(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),re.toMiliseconds(r))}}var Vx=Object.defineProperty,Hl=Object.getOwnPropertySymbols,Bx=Object.prototype.hasOwnProperty,Kx=Object.prototype.propertyIsEnumerable,kl=(o,r,t)=>r in o?Vx(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,Vl=(o,r)=>{for(var t in r||(r={}))Bx.call(r,t)&&kl(o,t,r[t]);if(Hl)for(var t of Hl(r))Kx.call(r,t)&&kl(o,t,r[t]);return o};class Gc extends ow{constructor(r){super(r),this.protocol=tp,this.version=GE,this.name=Kc,this.events=new vr.EventEmitter,this.initialized=!1,this.on=(n,s)=>this.events.on(n,s),this.once=(n,s)=>this.events.once(n,s),this.off=(n,s)=>this.events.off(n,s),this.removeListener=(n,s)=>this.events.removeListener(n,s),this.projectId=r==null?void 0:r.projectId,this.relayUrl=(r==null?void 0:r.relayUrl)||ip;const t=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Re.pino(Re.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||WE.logger}));this.logger=Re.generateChildLogger(t,this.name),this.heartbeat=new vn.HeartBeat,this.crypto=new Ex(this,this.logger,r==null?void 0:r.keychain),this.history=new Ux(this,this.logger),this.expirer=new Hx(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new hm(Vl(Vl({},JE),r==null?void 0:r.storageOptions)),this.relayer=new Dx({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new zx(this,this.logger),this.verify=new kx(this.projectId||"",this.logger)}static async init(r){const t=new Gc(r);await t.initialize();const n=await t.crypto.getClientId();return await t.storage.setItem(lx,n),t}get context(){return Re.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const Gx=Gc,np="wc",sp=2,op="client",Wc=`${np}@${sp}:${op}:`,lc={name:op,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Bl="WALLETCONNECT_DEEPLINK_CHOICE",Wx="proposal",ap="Proposal expired",Jx="session",fo=re.SEVEN_DAYS,Qx="engine",Bn={wc_sessionPropose:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1104},res:{ttl:re.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1106},res:{ttl:re.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1112},res:{ttl:re.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1115}}},fc={min:re.FIVE_MINUTES,max:re.SEVEN_DAYS},oi={idle:"IDLE",active:"ACTIVE"},Yx="request",Xx=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Zx=Object.defineProperty,eI=Object.defineProperties,tI=Object.getOwnPropertyDescriptors,Kl=Object.getOwnPropertySymbols,rI=Object.prototype.hasOwnProperty,iI=Object.prototype.propertyIsEnumerable,Gl=(o,r,t)=>r in o?Zx(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,cr=(o,r)=>{for(var t in r||(r={}))rI.call(r,t)&&Gl(o,t,r[t]);if(Kl)for(var t of Kl(r))iI.call(r,t)&&Gl(o,t,r[t]);return o},Kn=(o,r)=>eI(o,tI(r));class nI extends yw{constructor(r){super(r),this.name=Qx,this.events=new Mc,this.initialized=!1,this.ignoredPayloadTypes=[hf],this.requestQueue={state:oi.idle,queue:[]},this.sessionRequestQueue={state:oi.idle,queue:[]},this.requestQueueDelay=re.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Bn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},re.toMiliseconds(this.requestQueueDelay)))},this.connect=async t=>{await this.isInitialized();const n=Kn(cr({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:s,requiredNamespaces:c,optionalNamespaces:l,sessionProperties:p,relays:_}=n;let y=s,S,D=!1;if(y&&(D=this.client.core.pairing.pairings.get(y).active),!y||!D){const{topic:pe,uri:ue}=await this.client.core.pairing.create();y=pe,S=ue}const O=await this.client.core.crypto.generateKeyPair(),M=cr({requiredNamespaces:c,optionalNamespaces:l,relays:_??[{protocol:rp}],proposer:{publicKey:O,metadata:this.client.metadata}},p&&{sessionProperties:p}),{reject:U,resolve:V,done:oe}=hn(re.FIVE_MINUTES,ap);if(this.events.once(Lt("session_connect"),async({error:pe,session:ue})=>{if(pe)U(pe);else if(ue){ue.self.publicKey=O;const he=Kn(cr({},ue),{requiredNamespaces:ue.requiredNamespaces,optionalNamespaces:ue.optionalNamespaces});await this.client.session.set(ue.topic,he),await this.setExpiry(ue.topic,ue.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:ue.peer.metadata}),V(he)}}),!y){const{message:pe}=X("NO_MATCHING_KEY",`connect() pairing topic: ${y}`);throw new Error(pe)}const be=await this.sendRequest({topic:y,method:"wc_sessionPropose",params:M}),de=Lr(re.FIVE_MINUTES);return await this.setProposal(be,cr({id:be,expiry:de},M)),{uri:S,approval:oe}},this.pair=async t=>(await this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{await this.isInitialized(),await this.isValidApprove(t);const{id:n,relayProtocol:s,namespaces:c,sessionProperties:l}=t,p=this.client.proposal.get(n);let{pairingTopic:_,proposer:y,requiredNamespaces:S,optionalNamespaces:D}=p;_=_||"",vo(S)||(S=l1(c,"approve()"));const O=await this.client.core.crypto.generateKeyPair(),M=y.publicKey,U=await this.client.core.crypto.generateSharedKey(O,M);_&&n&&(await this.client.core.pairing.updateMetadata({topic:_,metadata:y.metadata}),await this.sendResult({id:n,topic:_,result:{relay:{protocol:s??"irn"},responderPublicKey:O}}),await this.client.proposal.delete(n,tr("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:_}));const V=cr({relay:{protocol:s??"irn"},namespaces:c,requiredNamespaces:S,optionalNamespaces:D,pairingTopic:_,controller:{publicKey:O,metadata:this.client.metadata},expiry:Lr(fo)},l&&{sessionProperties:l});await this.client.core.relayer.subscribe(U),await this.sendRequest({topic:U,method:"wc_sessionSettle",params:V,throwOnFailedPublish:!0});const oe=Kn(cr({},V),{topic:U,pairingTopic:_,acknowledged:!1,self:V.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:O});return await this.client.session.set(U,oe),await this.setExpiry(U,Lr(fo)),{topic:U,acknowledged:()=>new Promise(be=>setTimeout(()=>be(this.client.session.get(U)),500))}},this.reject=async t=>{await this.isInitialized(),await this.isValidReject(t);const{id:n,reason:s}=t,{pairingTopic:c}=this.client.proposal.get(n);c&&(await this.sendError(n,c,s),await this.client.proposal.delete(n,tr("USER_DISCONNECTED")))},this.update=async t=>{await this.isInitialized(),await this.isValidUpdate(t);const{topic:n,namespaces:s}=t,c=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:s}}),{done:l,resolve:p,reject:_}=hn();return this.events.once(Lt("session_update",c),({error:y})=>{y?_(y):p()}),await this.client.session.update(n,{namespaces:s}),{acknowledged:l}},this.extend=async t=>{await this.isInitialized(),await this.isValidExtend(t);const{topic:n}=t,s=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:c,resolve:l,reject:p}=hn();return this.events.once(Lt("session_extend",s),({error:_})=>{_?p(_):l()}),await this.setExpiry(n,Lr(fo)),{acknowledged:c}},this.request=async t=>{await this.isInitialized(),await this.isValidRequest(t);const{chainId:n,request:s,topic:c,expiry:l}=t,p=kc(),{done:_,resolve:y,reject:S}=hn(l);return this.events.once(Lt("session_request",p),({error:D,result:O})=>{D?S(D):y(O)}),await Promise.all([new Promise(async D=>{await this.sendRequest({clientRpcId:p,topic:c,method:"wc_sessionRequest",params:{request:s,chainId:n},expiry:l,throwOnFailedPublish:!0}).catch(O=>S(O)),this.client.events.emit("session_request_sent",{topic:c,request:s,chainId:n,id:p}),D()}),new Promise(async D=>{const O=await this.client.core.storage.getItem(Bl);f1({id:p,topic:c,wcDeepLink:O}),D()}),_()]).then(D=>D[2])},this.respond=async t=>{await this.isInitialized(),await this.isValidRespond(t);const{topic:n,response:s}=t,{id:c}=s;ai(s)?await this.sendResult({id:c,topic:n,result:s.result,throwOnFailedPublish:!0}):Fr(s)&&await this.sendError(c,n,s.error),this.cleanupAfterResponse(t)},this.ping=async t=>{await this.isInitialized(),await this.isValidPing(t);const{topic:n}=t;if(this.client.session.keys.includes(n)){const s=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:c,resolve:l,reject:p}=hn();this.events.once(Lt("session_ping",s),({error:_})=>{_?p(_):l()}),await c()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async t=>{await this.isInitialized(),await this.isValidEmit(t);const{topic:n,event:s,chainId:c}=t;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:s,chainId:c}})},this.disconnect=async t=>{await this.isInitialized(),await this.isValidDisconnect(t);const{topic:n}=t;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:tr("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(n=>p1(n,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async t=>{if(t.pairingTopic)try{const n=this.client.core.pairing.pairings.get(t.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(c=>{var l,p;return((l=c.peerMetadata)==null?void 0:l.url)&&((p=c.peerMetadata)==null?void 0:p.url)===t.peer.metadata.url&&c.topic&&c.topic!==n.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(t,n)=>{const{self:s}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),this.client.session.delete(t,tr("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(s.publicKey)&&await this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.keychain.has(t)&&await this.client.core.crypto.deleteSymKey(t),n||this.client.core.expirer.del(t),this.client.core.storage.removeItem(Bl).catch(c=>this.client.logger.warn(c))},this.deleteProposal=async(t,n)=>{await Promise.all([this.client.proposal.delete(t,tr("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,n,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,n),s?Promise.resolve():this.client.core.expirer.del(t)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==t),s&&(this.sessionRequestQueue.state=oi.idle)},this.setExpiry=async(t,n)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:n}),this.client.core.expirer.set(t,n)},this.setProposal=async(t,n)=>{await this.client.proposal.set(t,n),this.client.core.expirer.set(t,n.expiry)},this.setPendingSessionRequest=async t=>{const n=Bn.wc_sessionRequest.req.ttl,{id:s,topic:c,params:l,verifyContext:p}=t;await this.client.pendingRequest.set(s,{id:s,topic:c,params:l,verifyContext:p}),n&&this.client.core.expirer.set(s,Lr(n))},this.sendRequest=async t=>{const{topic:n,method:s,params:c,expiry:l,relayRpcId:p,clientRpcId:_,throwOnFailedPublish:y}=t,S=gn(s,c,_);if(ff()&&Xx.includes(s)){const M=pn(JSON.stringify(S));this.client.core.verify.register({attestationId:M})}const D=await this.client.core.crypto.encode(n,S),O=Bn[s].req;return l&&(O.ttl=l),p&&(O.id=p),this.client.core.history.set(n,S),y?(O.internal=Kn(cr({},O.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,D,O)):this.client.core.relayer.publish(n,D,O).catch(M=>this.client.logger.error(M)),S.id},this.sendResult=async t=>{const{id:n,topic:s,result:c,throwOnFailedPublish:l}=t,p=Vc(n,c),_=await this.client.core.crypto.encode(s,p),y=await this.client.core.history.get(s,n),S=Bn[y.request.method].res;l?(S.internal=Kn(cr({},S.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,_,S)):this.client.core.relayer.publish(s,_,S).catch(D=>this.client.logger.error(D)),await this.client.core.history.resolve(p)},this.sendError=async(t,n,s)=>{const c=Oo(t,s),l=await this.client.core.crypto.encode(n,c),p=await this.client.core.history.get(n,t),_=Bn[p.request.method].res;this.client.core.relayer.publish(n,l,_),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const t=[],n=[];this.client.session.getAll().forEach(s=>{mi(s.expiry)&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{mi(s.expiry)&&n.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession(s)),...n.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===oi.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=oi.active;const t=this.requestQueue.queue.shift();if(t)try{this.processRequest(t),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=oi.idle},this.processRequest=t=>{const{topic:n,payload:s}=t,c=s.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(n,s);case"wc_sessionSettle":return this.onSessionSettleRequest(n,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,s);case"wc_sessionExtend":return this.onSessionExtendRequest(n,s);case"wc_sessionPing":return this.onSessionPingRequest(n,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,s);case"wc_sessionRequest":return this.onSessionRequest(n,s);case"wc_sessionEvent":return this.onSessionEventRequest(n,s);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async t=>{const{topic:n,payload:s}=t,c=(await this.client.core.history.get(n,s.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(n,s);case"wc_sessionSettle":return this.onSessionSettleResponse(n,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,s);case"wc_sessionExtend":return this.onSessionExtendResponse(n,s);case"wc_sessionPing":return this.onSessionPingResponse(n,s);case"wc_sessionRequest":return this.onSessionRequestResponse(n,s);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=t=>{const{topic:n}=t,{message:s}=X("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)},this.onSessionProposeRequest=async(t,n)=>{const{params:s,id:c}=n;try{this.isValidConnect(cr({},n.params));const l=Lr(re.FIVE_MINUTES),p=cr({id:c,pairingTopic:t,expiry:l},s);await this.setProposal(c,p);const _=pn(JSON.stringify(n)),y=await this.getVerifyContext(_,p.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:p,verifyContext:y})}catch(l){await this.sendError(c,t,l),this.client.logger.error(l)}},this.onSessionProposeResponse=async(t,n)=>{const{id:s}=n;if(ai(n)){const{result:c}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const l=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:l});const p=l.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:p});const _=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:_});const y=await this.client.core.crypto.generateSharedKey(p,_);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:y});const S=await this.client.core.relayer.subscribe(y);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:S}),await this.client.core.pairing.activate({topic:t})}else Fr(n)&&(await this.client.proposal.delete(s,tr("USER_DISCONNECTED")),this.events.emit(Lt("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(t,n)=>{const{id:s,params:c}=n;try{this.isValidSessionSettleRequest(c);const{relay:l,controller:p,expiry:_,namespaces:y,requiredNamespaces:S,optionalNamespaces:D,sessionProperties:O,pairingTopic:M}=n.params,U=cr({topic:t,relay:l,expiry:_,namespaces:y,acknowledged:!0,pairingTopic:M,requiredNamespaces:S,optionalNamespaces:D,controller:p.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:p.publicKey,metadata:p.metadata}},O&&{sessionProperties:O});await this.sendResult({id:n.id,topic:t,result:!0}),this.events.emit(Lt("session_connect"),{session:U}),this.cleanupDuplicatePairings(U)}catch(l){await this.sendError(s,t,l),this.client.logger.error(l)}},this.onSessionSettleResponse=async(t,n)=>{const{id:s}=n;ai(n)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Lt("session_approve",s),{})):Fr(n)&&(await this.client.session.delete(t,tr("USER_DISCONNECTED")),this.events.emit(Lt("session_approve",s),{error:n.error}))},this.onSessionUpdateRequest=async(t,n)=>{const{params:s,id:c}=n;try{const l=`${t}_session_update`,p=lo.get(l);if(p&&this.isRequestOutOfSync(p,c)){this.client.logger.info(`Discarding out of sync request - ${c}`);return}this.isValidUpdate(cr({topic:t},s)),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult({id:c,topic:t,result:!0}),this.client.events.emit("session_update",{id:c,topic:t,params:s}),lo.set(l,c)}catch(l){await this.sendError(c,t,l),this.client.logger.error(l)}},this.isRequestOutOfSync=(t,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(t.toString().slice(0,-3)),this.onSessionUpdateResponse=(t,n)=>{const{id:s}=n;ai(n)?this.events.emit(Lt("session_update",s),{}):Fr(n)&&this.events.emit(Lt("session_update",s),{error:n.error})},this.onSessionExtendRequest=async(t,n)=>{const{id:s}=n;try{this.isValidExtend({topic:t}),await this.setExpiry(t,Lr(fo)),await this.sendResult({id:s,topic:t,result:!0}),this.client.events.emit("session_extend",{id:s,topic:t})}catch(c){await this.sendError(s,t,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(t,n)=>{const{id:s}=n;ai(n)?this.events.emit(Lt("session_extend",s),{}):Fr(n)&&this.events.emit(Lt("session_extend",s),{error:n.error})},this.onSessionPingRequest=async(t,n)=>{const{id:s}=n;try{this.isValidPing({topic:t}),await this.sendResult({id:s,topic:t,result:!0}),this.client.events.emit("session_ping",{id:s,topic:t})}catch(c){await this.sendError(s,t,c),this.client.logger.error(c)}},this.onSessionPingResponse=(t,n)=>{const{id:s}=n;setTimeout(()=>{ai(n)?this.events.emit(Lt("session_ping",s),{}):Fr(n)&&this.events.emit(Lt("session_ping",s),{error:n.error})},500)},this.onSessionDeleteRequest=async(t,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:t,reason:n.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(Gt.publish,async()=>{c(await this.deleteSession(t))})}),this.sendResult({id:s,topic:t,result:!0})]),this.client.events.emit("session_delete",{id:s,topic:t})}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(t,n)=>{const{id:s,params:c}=n;try{this.isValidRequest(cr({topic:t},c));const l=pn(JSON.stringify(gn("wc_sessionRequest",c,s))),p=this.client.session.get(t),_=await this.getVerifyContext(l,p.peer.metadata),y={id:s,topic:t,params:c,verifyContext:_};await this.setPendingSessionRequest(y),this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue()}catch(l){await this.sendError(s,t,l),this.client.logger.error(l)}},this.onSessionRequestResponse=(t,n)=>{const{id:s}=n;ai(n)?this.events.emit(Lt("session_request",s),{result:n.result}):Fr(n)&&this.events.emit(Lt("session_request",s),{error:n.error})},this.onSessionEventRequest=async(t,n)=>{const{id:s,params:c}=n;try{const l=`${t}_session_event_${c.event.name}`,p=lo.get(l);if(p&&this.isRequestOutOfSync(p,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(cr({topic:t},c)),this.client.events.emit("session_event",{id:s,topic:t,params:c}),lo.set(l,s)}catch(l){await this.sendError(s,t,l),this.client.logger.error(l)}},this.addSessionRequestToSessionRequestQueue=t=>{this.sessionRequestQueue.queue.push(t)},this.cleanupAfterResponse=t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=oi.idle,this.processSessionRequestQueue()},re.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===oi.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=oi.active,this.client.events.emit("session_request",t)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=t=>{if(t.active)return;const n=this.client.proposal.getAll().find(s=>s.pairingTopic===t.topic);n&&this.onSessionProposeRequest(t.topic,gn("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer},n.id))},this.isValidConnect=async t=>{if(!ur(t)){const{message:_}=X("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(_)}const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:c,sessionProperties:l,relays:p}=t;if(wi(n)||await this.isValidPairingTopic(n),!d1(p,!0)){const{message:_}=X("MISSING_OR_INVALID",`connect() relays: ${p}`);throw new Error(_)}!wi(s)&&vo(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!wi(c)&&vo(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),wi(l)||this.validateSessionProps(l,"sessionProperties")},this.validateNamespaces=(t,n)=>{const s=g1(t,"connect()",n);if(s)throw new Error(s.message)},this.isValidApprove=async t=>{if(!ur(t))throw new Error(X("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:n,namespaces:s,relayProtocol:c,sessionProperties:l}=t;await this.isValidProposalId(n);const p=this.client.proposal.get(n),_=tc(s,"approve()");if(_)throw new Error(_.message);const y=Zh(p.requiredNamespaces,s,"approve()");if(y)throw new Error(y.message);if(!ln(c,!0)){const{message:S}=X("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(S)}wi(l)||this.validateSessionProps(l,"sessionProperties")},this.isValidReject=async t=>{if(!ur(t)){const{message:c}=X("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(c)}const{id:n,reason:s}=t;if(await this.isValidProposalId(n),!y1(s)){const{message:c}=X("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidSessionSettleRequest=t=>{if(!ur(t)){const{message:y}=X("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(y)}const{relay:n,controller:s,namespaces:c,expiry:l}=t;if(!v1(n)){const{message:y}=X("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(y)}const p=_1(s,"onSessionSettleRequest()");if(p)throw new Error(p.message);const _=tc(c,"onSessionSettleRequest()");if(_)throw new Error(_.message);if(mi(l)){const{message:y}=X("EXPIRED","onSessionSettleRequest()");throw new Error(y)}},this.isValidUpdate=async t=>{if(!ur(t)){const{message:_}=X("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(_)}const{topic:n,namespaces:s}=t;await this.isValidSessionTopic(n);const c=this.client.session.get(n),l=tc(s,"update()");if(l)throw new Error(l.message);const p=Zh(c.requiredNamespaces,s,"update()");if(p)throw new Error(p.message)},this.isValidExtend=async t=>{if(!ur(t)){const{message:s}=X("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:n}=t;await this.isValidSessionTopic(n)},this.isValidRequest=async t=>{if(!ur(t)){const{message:_}=X("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(_)}const{topic:n,request:s,chainId:c,expiry:l}=t;await this.isValidSessionTopic(n);const{namespaces:p}=this.client.session.get(n);if(!el(p,c)){const{message:_}=X("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(_)}if(!m1(s)){const{message:_}=X("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(_)}if(!w1(p,c,s.method)){const{message:_}=X("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(_)}if(l&&!b1(l,fc)){const{message:_}=X("MISSING_OR_INVALID",`request() expiry: ${l}. Expiry must be a number (in seconds) between ${fc.min} and ${fc.max}`);throw new Error(_)}},this.isValidRespond=async t=>{if(!ur(t)){const{message:c}=X("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(c)}const{topic:n,response:s}=t;if(await this.isValidSessionTopic(n),!E1(s)){const{message:c}=X("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidPing=async t=>{if(!ur(t)){const{message:s}=X("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async t=>{if(!ur(t)){const{message:p}=X("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(p)}const{topic:n,event:s,chainId:c}=t;await this.isValidSessionTopic(n);const{namespaces:l}=this.client.session.get(n);if(!el(l,c)){const{message:p}=X("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(p)}if(!x1(s)){const{message:p}=X("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(p)}if(!I1(l,c,s.name)){const{message:p}=X("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(p)}},this.isValidDisconnect=async t=>{if(!ur(t)){const{message:s}=X("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(t,n)=>{const s={verified:{verifyUrl:n.verifyUrl||mo,validation:"UNKNOWN",origin:n.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:t,verifyUrl:n.verifyUrl});c&&(s.verified.origin=c.origin,s.verified.isScam=c.isScam,s.verified.validation=c.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(s)}`),s},this.validateSessionProps=(t,n)=>{Object.values(t).forEach(s=>{if(!ln(s,!1)){const{message:c}=X("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(c)}})}}async isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Gt.message,async r=>{const{topic:t,message:n}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const s=await this.client.core.crypto.decode(t,n);try{Bc(s)?(this.client.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):Ro(s)?(await this.client.core.history.resolve(s),await this.onRelayEventResponse({topic:t,payload:s}),this.client.core.history.delete(t,s.id)):this.onRelayEventUnknownPayload({topic:t,payload:s})}catch(c){this.client.logger.error(c)}})}registerExpirerEvents(){this.client.core.expirer.on(Or.expired,async r=>{const{topic:t,id:n}=lf(r.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,X("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Jn.create,r=>this.onPairingCreated(r))}isValidPairingTopic(r){if(!ln(r,!1)){const{message:t}=X("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:t}=X("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(t)}if(mi(this.client.core.pairing.pairings.get(r).expiry)){const{message:t}=X("EXPIRED",`pairing topic: ${r}`);throw new Error(t)}}async isValidSessionTopic(r){if(!ln(r,!1)){const{message:t}=X("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(t)}if(!this.client.session.keys.includes(r)){const{message:t}=X("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(t)}if(mi(this.client.session.get(r).expiry)){await this.deleteSession(r);const{message:t}=X("EXPIRED",`session topic: ${r}`);throw new Error(t)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(ln(r,!1)){const{message:t}=X("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(t)}else{const{message:t}=X("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(t)}}async isValidProposalId(r){if(!S1(r)){const{message:t}=X("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(t)}if(!this.client.proposal.keys.includes(r)){const{message:t}=X("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(t)}if(mi(this.client.proposal.get(r).expiry)){await this.deleteProposal(r);const{message:t}=X("EXPIRED",`proposal id: ${r}`);throw new Error(t)}}}class sI extends Ao{constructor(r,t){super(r,t,Wx,Wc),this.core=r,this.logger=t}}class oI extends Ao{constructor(r,t){super(r,t,Jx,Wc),this.core=r,this.logger=t}}class aI extends Ao{constructor(r,t){super(r,t,Yx,Wc,n=>n.id),this.core=r,this.logger=t}}let cI=class cp extends gw{constructor(r){super(r),this.protocol=np,this.version=sp,this.name=lc.name,this.events=new vr.EventEmitter,this.on=(n,s)=>this.events.on(n,s),this.once=(n,s)=>this.events.once(n,s),this.off=(n,s)=>this.events.off(n,s),this.removeListener=(n,s)=>this.events.removeListener(n,s),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(s){throw this.logger.error(s.message),s}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(s){throw this.logger.error(s.message),s}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(s){throw this.logger.error(s.message),s}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(s){throw this.logger.error(s.message),s}},this.update=async n=>{try{return await this.engine.update(n)}catch(s){throw this.logger.error(s.message),s}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(s){throw this.logger.error(s.message),s}},this.request=async n=>{try{return await this.engine.request(n)}catch(s){throw this.logger.error(s.message),s}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(s){throw this.logger.error(s.message),s}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(s){throw this.logger.error(s.message),s}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(s){throw this.logger.error(s.message),s}},this.find=n=>{try{return this.engine.find(n)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(r==null?void 0:r.name)||lc.name,this.metadata=(r==null?void 0:r.metadata)||h1();const t=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Re.pino(Re.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||lc.logger}));this.core=(r==null?void 0:r.core)||new Gx(r),this.logger=Re.generateChildLogger(t,this.name),this.session=new oI(this.core,this.logger),this.proposal=new sI(this.core,this.logger),this.pendingRequest=new aI(this.core,this.logger),this.engine=new nI(this)}static async init(r){const t=new cp(r);return await t.initialize(),t}get context(){return Re.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}};var uI=P1();const Wl=Dc(uI),hI={Accept:"application/json","Content-Type":"application/json"},lI="POST",Jl={headers:hI,method:lI},Ql=10;class Ui{constructor(r,t=!1){if(this.url=r,this.disableProviderPing=t,this.events=new vr.EventEmitter,this.isAvailable=!1,this.registering=!1,!El(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);this.url=r,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(r,t){this.events.on(r,t)}once(r,t){this.events.once(r,t)}off(r,t){this.events.off(r,t)}removeListener(r,t){this.events.removeListener(r,t)}async open(r=this.url){await this.register(r)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(r,t){this.isAvailable||await this.register();try{const n=rs(r),c=await(await Wl(this.url,Object.assign(Object.assign({},Jl),{body:n}))).json();this.onPayload({data:c})}catch(n){this.onError(r.id,n)}}async register(r=this.url){if(!El(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((n,s)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),s(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));n()})})}this.url=r,this.registering=!0;try{if(!this.disableProviderPing){const t=rs({id:1,jsonrpc:"2.0",method:"test",params:[]});await Wl(r,Object.assign(Object.assign({},Jl),{body:t}))}this.onOpen()}catch(t){const n=this.parseError(t);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(r){if(typeof r.data>"u")return;const t=typeof r.data=="string"?zc(r.data):r.data;this.events.emit("payload",t)}onError(r,t){const n=this.parseError(t),s=n.message||n.toString(),c=Oo(r,s);this.events.emit("payload",c)}parseError(r,t=this.url){return qf(r,t,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Ql&&this.events.setMaxListeners(Ql)}}const Yl="error",fI="wss://relay.walletconnect.com",pI="wc",dI="universal_provider",Xl=`${pI}@2:${dI}:`,gI="https://rpc.walletconnect.com/v1/",xi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Gn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$c={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,r){(function(){var t,n="4.17.21",s=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",p="Invalid `variable` option passed into `_.template`",_="__lodash_hash_undefined__",y=500,S="__lodash_placeholder__",D=1,O=2,M=4,U=1,V=2,oe=1,be=2,de=4,pe=8,ue=16,he=32,N=64,H=128,W=256,ge=512,te=30,Ee="...",Ce=800,tt=16,C=1,j=2,Me=3,Ae=1/0,J=9007199254740991,B=17976931348623157e292,k=0/0,K=4294967295,ut=K-1,ke=K>>>1,Dr=[["ary",H],["bind",oe],["bindKey",be],["curry",pe],["curryRight",ue],["flip",ge],["partial",he],["partialRight",N],["rearg",W]],me="[object Arguments]",It="[object Array]",T="[object AsyncFunction]",A="[object Boolean]",P="[object Date]",h="[object DOMException]",b="[object Error]",Z="[object Function]",ae="[object GeneratorFunction]",ve="[object Map]",Te="[object Number]",$e="[object Null]",Ie="[object Object]",St="[object Promise]",_t="[object Proxy]",st="[object RegExp]",Fe="[object Set]",Qe="[object String]",Ye="[object Symbol]",ot="[object Undefined]",ze="[object WeakMap]",Xe="[object WeakSet]",Ne="[object ArrayBuffer]",Ve="[object DataView]",ht="[object Float32Array]",je="[object Float64Array]",Pt="[object Int8Array]",Ft="[object Int16Array]",Ut="[object Int32Array]",Ht="[object Uint8Array]",qt="[object Uint8ClampedArray]",Wt="[object Uint16Array]",rr="[object Uint32Array]",jr=/\b__p \+= '';/g,Jt=/\b(__p \+=) '' \+/g,Br=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ci=/&(?:amp|lt|gt|quot|#39);/g,Ii=/[&<>"']/g,lt=RegExp(ci.source),rt=RegExp(Ii.source),ft=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,at=/<%=([\s\S]+?)%>/g,it=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dt=/[\\^$.*+?()[\]{}|]/g,Ct=RegExp(dt.source),gt=/^\s+/,mt=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Je=/\{\n\/\* \[wrapped with (.+)\] \*/,At=/,? & /,Tt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,To=/[()=,{}\[\]\/\s]/,No=/\\(\\)?/g,$o=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,_r=/\w*$/,Lo=/^[-+]0x[0-9a-f]+$/i,Fo=/^0b[01]+$/i,Do=/^\[object .+?Constructor\]$/,jo=/^0o[0-7]+$/i,qo=/^(?:0|[1-9]\d*)$/,Kr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ki=/($^)/,Mo=/['\n\r\u2028\u2029\\]/g,Vi="\\ud800-\\udfff",zo="\\u0300-\\u036f",Uo="\\ufe20-\\ufe2f",Bi="\\u20d0-\\u20ff",as=zo+Uo+Bi,cs="\\u2700-\\u27bf",Rr="a-z\\xdf-\\xf6\\xf8-\\xff",Ho="\\xac\\xb1\\xd7\\xf7",ko="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Vo="\\u2000-\\u206f",Bo=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",us="A-Z\\xc0-\\xd6\\xd8-\\xde",hs="\\ufe0e\\ufe0f",Si=Ho+ko+Vo+Bo,mn="[']",Pi="["+Vi+"]",wn="["+Si+"]",Oi="["+as+"]",ls="\\d+",Ko="["+cs+"]",fs="["+Rr+"]",ps="[^"+Vi+Si+ls+cs+Rr+us+"]",Ki="\\ud83c[\\udffb-\\udfff]",Go="(?:"+Oi+"|"+Ki+")",ds="[^"+Vi+"]",Gi="(?:\\ud83c[\\udde6-\\uddff]){2}",ui="[\\ud800-\\udbff][\\udc00-\\udfff]",hr="["+us+"]",gs="\\u200d",ys="(?:"+fs+"|"+ps+")",qr="(?:"+hr+"|"+ps+")",vs="(?:"+mn+"(?:d|ll|m|re|s|t|ve))?",_s="(?:"+mn+"(?:D|LL|M|RE|S|T|VE))?",ms=Go+"?",ws="["+hs+"]?",Wo="(?:"+gs+"(?:"+[ds,Gi,ui].join("|")+")"+ws+ms+")*",Gr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",bs="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Es=ws+ms+Wo,Wi="(?:"+[Ko,Gi,ui].join("|")+")"+Es,Jo="(?:"+[ds+Oi+"?",Oi,Gi,ui,Pi].join("|")+")",bn=RegExp(mn,"g"),Qo=RegExp(Oi,"g"),Ji=RegExp(Ki+"(?="+Ki+")|"+Jo+Es,"g"),xs=RegExp([hr+"?"+fs+"+"+vs+"(?="+[wn,hr,"$"].join("|")+")",qr+"+"+_s+"(?="+[wn,hr+ys,"$"].join("|")+")",hr+"?"+ys+"+"+vs,hr+"+"+_s,bs,Gr,ls,Wi].join("|"),"g"),Is=RegExp("["+gs+Vi+as+hs+"]"),Ri=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ss=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Yo=-1,Be={};Be[ht]=Be[je]=Be[Pt]=Be[Ft]=Be[Ut]=Be[Ht]=Be[qt]=Be[Wt]=Be[rr]=!0,Be[me]=Be[It]=Be[Ne]=Be[A]=Be[Ve]=Be[P]=Be[b]=Be[Z]=Be[ve]=Be[Te]=Be[Ie]=Be[st]=Be[Fe]=Be[Qe]=Be[ze]=!1;var Ue={};Ue[me]=Ue[It]=Ue[Ne]=Ue[Ve]=Ue[A]=Ue[P]=Ue[ht]=Ue[je]=Ue[Pt]=Ue[Ft]=Ue[Ut]=Ue[ve]=Ue[Te]=Ue[Ie]=Ue[st]=Ue[Fe]=Ue[Qe]=Ue[Ye]=Ue[Ht]=Ue[qt]=Ue[Wt]=Ue[rr]=!0,Ue[b]=Ue[Z]=Ue[ze]=!1;var v={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},q={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Q={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ke=parseFloat,le=parseInt,Ze=typeof Gn=="object"&&Gn&&Gn.Object===Object&&Gn,Nt=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Ze||Nt||Function("return this")(),Ge=r&&!r.nodeType&&r,wt=Ge&&!0&&o&&!o.nodeType&&o,ir=wt&&wt.exports===Ge,$t=ir&&Ze.process,et=function(){try{var x=wt&&wt.require&&wt.require("util").types;return x||$t&&$t.binding&&$t.binding("util")}catch{}}(),Qt=et&&et.isArrayBuffer,Cr=et&&et.isDate,mr=et&&et.isMap,Mr=et&&et.isRegExp,En=et&&et.isSet,Ci=et&&et.isTypedArray;function Mt(x,$,R){switch(R.length){case 0:return x.call($);case 1:return x.call($,R[0]);case 2:return x.call($,R[0],R[1]);case 3:return x.call($,R[0],R[1],R[2])}return x.apply($,R)}function lp(x,$,R,Y){for(var ce=-1,Le=x==null?0:x.length;++ce<Le;){var Dt=x[ce];$(Y,Dt,R(Dt),x)}return Y}function wr(x,$){for(var R=-1,Y=x==null?0:x.length;++R<Y&&$(x[R],R,x)!==!1;);return x}function fp(x,$){for(var R=x==null?0:x.length;R--&&$(x[R],R,x)!==!1;);return x}function Yc(x,$){for(var R=-1,Y=x==null?0:x.length;++R<Y;)if(!$(x[R],R,x))return!1;return!0}function hi(x,$){for(var R=-1,Y=x==null?0:x.length,ce=0,Le=[];++R<Y;){var Dt=x[R];$(Dt,R,x)&&(Le[ce++]=Dt)}return Le}function Ps(x,$){var R=x==null?0:x.length;return!!R&&Qi(x,$,0)>-1}function Xo(x,$,R){for(var Y=-1,ce=x==null?0:x.length;++Y<ce;)if(R($,x[Y]))return!0;return!1}function nt(x,$){for(var R=-1,Y=x==null?0:x.length,ce=Array(Y);++R<Y;)ce[R]=$(x[R],R,x);return ce}function li(x,$){for(var R=-1,Y=$.length,ce=x.length;++R<Y;)x[ce+R]=$[R];return x}function Zo(x,$,R,Y){var ce=-1,Le=x==null?0:x.length;for(Y&&Le&&(R=x[++ce]);++ce<Le;)R=$(R,x[ce],ce,x);return R}function pp(x,$,R,Y){var ce=x==null?0:x.length;for(Y&&ce&&(R=x[--ce]);ce--;)R=$(R,x[ce],ce,x);return R}function ea(x,$){for(var R=-1,Y=x==null?0:x.length;++R<Y;)if($(x[R],R,x))return!0;return!1}var dp=ta("length");function gp(x){return x.split("")}function yp(x){return x.match(Tt)||[]}function Xc(x,$,R){var Y;return R(x,function(ce,Le,Dt){if($(ce,Le,Dt))return Y=Le,!1}),Y}function Os(x,$,R,Y){for(var ce=x.length,Le=R+(Y?1:-1);Y?Le--:++Le<ce;)if($(x[Le],Le,x))return Le;return-1}function Qi(x,$,R){return $===$?Rp(x,$,R):Os(x,Zc,R)}function vp(x,$,R,Y){for(var ce=R-1,Le=x.length;++ce<Le;)if(Y(x[ce],$))return ce;return-1}function Zc(x){return x!==x}function eu(x,$){var R=x==null?0:x.length;return R?ia(x,$)/R:k}function ta(x){return function($){return $==null?t:$[x]}}function ra(x){return function($){return x==null?t:x[$]}}function tu(x,$,R,Y,ce){return ce(x,function(Le,Dt,We){R=Y?(Y=!1,Le):$(R,Le,Dt,We)}),R}function _p(x,$){var R=x.length;for(x.sort($);R--;)x[R]=x[R].value;return x}function ia(x,$){for(var R,Y=-1,ce=x.length;++Y<ce;){var Le=$(x[Y]);Le!==t&&(R=R===t?Le:R+Le)}return R}function na(x,$){for(var R=-1,Y=Array(x);++R<x;)Y[R]=$(R);return Y}function mp(x,$){return nt($,function(R){return[R,x[R]]})}function ru(x){return x&&x.slice(0,ou(x)+1).replace(gt,"")}function lr(x){return function($){return x($)}}function sa(x,$){return nt($,function(R){return x[R]})}function xn(x,$){return x.has($)}function iu(x,$){for(var R=-1,Y=x.length;++R<Y&&Qi($,x[R],0)>-1;);return R}function nu(x,$){for(var R=x.length;R--&&Qi($,x[R],0)>-1;);return R}function wp(x,$){for(var R=x.length,Y=0;R--;)x[R]===$&&++Y;return Y}var bp=ra(v),Ep=ra(E);function xp(x){return"\\"+Q[x]}function Ip(x,$){return x==null?t:x[$]}function Yi(x){return Is.test(x)}function Sp(x){return Ri.test(x)}function Pp(x){for(var $,R=[];!($=x.next()).done;)R.push($.value);return R}function oa(x){var $=-1,R=Array(x.size);return x.forEach(function(Y,ce){R[++$]=[ce,Y]}),R}function su(x,$){return function(R){return x($(R))}}function fi(x,$){for(var R=-1,Y=x.length,ce=0,Le=[];++R<Y;){var Dt=x[R];(Dt===$||Dt===S)&&(x[R]=S,Le[ce++]=R)}return Le}function Rs(x){var $=-1,R=Array(x.size);return x.forEach(function(Y){R[++$]=Y}),R}function Op(x){var $=-1,R=Array(x.size);return x.forEach(function(Y){R[++$]=[Y,Y]}),R}function Rp(x,$,R){for(var Y=R-1,ce=x.length;++Y<ce;)if(x[Y]===$)return Y;return-1}function Cp(x,$,R){for(var Y=R+1;Y--;)if(x[Y]===$)return Y;return Y}function Xi(x){return Yi(x)?Tp(x):dp(x)}function Ar(x){return Yi(x)?Np(x):gp(x)}function ou(x){for(var $=x.length;$--&&mt.test(x.charAt($)););return $}var Ap=ra(q);function Tp(x){for(var $=Ji.lastIndex=0;Ji.test(x);)++$;return $}function Np(x){return x.match(Ji)||[]}function $p(x){return x.match(xs)||[]}var Lp=function x($){$=$==null?Pe:Zi.defaults(Pe.Object(),$,Zi.pick(Pe,Ss));var R=$.Array,Y=$.Date,ce=$.Error,Le=$.Function,Dt=$.Math,We=$.Object,aa=$.RegExp,Fp=$.String,br=$.TypeError,Cs=R.prototype,Dp=Le.prototype,en=We.prototype,As=$["__core-js_shared__"],Ts=Dp.toString,qe=en.hasOwnProperty,jp=0,au=function(){var e=/[^.]+$/.exec(As&&As.keys&&As.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ns=en.toString,qp=Ts.call(We),Mp=Pe._,zp=aa("^"+Ts.call(qe).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$s=ir?$.Buffer:t,pi=$.Symbol,Ls=$.Uint8Array,cu=$s?$s.allocUnsafe:t,Fs=su(We.getPrototypeOf,We),uu=We.create,hu=en.propertyIsEnumerable,Ds=Cs.splice,lu=pi?pi.isConcatSpreadable:t,In=pi?pi.iterator:t,Ai=pi?pi.toStringTag:t,js=function(){try{var e=Fi(We,"defineProperty");return e({},"",{}),e}catch{}}(),Up=$.clearTimeout!==Pe.clearTimeout&&$.clearTimeout,Hp=Y&&Y.now!==Pe.Date.now&&Y.now,kp=$.setTimeout!==Pe.setTimeout&&$.setTimeout,qs=Dt.ceil,Ms=Dt.floor,ca=We.getOwnPropertySymbols,Vp=$s?$s.isBuffer:t,fu=$.isFinite,Bp=Cs.join,Kp=su(We.keys,We),jt=Dt.max,Bt=Dt.min,Gp=Y.now,Wp=$.parseInt,pu=Dt.random,Jp=Cs.reverse,ua=Fi($,"DataView"),Sn=Fi($,"Map"),ha=Fi($,"Promise"),tn=Fi($,"Set"),Pn=Fi($,"WeakMap"),On=Fi(We,"create"),zs=Pn&&new Pn,rn={},Qp=Di(ua),Yp=Di(Sn),Xp=Di(ha),Zp=Di(tn),ed=Di(Pn),Us=pi?pi.prototype:t,Rn=Us?Us.valueOf:t,du=Us?Us.toString:t;function d(e){if(vt(e)&&!fe(e)&&!(e instanceof Se)){if(e instanceof Er)return e;if(qe.call(e,"__wrapped__"))return gh(e)}return new Er(e)}var nn=function(){function e(){}return function(i){if(!ct(i))return{};if(uu)return uu(i);e.prototype=i;var a=new e;return e.prototype=t,a}}();function Hs(){}function Er(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=t}d.templateSettings={escape:ft,evaluate:pt,interpolate:at,variable:"",imports:{_:d}},d.prototype=Hs.prototype,d.prototype.constructor=d,Er.prototype=nn(Hs.prototype),Er.prototype.constructor=Er;function Se(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=K,this.__views__=[]}function td(){var e=new Se(this.__wrapped__);return e.__actions__=nr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=nr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=nr(this.__views__),e}function rd(){if(this.__filtered__){var e=new Se(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function id(){var e=this.__wrapped__.value(),i=this.__dir__,a=fe(e),u=i<0,f=a?e.length:0,g=gg(0,f,this.__views__),m=g.start,w=g.end,I=w-m,L=u?w:m-1,F=this.__iteratees__,z=F.length,G=0,ee=Bt(I,this.__takeCount__);if(!a||!u&&f==I&&ee==I)return qu(e,this.__actions__);var ne=[];e:for(;I--&&G<ee;){L+=i;for(var _e=-1,se=e[L];++_e<z;){var xe=F[_e],Oe=xe.iteratee,dr=xe.type,Zt=Oe(se);if(dr==j)se=Zt;else if(!Zt){if(dr==C)continue e;break e}}ne[G++]=se}return ne}Se.prototype=nn(Hs.prototype),Se.prototype.constructor=Se;function Ti(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function nd(){this.__data__=On?On(null):{},this.size=0}function sd(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function od(e){var i=this.__data__;if(On){var a=i[e];return a===_?t:a}return qe.call(i,e)?i[e]:t}function ad(e){var i=this.__data__;return On?i[e]!==t:qe.call(i,e)}function cd(e,i){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=On&&i===t?_:i,this}Ti.prototype.clear=nd,Ti.prototype.delete=sd,Ti.prototype.get=od,Ti.prototype.has=ad,Ti.prototype.set=cd;function Wr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function ud(){this.__data__=[],this.size=0}function hd(e){var i=this.__data__,a=ks(i,e);if(a<0)return!1;var u=i.length-1;return a==u?i.pop():Ds.call(i,a,1),--this.size,!0}function ld(e){var i=this.__data__,a=ks(i,e);return a<0?t:i[a][1]}function fd(e){return ks(this.__data__,e)>-1}function pd(e,i){var a=this.__data__,u=ks(a,e);return u<0?(++this.size,a.push([e,i])):a[u][1]=i,this}Wr.prototype.clear=ud,Wr.prototype.delete=hd,Wr.prototype.get=ld,Wr.prototype.has=fd,Wr.prototype.set=pd;function Jr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function dd(){this.size=0,this.__data__={hash:new Ti,map:new(Sn||Wr),string:new Ti}}function gd(e){var i=to(this,e).delete(e);return this.size-=i?1:0,i}function yd(e){return to(this,e).get(e)}function vd(e){return to(this,e).has(e)}function _d(e,i){var a=to(this,e),u=a.size;return a.set(e,i),this.size+=a.size==u?0:1,this}Jr.prototype.clear=dd,Jr.prototype.delete=gd,Jr.prototype.get=yd,Jr.prototype.has=vd,Jr.prototype.set=_d;function Ni(e){var i=-1,a=e==null?0:e.length;for(this.__data__=new Jr;++i<a;)this.add(e[i])}function md(e){return this.__data__.set(e,_),this}function wd(e){return this.__data__.has(e)}Ni.prototype.add=Ni.prototype.push=md,Ni.prototype.has=wd;function Tr(e){var i=this.__data__=new Wr(e);this.size=i.size}function bd(){this.__data__=new Wr,this.size=0}function Ed(e){var i=this.__data__,a=i.delete(e);return this.size=i.size,a}function xd(e){return this.__data__.get(e)}function Id(e){return this.__data__.has(e)}function Sd(e,i){var a=this.__data__;if(a instanceof Wr){var u=a.__data__;if(!Sn||u.length<s-1)return u.push([e,i]),this.size=++a.size,this;a=this.__data__=new Jr(u)}return a.set(e,i),this.size=a.size,this}Tr.prototype.clear=bd,Tr.prototype.delete=Ed,Tr.prototype.get=xd,Tr.prototype.has=Id,Tr.prototype.set=Sd;function gu(e,i){var a=fe(e),u=!a&&ji(e),f=!a&&!u&&_i(e),g=!a&&!u&&!f&&cn(e),m=a||u||f||g,w=m?na(e.length,Fp):[],I=w.length;for(var L in e)(i||qe.call(e,L))&&!(m&&(L=="length"||f&&(L=="offset"||L=="parent")||g&&(L=="buffer"||L=="byteLength"||L=="byteOffset")||Zr(L,I)))&&w.push(L);return w}function yu(e){var i=e.length;return i?e[ba(0,i-1)]:t}function Pd(e,i){return ro(nr(e),$i(i,0,e.length))}function Od(e){return ro(nr(e))}function la(e,i,a){(a!==t&&!Nr(e[i],a)||a===t&&!(i in e))&&Qr(e,i,a)}function Cn(e,i,a){var u=e[i];(!(qe.call(e,i)&&Nr(u,a))||a===t&&!(i in e))&&Qr(e,i,a)}function ks(e,i){for(var a=e.length;a--;)if(Nr(e[a][0],i))return a;return-1}function Rd(e,i,a,u){return di(e,function(f,g,m){i(u,f,a(f),m)}),u}function vu(e,i){return e&&Ur(i,zt(i),e)}function Cd(e,i){return e&&Ur(i,or(i),e)}function Qr(e,i,a){i=="__proto__"&&js?js(e,i,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[i]=a}function fa(e,i){for(var a=-1,u=i.length,f=R(u),g=e==null;++a<u;)f[a]=g?t:Ka(e,i[a]);return f}function $i(e,i,a){return e===e&&(a!==t&&(e=e<=a?e:a),i!==t&&(e=e>=i?e:i)),e}function xr(e,i,a,u,f,g){var m,w=i&D,I=i&O,L=i&M;if(a&&(m=f?a(e,u,f,g):a(e)),m!==t)return m;if(!ct(e))return e;var F=fe(e);if(F){if(m=vg(e),!w)return nr(e,m)}else{var z=Kt(e),G=z==Z||z==ae;if(_i(e))return Uu(e,w);if(z==Ie||z==me||G&&!f){if(m=I||G?{}:oh(e),!w)return I?og(e,Cd(m,e)):sg(e,vu(m,e))}else{if(!Ue[z])return f?e:{};m=_g(e,z,w)}}g||(g=new Tr);var ee=g.get(e);if(ee)return ee;g.set(e,m),Fh(e)?e.forEach(function(se){m.add(xr(se,i,a,se,e,g))}):$h(e)&&e.forEach(function(se,xe){m.set(xe,xr(se,i,a,xe,e,g))});var ne=L?I?Na:Ta:I?or:zt,_e=F?t:ne(e);return wr(_e||e,function(se,xe){_e&&(xe=se,se=e[xe]),Cn(m,xe,xr(se,i,a,xe,e,g))}),m}function Ad(e){var i=zt(e);return function(a){return _u(a,e,i)}}function _u(e,i,a){var u=a.length;if(e==null)return!u;for(e=We(e);u--;){var f=a[u],g=i[f],m=e[f];if(m===t&&!(f in e)||!g(m))return!1}return!0}function mu(e,i,a){if(typeof e!="function")throw new br(l);return Dn(function(){e.apply(t,a)},i)}function An(e,i,a,u){var f=-1,g=Ps,m=!0,w=e.length,I=[],L=i.length;if(!w)return I;a&&(i=nt(i,lr(a))),u?(g=Xo,m=!1):i.length>=s&&(g=xn,m=!1,i=new Ni(i));e:for(;++f<w;){var F=e[f],z=a==null?F:a(F);if(F=u||F!==0?F:0,m&&z===z){for(var G=L;G--;)if(i[G]===z)continue e;I.push(F)}else g(i,z,u)||I.push(F)}return I}var di=Ku(zr),wu=Ku(da,!0);function Td(e,i){var a=!0;return di(e,function(u,f,g){return a=!!i(u,f,g),a}),a}function Vs(e,i,a){for(var u=-1,f=e.length;++u<f;){var g=e[u],m=i(g);if(m!=null&&(w===t?m===m&&!pr(m):a(m,w)))var w=m,I=g}return I}function Nd(e,i,a,u){var f=e.length;for(a=ye(a),a<0&&(a=-a>f?0:f+a),u=u===t||u>f?f:ye(u),u<0&&(u+=f),u=a>u?0:jh(u);a<u;)e[a++]=i;return e}function bu(e,i){var a=[];return di(e,function(u,f,g){i(u,f,g)&&a.push(u)}),a}function kt(e,i,a,u,f){var g=-1,m=e.length;for(a||(a=wg),f||(f=[]);++g<m;){var w=e[g];i>0&&a(w)?i>1?kt(w,i-1,a,u,f):li(f,w):u||(f[f.length]=w)}return f}var pa=Gu(),Eu=Gu(!0);function zr(e,i){return e&&pa(e,i,zt)}function da(e,i){return e&&Eu(e,i,zt)}function Bs(e,i){return hi(i,function(a){return ei(e[a])})}function Li(e,i){i=yi(i,e);for(var a=0,u=i.length;e!=null&&a<u;)e=e[Hr(i[a++])];return a&&a==u?e:t}function xu(e,i,a){var u=i(e);return fe(e)?u:li(u,a(e))}function Yt(e){return e==null?e===t?ot:$e:Ai&&Ai in We(e)?dg(e):Og(e)}function ga(e,i){return e>i}function $d(e,i){return e!=null&&qe.call(e,i)}function Ld(e,i){return e!=null&&i in We(e)}function Fd(e,i,a){return e>=Bt(i,a)&&e<jt(i,a)}function ya(e,i,a){for(var u=a?Xo:Ps,f=e[0].length,g=e.length,m=g,w=R(g),I=1/0,L=[];m--;){var F=e[m];m&&i&&(F=nt(F,lr(i))),I=Bt(F.length,I),w[m]=!a&&(i||f>=120&&F.length>=120)?new Ni(m&&F):t}F=e[0];var z=-1,G=w[0];e:for(;++z<f&&L.length<I;){var ee=F[z],ne=i?i(ee):ee;if(ee=a||ee!==0?ee:0,!(G?xn(G,ne):u(L,ne,a))){for(m=g;--m;){var _e=w[m];if(!(_e?xn(_e,ne):u(e[m],ne,a)))continue e}G&&G.push(ne),L.push(ee)}}return L}function Dd(e,i,a,u){return zr(e,function(f,g,m){i(u,a(f),g,m)}),u}function Tn(e,i,a){i=yi(i,e),e=hh(e,i);var u=e==null?e:e[Hr(Sr(i))];return u==null?t:Mt(u,e,a)}function Iu(e){return vt(e)&&Yt(e)==me}function jd(e){return vt(e)&&Yt(e)==Ne}function qd(e){return vt(e)&&Yt(e)==P}function Nn(e,i,a,u,f){return e===i?!0:e==null||i==null||!vt(e)&&!vt(i)?e!==e&&i!==i:Md(e,i,a,u,Nn,f)}function Md(e,i,a,u,f,g){var m=fe(e),w=fe(i),I=m?It:Kt(e),L=w?It:Kt(i);I=I==me?Ie:I,L=L==me?Ie:L;var F=I==Ie,z=L==Ie,G=I==L;if(G&&_i(e)){if(!_i(i))return!1;m=!0,F=!1}if(G&&!F)return g||(g=new Tr),m||cn(e)?ih(e,i,a,u,f,g):fg(e,i,I,a,u,f,g);if(!(a&U)){var ee=F&&qe.call(e,"__wrapped__"),ne=z&&qe.call(i,"__wrapped__");if(ee||ne){var _e=ee?e.value():e,se=ne?i.value():i;return g||(g=new Tr),f(_e,se,a,u,g)}}return G?(g||(g=new Tr),pg(e,i,a,u,f,g)):!1}function zd(e){return vt(e)&&Kt(e)==ve}function va(e,i,a,u){var f=a.length,g=f,m=!u;if(e==null)return!g;for(e=We(e);f--;){var w=a[f];if(m&&w[2]?w[1]!==e[w[0]]:!(w[0]in e))return!1}for(;++f<g;){w=a[f];var I=w[0],L=e[I],F=w[1];if(m&&w[2]){if(L===t&&!(I in e))return!1}else{var z=new Tr;if(u)var G=u(L,F,I,e,i,z);if(!(G===t?Nn(F,L,U|V,u,z):G))return!1}}return!0}function Su(e){if(!ct(e)||Eg(e))return!1;var i=ei(e)?zp:Do;return i.test(Di(e))}function Ud(e){return vt(e)&&Yt(e)==st}function Hd(e){return vt(e)&&Kt(e)==Fe}function kd(e){return vt(e)&&co(e.length)&&!!Be[Yt(e)]}function Pu(e){return typeof e=="function"?e:e==null?ar:typeof e=="object"?fe(e)?Cu(e[0],e[1]):Ru(e):Wh(e)}function _a(e){if(!Fn(e))return Kp(e);var i=[];for(var a in We(e))qe.call(e,a)&&a!="constructor"&&i.push(a);return i}function Vd(e){if(!ct(e))return Pg(e);var i=Fn(e),a=[];for(var u in e)u=="constructor"&&(i||!qe.call(e,u))||a.push(u);return a}function ma(e,i){return e<i}function Ou(e,i){var a=-1,u=sr(e)?R(e.length):[];return di(e,function(f,g,m){u[++a]=i(f,g,m)}),u}function Ru(e){var i=La(e);return i.length==1&&i[0][2]?ch(i[0][0],i[0][1]):function(a){return a===e||va(a,e,i)}}function Cu(e,i){return Da(e)&&ah(i)?ch(Hr(e),i):function(a){var u=Ka(a,e);return u===t&&u===i?Ga(a,e):Nn(i,u,U|V)}}function Ks(e,i,a,u,f){e!==i&&pa(i,function(g,m){if(f||(f=new Tr),ct(g))Bd(e,i,m,a,Ks,u,f);else{var w=u?u(qa(e,m),g,m+"",e,i,f):t;w===t&&(w=g),la(e,m,w)}},or)}function Bd(e,i,a,u,f,g,m){var w=qa(e,a),I=qa(i,a),L=m.get(I);if(L){la(e,a,L);return}var F=g?g(w,I,a+"",e,i,m):t,z=F===t;if(z){var G=fe(I),ee=!G&&_i(I),ne=!G&&!ee&&cn(I);F=I,G||ee||ne?fe(w)?F=w:bt(w)?F=nr(w):ee?(z=!1,F=Uu(I,!0)):ne?(z=!1,F=Hu(I,!0)):F=[]:jn(I)||ji(I)?(F=w,ji(w)?F=qh(w):(!ct(w)||ei(w))&&(F=oh(I))):z=!1}z&&(m.set(I,F),f(F,I,u,g,m),m.delete(I)),la(e,a,F)}function Au(e,i){var a=e.length;if(a)return i+=i<0?a:0,Zr(i,a)?e[i]:t}function Tu(e,i,a){i.length?i=nt(i,function(g){return fe(g)?function(m){return Li(m,g.length===1?g[0]:g)}:g}):i=[ar];var u=-1;i=nt(i,lr(ie()));var f=Ou(e,function(g,m,w){var I=nt(i,function(L){return L(g)});return{criteria:I,index:++u,value:g}});return _p(f,function(g,m){return ng(g,m,a)})}function Kd(e,i){return Nu(e,i,function(a,u){return Ga(e,u)})}function Nu(e,i,a){for(var u=-1,f=i.length,g={};++u<f;){var m=i[u],w=Li(e,m);a(w,m)&&$n(g,yi(m,e),w)}return g}function Gd(e){return function(i){return Li(i,e)}}function wa(e,i,a,u){var f=u?vp:Qi,g=-1,m=i.length,w=e;for(e===i&&(i=nr(i)),a&&(w=nt(e,lr(a)));++g<m;)for(var I=0,L=i[g],F=a?a(L):L;(I=f(w,F,I,u))>-1;)w!==e&&Ds.call(w,I,1),Ds.call(e,I,1);return e}function $u(e,i){for(var a=e?i.length:0,u=a-1;a--;){var f=i[a];if(a==u||f!==g){var g=f;Zr(f)?Ds.call(e,f,1):Ia(e,f)}}return e}function ba(e,i){return e+Ms(pu()*(i-e+1))}function Wd(e,i,a,u){for(var f=-1,g=jt(qs((i-e)/(a||1)),0),m=R(g);g--;)m[u?g:++f]=e,e+=a;return m}function Ea(e,i){var a="";if(!e||i<1||i>J)return a;do i%2&&(a+=e),i=Ms(i/2),i&&(e+=e);while(i);return a}function we(e,i){return Ma(uh(e,i,ar),e+"")}function Jd(e){return yu(un(e))}function Qd(e,i){var a=un(e);return ro(a,$i(i,0,a.length))}function $n(e,i,a,u){if(!ct(e))return e;i=yi(i,e);for(var f=-1,g=i.length,m=g-1,w=e;w!=null&&++f<g;){var I=Hr(i[f]),L=a;if(I==="__proto__"||I==="constructor"||I==="prototype")return e;if(f!=m){var F=w[I];L=u?u(F,I,w):t,L===t&&(L=ct(F)?F:Zr(i[f+1])?[]:{})}Cn(w,I,L),w=w[I]}return e}var Lu=zs?function(e,i){return zs.set(e,i),e}:ar,Yd=js?function(e,i){return js(e,"toString",{configurable:!0,enumerable:!1,value:Ja(i),writable:!0})}:ar;function Xd(e){return ro(un(e))}function Ir(e,i,a){var u=-1,f=e.length;i<0&&(i=-i>f?0:f+i),a=a>f?f:a,a<0&&(a+=f),f=i>a?0:a-i>>>0,i>>>=0;for(var g=R(f);++u<f;)g[u]=e[u+i];return g}function Zd(e,i){var a;return di(e,function(u,f,g){return a=i(u,f,g),!a}),!!a}function Gs(e,i,a){var u=0,f=e==null?u:e.length;if(typeof i=="number"&&i===i&&f<=ke){for(;u<f;){var g=u+f>>>1,m=e[g];m!==null&&!pr(m)&&(a?m<=i:m<i)?u=g+1:f=g}return f}return xa(e,i,ar,a)}function xa(e,i,a,u){var f=0,g=e==null?0:e.length;if(g===0)return 0;i=a(i);for(var m=i!==i,w=i===null,I=pr(i),L=i===t;f<g;){var F=Ms((f+g)/2),z=a(e[F]),G=z!==t,ee=z===null,ne=z===z,_e=pr(z);if(m)var se=u||ne;else L?se=ne&&(u||G):w?se=ne&&G&&(u||!ee):I?se=ne&&G&&!ee&&(u||!_e):ee||_e?se=!1:se=u?z<=i:z<i;se?f=F+1:g=F}return Bt(g,ut)}function Fu(e,i){for(var a=-1,u=e.length,f=0,g=[];++a<u;){var m=e[a],w=i?i(m):m;if(!a||!Nr(w,I)){var I=w;g[f++]=m===0?0:m}}return g}function Du(e){return typeof e=="number"?e:pr(e)?k:+e}function fr(e){if(typeof e=="string")return e;if(fe(e))return nt(e,fr)+"";if(pr(e))return du?du.call(e):"";var i=e+"";return i=="0"&&1/e==-Ae?"-0":i}function gi(e,i,a){var u=-1,f=Ps,g=e.length,m=!0,w=[],I=w;if(a)m=!1,f=Xo;else if(g>=s){var L=i?null:hg(e);if(L)return Rs(L);m=!1,f=xn,I=new Ni}else I=i?[]:w;e:for(;++u<g;){var F=e[u],z=i?i(F):F;if(F=a||F!==0?F:0,m&&z===z){for(var G=I.length;G--;)if(I[G]===z)continue e;i&&I.push(z),w.push(F)}else f(I,z,a)||(I!==w&&I.push(z),w.push(F))}return w}function Ia(e,i){return i=yi(i,e),e=hh(e,i),e==null||delete e[Hr(Sr(i))]}function ju(e,i,a,u){return $n(e,i,a(Li(e,i)),u)}function Ws(e,i,a,u){for(var f=e.length,g=u?f:-1;(u?g--:++g<f)&&i(e[g],g,e););return a?Ir(e,u?0:g,u?g+1:f):Ir(e,u?g+1:0,u?f:g)}function qu(e,i){var a=e;return a instanceof Se&&(a=a.value()),Zo(i,function(u,f){return f.func.apply(f.thisArg,li([u],f.args))},a)}function Sa(e,i,a){var u=e.length;if(u<2)return u?gi(e[0]):[];for(var f=-1,g=R(u);++f<u;)for(var m=e[f],w=-1;++w<u;)w!=f&&(g[f]=An(g[f]||m,e[w],i,a));return gi(kt(g,1),i,a)}function Mu(e,i,a){for(var u=-1,f=e.length,g=i.length,m={};++u<f;){var w=u<g?i[u]:t;a(m,e[u],w)}return m}function Pa(e){return bt(e)?e:[]}function Oa(e){return typeof e=="function"?e:ar}function yi(e,i){return fe(e)?e:Da(e,i)?[e]:dh(De(e))}var eg=we;function vi(e,i,a){var u=e.length;return a=a===t?u:a,!i&&a>=u?e:Ir(e,i,a)}var zu=Up||function(e){return Pe.clearTimeout(e)};function Uu(e,i){if(i)return e.slice();var a=e.length,u=cu?cu(a):new e.constructor(a);return e.copy(u),u}function Ra(e){var i=new e.constructor(e.byteLength);return new Ls(i).set(new Ls(e)),i}function tg(e,i){var a=i?Ra(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)}function rg(e){var i=new e.constructor(e.source,_r.exec(e));return i.lastIndex=e.lastIndex,i}function ig(e){return Rn?We(Rn.call(e)):{}}function Hu(e,i){var a=i?Ra(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)}function ku(e,i){if(e!==i){var a=e!==t,u=e===null,f=e===e,g=pr(e),m=i!==t,w=i===null,I=i===i,L=pr(i);if(!w&&!L&&!g&&e>i||g&&m&&I&&!w&&!L||u&&m&&I||!a&&I||!f)return 1;if(!u&&!g&&!L&&e<i||L&&a&&f&&!u&&!g||w&&a&&f||!m&&f||!I)return-1}return 0}function ng(e,i,a){for(var u=-1,f=e.criteria,g=i.criteria,m=f.length,w=a.length;++u<m;){var I=ku(f[u],g[u]);if(I){if(u>=w)return I;var L=a[u];return I*(L=="desc"?-1:1)}}return e.index-i.index}function Vu(e,i,a,u){for(var f=-1,g=e.length,m=a.length,w=-1,I=i.length,L=jt(g-m,0),F=R(I+L),z=!u;++w<I;)F[w]=i[w];for(;++f<m;)(z||f<g)&&(F[a[f]]=e[f]);for(;L--;)F[w++]=e[f++];return F}function Bu(e,i,a,u){for(var f=-1,g=e.length,m=-1,w=a.length,I=-1,L=i.length,F=jt(g-w,0),z=R(F+L),G=!u;++f<F;)z[f]=e[f];for(var ee=f;++I<L;)z[ee+I]=i[I];for(;++m<w;)(G||f<g)&&(z[ee+a[m]]=e[f++]);return z}function nr(e,i){var a=-1,u=e.length;for(i||(i=R(u));++a<u;)i[a]=e[a];return i}function Ur(e,i,a,u){var f=!a;a||(a={});for(var g=-1,m=i.length;++g<m;){var w=i[g],I=u?u(a[w],e[w],w,a,e):t;I===t&&(I=e[w]),f?Qr(a,w,I):Cn(a,w,I)}return a}function sg(e,i){return Ur(e,Fa(e),i)}function og(e,i){return Ur(e,nh(e),i)}function Js(e,i){return function(a,u){var f=fe(a)?lp:Rd,g=i?i():{};return f(a,e,ie(u,2),g)}}function sn(e){return we(function(i,a){var u=-1,f=a.length,g=f>1?a[f-1]:t,m=f>2?a[2]:t;for(g=e.length>3&&typeof g=="function"?(f--,g):t,m&&Xt(a[0],a[1],m)&&(g=f<3?t:g,f=1),i=We(i);++u<f;){var w=a[u];w&&e(i,w,u,g)}return i})}function Ku(e,i){return function(a,u){if(a==null)return a;if(!sr(a))return e(a,u);for(var f=a.length,g=i?f:-1,m=We(a);(i?g--:++g<f)&&u(m[g],g,m)!==!1;);return a}}function Gu(e){return function(i,a,u){for(var f=-1,g=We(i),m=u(i),w=m.length;w--;){var I=m[e?w:++f];if(a(g[I],I,g)===!1)break}return i}}function ag(e,i,a){var u=i&oe,f=Ln(e);function g(){var m=this&&this!==Pe&&this instanceof g?f:e;return m.apply(u?a:this,arguments)}return g}function Wu(e){return function(i){i=De(i);var a=Yi(i)?Ar(i):t,u=a?a[0]:i.charAt(0),f=a?vi(a,1).join(""):i.slice(1);return u[e]()+f}}function on(e){return function(i){return Zo(Kh(Bh(i).replace(bn,"")),e,"")}}function Ln(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var a=nn(e.prototype),u=e.apply(a,i);return ct(u)?u:a}}function cg(e,i,a){var u=Ln(e);function f(){for(var g=arguments.length,m=R(g),w=g,I=an(f);w--;)m[w]=arguments[w];var L=g<3&&m[0]!==I&&m[g-1]!==I?[]:fi(m,I);if(g-=L.length,g<a)return Zu(e,i,Qs,f.placeholder,t,m,L,t,t,a-g);var F=this&&this!==Pe&&this instanceof f?u:e;return Mt(F,this,m)}return f}function Ju(e){return function(i,a,u){var f=We(i);if(!sr(i)){var g=ie(a,3);i=zt(i),a=function(w){return g(f[w],w,f)}}var m=e(i,a,u);return m>-1?f[g?i[m]:m]:t}}function Qu(e){return Xr(function(i){var a=i.length,u=a,f=Er.prototype.thru;for(e&&i.reverse();u--;){var g=i[u];if(typeof g!="function")throw new br(l);if(f&&!m&&eo(g)=="wrapper")var m=new Er([],!0)}for(u=m?u:a;++u<a;){g=i[u];var w=eo(g),I=w=="wrapper"?$a(g):t;I&&ja(I[0])&&I[1]==(H|pe|he|W)&&!I[4].length&&I[9]==1?m=m[eo(I[0])].apply(m,I[3]):m=g.length==1&&ja(g)?m[w]():m.thru(g)}return function(){var L=arguments,F=L[0];if(m&&L.length==1&&fe(F))return m.plant(F).value();for(var z=0,G=a?i[z].apply(this,L):F;++z<a;)G=i[z].call(this,G);return G}})}function Qs(e,i,a,u,f,g,m,w,I,L){var F=i&H,z=i&oe,G=i&be,ee=i&(pe|ue),ne=i&ge,_e=G?t:Ln(e);function se(){for(var xe=arguments.length,Oe=R(xe),dr=xe;dr--;)Oe[dr]=arguments[dr];if(ee)var Zt=an(se),gr=wp(Oe,Zt);if(u&&(Oe=Vu(Oe,u,f,ee)),g&&(Oe=Bu(Oe,g,m,ee)),xe-=gr,ee&&xe<L){var Et=fi(Oe,Zt);return Zu(e,i,Qs,se.placeholder,a,Oe,Et,w,I,L-xe)}var $r=z?a:this,ri=G?$r[e]:e;return xe=Oe.length,w?Oe=Rg(Oe,w):ne&&xe>1&&Oe.reverse(),F&&I<xe&&(Oe.length=I),this&&this!==Pe&&this instanceof se&&(ri=_e||Ln(ri)),ri.apply($r,Oe)}return se}function Yu(e,i){return function(a,u){return Dd(a,e,i(u),{})}}function Ys(e,i){return function(a,u){var f;if(a===t&&u===t)return i;if(a!==t&&(f=a),u!==t){if(f===t)return u;typeof a=="string"||typeof u=="string"?(a=fr(a),u=fr(u)):(a=Du(a),u=Du(u)),f=e(a,u)}return f}}function Ca(e){return Xr(function(i){return i=nt(i,lr(ie())),we(function(a){var u=this;return e(i,function(f){return Mt(f,u,a)})})})}function Xs(e,i){i=i===t?" ":fr(i);var a=i.length;if(a<2)return a?Ea(i,e):i;var u=Ea(i,qs(e/Xi(i)));return Yi(i)?vi(Ar(u),0,e).join(""):u.slice(0,e)}function ug(e,i,a,u){var f=i&oe,g=Ln(e);function m(){for(var w=-1,I=arguments.length,L=-1,F=u.length,z=R(F+I),G=this&&this!==Pe&&this instanceof m?g:e;++L<F;)z[L]=u[L];for(;I--;)z[L++]=arguments[++w];return Mt(G,f?a:this,z)}return m}function Xu(e){return function(i,a,u){return u&&typeof u!="number"&&Xt(i,a,u)&&(a=u=t),i=ti(i),a===t?(a=i,i=0):a=ti(a),u=u===t?i<a?1:-1:ti(u),Wd(i,a,u,e)}}function Zs(e){return function(i,a){return typeof i=="string"&&typeof a=="string"||(i=Pr(i),a=Pr(a)),e(i,a)}}function Zu(e,i,a,u,f,g,m,w,I,L){var F=i&pe,z=F?m:t,G=F?t:m,ee=F?g:t,ne=F?t:g;i|=F?he:N,i&=~(F?N:he),i&de||(i&=~(oe|be));var _e=[e,i,f,ee,z,ne,G,w,I,L],se=a.apply(t,_e);return ja(e)&&lh(se,_e),se.placeholder=u,fh(se,e,i)}function Aa(e){var i=Dt[e];return function(a,u){if(a=Pr(a),u=u==null?0:Bt(ye(u),292),u&&fu(a)){var f=(De(a)+"e").split("e"),g=i(f[0]+"e"+(+f[1]+u));return f=(De(g)+"e").split("e"),+(f[0]+"e"+(+f[1]-u))}return i(a)}}var hg=tn&&1/Rs(new tn([,-0]))[1]==Ae?function(e){return new tn(e)}:Xa;function eh(e){return function(i){var a=Kt(i);return a==ve?oa(i):a==Fe?Op(i):mp(i,e(i))}}function Yr(e,i,a,u,f,g,m,w){var I=i&be;if(!I&&typeof e!="function")throw new br(l);var L=u?u.length:0;if(L||(i&=~(he|N),u=f=t),m=m===t?m:jt(ye(m),0),w=w===t?w:ye(w),L-=f?f.length:0,i&N){var F=u,z=f;u=f=t}var G=I?t:$a(e),ee=[e,i,a,u,f,F,z,g,m,w];if(G&&Sg(ee,G),e=ee[0],i=ee[1],a=ee[2],u=ee[3],f=ee[4],w=ee[9]=ee[9]===t?I?0:e.length:jt(ee[9]-L,0),!w&&i&(pe|ue)&&(i&=~(pe|ue)),!i||i==oe)var ne=ag(e,i,a);else i==pe||i==ue?ne=cg(e,i,w):(i==he||i==(oe|he))&&!f.length?ne=ug(e,i,a,u):ne=Qs.apply(t,ee);var _e=G?Lu:lh;return fh(_e(ne,ee),e,i)}function th(e,i,a,u){return e===t||Nr(e,en[a])&&!qe.call(u,a)?i:e}function rh(e,i,a,u,f,g){return ct(e)&&ct(i)&&(g.set(i,e),Ks(e,i,t,rh,g),g.delete(i)),e}function lg(e){return jn(e)?t:e}function ih(e,i,a,u,f,g){var m=a&U,w=e.length,I=i.length;if(w!=I&&!(m&&I>w))return!1;var L=g.get(e),F=g.get(i);if(L&&F)return L==i&&F==e;var z=-1,G=!0,ee=a&V?new Ni:t;for(g.set(e,i),g.set(i,e);++z<w;){var ne=e[z],_e=i[z];if(u)var se=m?u(_e,ne,z,i,e,g):u(ne,_e,z,e,i,g);if(se!==t){if(se)continue;G=!1;break}if(ee){if(!ea(i,function(xe,Oe){if(!xn(ee,Oe)&&(ne===xe||f(ne,xe,a,u,g)))return ee.push(Oe)})){G=!1;break}}else if(!(ne===_e||f(ne,_e,a,u,g))){G=!1;break}}return g.delete(e),g.delete(i),G}function fg(e,i,a,u,f,g,m){switch(a){case Ve:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Ne:return!(e.byteLength!=i.byteLength||!g(new Ls(e),new Ls(i)));case A:case P:case Te:return Nr(+e,+i);case b:return e.name==i.name&&e.message==i.message;case st:case Qe:return e==i+"";case ve:var w=oa;case Fe:var I=u&U;if(w||(w=Rs),e.size!=i.size&&!I)return!1;var L=m.get(e);if(L)return L==i;u|=V,m.set(e,i);var F=ih(w(e),w(i),u,f,g,m);return m.delete(e),F;case Ye:if(Rn)return Rn.call(e)==Rn.call(i)}return!1}function pg(e,i,a,u,f,g){var m=a&U,w=Ta(e),I=w.length,L=Ta(i),F=L.length;if(I!=F&&!m)return!1;for(var z=I;z--;){var G=w[z];if(!(m?G in i:qe.call(i,G)))return!1}var ee=g.get(e),ne=g.get(i);if(ee&&ne)return ee==i&&ne==e;var _e=!0;g.set(e,i),g.set(i,e);for(var se=m;++z<I;){G=w[z];var xe=e[G],Oe=i[G];if(u)var dr=m?u(Oe,xe,G,i,e,g):u(xe,Oe,G,e,i,g);if(!(dr===t?xe===Oe||f(xe,Oe,a,u,g):dr)){_e=!1;break}se||(se=G=="constructor")}if(_e&&!se){var Zt=e.constructor,gr=i.constructor;Zt!=gr&&"constructor"in e&&"constructor"in i&&!(typeof Zt=="function"&&Zt instanceof Zt&&typeof gr=="function"&&gr instanceof gr)&&(_e=!1)}return g.delete(e),g.delete(i),_e}function Xr(e){return Ma(uh(e,t,_h),e+"")}function Ta(e){return xu(e,zt,Fa)}function Na(e){return xu(e,or,nh)}var $a=zs?function(e){return zs.get(e)}:Xa;function eo(e){for(var i=e.name+"",a=rn[i],u=qe.call(rn,i)?a.length:0;u--;){var f=a[u],g=f.func;if(g==null||g==e)return f.name}return i}function an(e){var i=qe.call(d,"placeholder")?d:e;return i.placeholder}function ie(){var e=d.iteratee||Qa;return e=e===Qa?Pu:e,arguments.length?e(arguments[0],arguments[1]):e}function to(e,i){var a=e.__data__;return bg(i)?a[typeof i=="string"?"string":"hash"]:a.map}function La(e){for(var i=zt(e),a=i.length;a--;){var u=i[a],f=e[u];i[a]=[u,f,ah(f)]}return i}function Fi(e,i){var a=Ip(e,i);return Su(a)?a:t}function dg(e){var i=qe.call(e,Ai),a=e[Ai];try{e[Ai]=t;var u=!0}catch{}var f=Ns.call(e);return u&&(i?e[Ai]=a:delete e[Ai]),f}var Fa=ca?function(e){return e==null?[]:(e=We(e),hi(ca(e),function(i){return hu.call(e,i)}))}:Za,nh=ca?function(e){for(var i=[];e;)li(i,Fa(e)),e=Fs(e);return i}:Za,Kt=Yt;(ua&&Kt(new ua(new ArrayBuffer(1)))!=Ve||Sn&&Kt(new Sn)!=ve||ha&&Kt(ha.resolve())!=St||tn&&Kt(new tn)!=Fe||Pn&&Kt(new Pn)!=ze)&&(Kt=function(e){var i=Yt(e),a=i==Ie?e.constructor:t,u=a?Di(a):"";if(u)switch(u){case Qp:return Ve;case Yp:return ve;case Xp:return St;case Zp:return Fe;case ed:return ze}return i});function gg(e,i,a){for(var u=-1,f=a.length;++u<f;){var g=a[u],m=g.size;switch(g.type){case"drop":e+=m;break;case"dropRight":i-=m;break;case"take":i=Bt(i,e+m);break;case"takeRight":e=jt(e,i-m);break}}return{start:e,end:i}}function yg(e){var i=e.match(Je);return i?i[1].split(At):[]}function sh(e,i,a){i=yi(i,e);for(var u=-1,f=i.length,g=!1;++u<f;){var m=Hr(i[u]);if(!(g=e!=null&&a(e,m)))break;e=e[m]}return g||++u!=f?g:(f=e==null?0:e.length,!!f&&co(f)&&Zr(m,f)&&(fe(e)||ji(e)))}function vg(e){var i=e.length,a=new e.constructor(i);return i&&typeof e[0]=="string"&&qe.call(e,"index")&&(a.index=e.index,a.input=e.input),a}function oh(e){return typeof e.constructor=="function"&&!Fn(e)?nn(Fs(e)):{}}function _g(e,i,a){var u=e.constructor;switch(i){case Ne:return Ra(e);case A:case P:return new u(+e);case Ve:return tg(e,a);case ht:case je:case Pt:case Ft:case Ut:case Ht:case qt:case Wt:case rr:return Hu(e,a);case ve:return new u;case Te:case Qe:return new u(e);case st:return rg(e);case Fe:return new u;case Ye:return ig(e)}}function mg(e,i){var a=i.length;if(!a)return e;var u=a-1;return i[u]=(a>1?"& ":"")+i[u],i=i.join(a>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+i+`] */
`)}function wg(e){return fe(e)||ji(e)||!!(lu&&e&&e[lu])}function Zr(e,i){var a=typeof e;return i=i??J,!!i&&(a=="number"||a!="symbol"&&qo.test(e))&&e>-1&&e%1==0&&e<i}function Xt(e,i,a){if(!ct(a))return!1;var u=typeof i;return(u=="number"?sr(a)&&Zr(i,a.length):u=="string"&&i in a)?Nr(a[i],e):!1}function Da(e,i){if(fe(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||pr(e)?!0:Ot.test(e)||!it.test(e)||i!=null&&e in We(i)}function bg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function ja(e){var i=eo(e),a=d[i];if(typeof a!="function"||!(i in Se.prototype))return!1;if(e===a)return!0;var u=$a(a);return!!u&&e===u[0]}function Eg(e){return!!au&&au in e}var xg=As?ei:ec;function Fn(e){var i=e&&e.constructor,a=typeof i=="function"&&i.prototype||en;return e===a}function ah(e){return e===e&&!ct(e)}function ch(e,i){return function(a){return a==null?!1:a[e]===i&&(i!==t||e in We(a))}}function Ig(e){var i=oo(e,function(u){return a.size===y&&a.clear(),u}),a=i.cache;return i}function Sg(e,i){var a=e[1],u=i[1],f=a|u,g=f<(oe|be|H),m=u==H&&a==pe||u==H&&a==W&&e[7].length<=i[8]||u==(H|W)&&i[7].length<=i[8]&&a==pe;if(!(g||m))return e;u&oe&&(e[2]=i[2],f|=a&oe?0:de);var w=i[3];if(w){var I=e[3];e[3]=I?Vu(I,w,i[4]):w,e[4]=I?fi(e[3],S):i[4]}return w=i[5],w&&(I=e[5],e[5]=I?Bu(I,w,i[6]):w,e[6]=I?fi(e[5],S):i[6]),w=i[7],w&&(e[7]=w),u&H&&(e[8]=e[8]==null?i[8]:Bt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=f,e}function Pg(e){var i=[];if(e!=null)for(var a in We(e))i.push(a);return i}function Og(e){return Ns.call(e)}function uh(e,i,a){return i=jt(i===t?e.length-1:i,0),function(){for(var u=arguments,f=-1,g=jt(u.length-i,0),m=R(g);++f<g;)m[f]=u[i+f];f=-1;for(var w=R(i+1);++f<i;)w[f]=u[f];return w[i]=a(m),Mt(e,this,w)}}function hh(e,i){return i.length<2?e:Li(e,Ir(i,0,-1))}function Rg(e,i){for(var a=e.length,u=Bt(i.length,a),f=nr(e);u--;){var g=i[u];e[u]=Zr(g,a)?f[g]:t}return e}function qa(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var lh=ph(Lu),Dn=kp||function(e,i){return Pe.setTimeout(e,i)},Ma=ph(Yd);function fh(e,i,a){var u=i+"";return Ma(e,mg(u,Cg(yg(u),a)))}function ph(e){var i=0,a=0;return function(){var u=Gp(),f=tt-(u-a);if(a=u,f>0){if(++i>=Ce)return arguments[0]}else i=0;return e.apply(t,arguments)}}function ro(e,i){var a=-1,u=e.length,f=u-1;for(i=i===t?u:i;++a<i;){var g=ba(a,f),m=e[g];e[g]=e[a],e[a]=m}return e.length=i,e}var dh=Ig(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Rt,function(a,u,f,g){i.push(f?g.replace(No,"$1"):u||a)}),i});function Hr(e){if(typeof e=="string"||pr(e))return e;var i=e+"";return i=="0"&&1/e==-Ae?"-0":i}function Di(e){if(e!=null){try{return Ts.call(e)}catch{}try{return e+""}catch{}}return""}function Cg(e,i){return wr(Dr,function(a){var u="_."+a[0];i&a[1]&&!Ps(e,u)&&e.push(u)}),e.sort()}function gh(e){if(e instanceof Se)return e.clone();var i=new Er(e.__wrapped__,e.__chain__);return i.__actions__=nr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function Ag(e,i,a){(a?Xt(e,i,a):i===t)?i=1:i=jt(ye(i),0);var u=e==null?0:e.length;if(!u||i<1)return[];for(var f=0,g=0,m=R(qs(u/i));f<u;)m[g++]=Ir(e,f,f+=i);return m}function Tg(e){for(var i=-1,a=e==null?0:e.length,u=0,f=[];++i<a;){var g=e[i];g&&(f[u++]=g)}return f}function Ng(){var e=arguments.length;if(!e)return[];for(var i=R(e-1),a=arguments[0],u=e;u--;)i[u-1]=arguments[u];return li(fe(a)?nr(a):[a],kt(i,1))}var $g=we(function(e,i){return bt(e)?An(e,kt(i,1,bt,!0)):[]}),Lg=we(function(e,i){var a=Sr(i);return bt(a)&&(a=t),bt(e)?An(e,kt(i,1,bt,!0),ie(a,2)):[]}),Fg=we(function(e,i){var a=Sr(i);return bt(a)&&(a=t),bt(e)?An(e,kt(i,1,bt,!0),t,a):[]});function Dg(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===t?1:ye(i),Ir(e,i<0?0:i,u)):[]}function jg(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===t?1:ye(i),i=u-i,Ir(e,0,i<0?0:i)):[]}function qg(e,i){return e&&e.length?Ws(e,ie(i,3),!0,!0):[]}function Mg(e,i){return e&&e.length?Ws(e,ie(i,3),!0):[]}function zg(e,i,a,u){var f=e==null?0:e.length;return f?(a&&typeof a!="number"&&Xt(e,i,a)&&(a=0,u=f),Nd(e,i,a,u)):[]}function yh(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=a==null?0:ye(a);return f<0&&(f=jt(u+f,0)),Os(e,ie(i,3),f)}function vh(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=u-1;return a!==t&&(f=ye(a),f=a<0?jt(u+f,0):Bt(f,u-1)),Os(e,ie(i,3),f,!0)}function _h(e){var i=e==null?0:e.length;return i?kt(e,1):[]}function Ug(e){var i=e==null?0:e.length;return i?kt(e,Ae):[]}function Hg(e,i){var a=e==null?0:e.length;return a?(i=i===t?1:ye(i),kt(e,i)):[]}function kg(e){for(var i=-1,a=e==null?0:e.length,u={};++i<a;){var f=e[i];u[f[0]]=f[1]}return u}function mh(e){return e&&e.length?e[0]:t}function Vg(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=a==null?0:ye(a);return f<0&&(f=jt(u+f,0)),Qi(e,i,f)}function Bg(e){var i=e==null?0:e.length;return i?Ir(e,0,-1):[]}var Kg=we(function(e){var i=nt(e,Pa);return i.length&&i[0]===e[0]?ya(i):[]}),Gg=we(function(e){var i=Sr(e),a=nt(e,Pa);return i===Sr(a)?i=t:a.pop(),a.length&&a[0]===e[0]?ya(a,ie(i,2)):[]}),Wg=we(function(e){var i=Sr(e),a=nt(e,Pa);return i=typeof i=="function"?i:t,i&&a.pop(),a.length&&a[0]===e[0]?ya(a,t,i):[]});function Jg(e,i){return e==null?"":Bp.call(e,i)}function Sr(e){var i=e==null?0:e.length;return i?e[i-1]:t}function Qg(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=u;return a!==t&&(f=ye(a),f=f<0?jt(u+f,0):Bt(f,u-1)),i===i?Cp(e,i,f):Os(e,Zc,f,!0)}function Yg(e,i){return e&&e.length?Au(e,ye(i)):t}var Xg=we(wh);function wh(e,i){return e&&e.length&&i&&i.length?wa(e,i):e}function Zg(e,i,a){return e&&e.length&&i&&i.length?wa(e,i,ie(a,2)):e}function ey(e,i,a){return e&&e.length&&i&&i.length?wa(e,i,t,a):e}var ty=Xr(function(e,i){var a=e==null?0:e.length,u=fa(e,i);return $u(e,nt(i,function(f){return Zr(f,a)?+f:f}).sort(ku)),u});function ry(e,i){var a=[];if(!(e&&e.length))return a;var u=-1,f=[],g=e.length;for(i=ie(i,3);++u<g;){var m=e[u];i(m,u,e)&&(a.push(m),f.push(u))}return $u(e,f),a}function za(e){return e==null?e:Jp.call(e)}function iy(e,i,a){var u=e==null?0:e.length;return u?(a&&typeof a!="number"&&Xt(e,i,a)?(i=0,a=u):(i=i==null?0:ye(i),a=a===t?u:ye(a)),Ir(e,i,a)):[]}function ny(e,i){return Gs(e,i)}function sy(e,i,a){return xa(e,i,ie(a,2))}function oy(e,i){var a=e==null?0:e.length;if(a){var u=Gs(e,i);if(u<a&&Nr(e[u],i))return u}return-1}function ay(e,i){return Gs(e,i,!0)}function cy(e,i,a){return xa(e,i,ie(a,2),!0)}function uy(e,i){var a=e==null?0:e.length;if(a){var u=Gs(e,i,!0)-1;if(Nr(e[u],i))return u}return-1}function hy(e){return e&&e.length?Fu(e):[]}function ly(e,i){return e&&e.length?Fu(e,ie(i,2)):[]}function fy(e){var i=e==null?0:e.length;return i?Ir(e,1,i):[]}function py(e,i,a){return e&&e.length?(i=a||i===t?1:ye(i),Ir(e,0,i<0?0:i)):[]}function dy(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===t?1:ye(i),i=u-i,Ir(e,i<0?0:i,u)):[]}function gy(e,i){return e&&e.length?Ws(e,ie(i,3),!1,!0):[]}function yy(e,i){return e&&e.length?Ws(e,ie(i,3)):[]}var vy=we(function(e){return gi(kt(e,1,bt,!0))}),_y=we(function(e){var i=Sr(e);return bt(i)&&(i=t),gi(kt(e,1,bt,!0),ie(i,2))}),my=we(function(e){var i=Sr(e);return i=typeof i=="function"?i:t,gi(kt(e,1,bt,!0),t,i)});function wy(e){return e&&e.length?gi(e):[]}function by(e,i){return e&&e.length?gi(e,ie(i,2)):[]}function Ey(e,i){return i=typeof i=="function"?i:t,e&&e.length?gi(e,t,i):[]}function Ua(e){if(!(e&&e.length))return[];var i=0;return e=hi(e,function(a){if(bt(a))return i=jt(a.length,i),!0}),na(i,function(a){return nt(e,ta(a))})}function bh(e,i){if(!(e&&e.length))return[];var a=Ua(e);return i==null?a:nt(a,function(u){return Mt(i,t,u)})}var xy=we(function(e,i){return bt(e)?An(e,i):[]}),Iy=we(function(e){return Sa(hi(e,bt))}),Sy=we(function(e){var i=Sr(e);return bt(i)&&(i=t),Sa(hi(e,bt),ie(i,2))}),Py=we(function(e){var i=Sr(e);return i=typeof i=="function"?i:t,Sa(hi(e,bt),t,i)}),Oy=we(Ua);function Ry(e,i){return Mu(e||[],i||[],Cn)}function Cy(e,i){return Mu(e||[],i||[],$n)}var Ay=we(function(e){var i=e.length,a=i>1?e[i-1]:t;return a=typeof a=="function"?(e.pop(),a):t,bh(e,a)});function Eh(e){var i=d(e);return i.__chain__=!0,i}function Ty(e,i){return i(e),e}function io(e,i){return i(e)}var Ny=Xr(function(e){var i=e.length,a=i?e[0]:0,u=this.__wrapped__,f=function(g){return fa(g,e)};return i>1||this.__actions__.length||!(u instanceof Se)||!Zr(a)?this.thru(f):(u=u.slice(a,+a+(i?1:0)),u.__actions__.push({func:io,args:[f],thisArg:t}),new Er(u,this.__chain__).thru(function(g){return i&&!g.length&&g.push(t),g}))});function $y(){return Eh(this)}function Ly(){return new Er(this.value(),this.__chain__)}function Fy(){this.__values__===t&&(this.__values__=Dh(this.value()));var e=this.__index__>=this.__values__.length,i=e?t:this.__values__[this.__index__++];return{done:e,value:i}}function Dy(){return this}function jy(e){for(var i,a=this;a instanceof Hs;){var u=gh(a);u.__index__=0,u.__values__=t,i?f.__wrapped__=u:i=u;var f=u;a=a.__wrapped__}return f.__wrapped__=e,i}function qy(){var e=this.__wrapped__;if(e instanceof Se){var i=e;return this.__actions__.length&&(i=new Se(this)),i=i.reverse(),i.__actions__.push({func:io,args:[za],thisArg:t}),new Er(i,this.__chain__)}return this.thru(za)}function My(){return qu(this.__wrapped__,this.__actions__)}var zy=Js(function(e,i,a){qe.call(e,a)?++e[a]:Qr(e,a,1)});function Uy(e,i,a){var u=fe(e)?Yc:Td;return a&&Xt(e,i,a)&&(i=t),u(e,ie(i,3))}function Hy(e,i){var a=fe(e)?hi:bu;return a(e,ie(i,3))}var ky=Ju(yh),Vy=Ju(vh);function By(e,i){return kt(no(e,i),1)}function Ky(e,i){return kt(no(e,i),Ae)}function Gy(e,i,a){return a=a===t?1:ye(a),kt(no(e,i),a)}function xh(e,i){var a=fe(e)?wr:di;return a(e,ie(i,3))}function Ih(e,i){var a=fe(e)?fp:wu;return a(e,ie(i,3))}var Wy=Js(function(e,i,a){qe.call(e,a)?e[a].push(i):Qr(e,a,[i])});function Jy(e,i,a,u){e=sr(e)?e:un(e),a=a&&!u?ye(a):0;var f=e.length;return a<0&&(a=jt(f+a,0)),uo(e)?a<=f&&e.indexOf(i,a)>-1:!!f&&Qi(e,i,a)>-1}var Qy=we(function(e,i,a){var u=-1,f=typeof i=="function",g=sr(e)?R(e.length):[];return di(e,function(m){g[++u]=f?Mt(i,m,a):Tn(m,i,a)}),g}),Yy=Js(function(e,i,a){Qr(e,a,i)});function no(e,i){var a=fe(e)?nt:Ou;return a(e,ie(i,3))}function Xy(e,i,a,u){return e==null?[]:(fe(i)||(i=i==null?[]:[i]),a=u?t:a,fe(a)||(a=a==null?[]:[a]),Tu(e,i,a))}var Zy=Js(function(e,i,a){e[a?0:1].push(i)},function(){return[[],[]]});function ev(e,i,a){var u=fe(e)?Zo:tu,f=arguments.length<3;return u(e,ie(i,4),a,f,di)}function tv(e,i,a){var u=fe(e)?pp:tu,f=arguments.length<3;return u(e,ie(i,4),a,f,wu)}function rv(e,i){var a=fe(e)?hi:bu;return a(e,ao(ie(i,3)))}function iv(e){var i=fe(e)?yu:Jd;return i(e)}function nv(e,i,a){(a?Xt(e,i,a):i===t)?i=1:i=ye(i);var u=fe(e)?Pd:Qd;return u(e,i)}function sv(e){var i=fe(e)?Od:Xd;return i(e)}function ov(e){if(e==null)return 0;if(sr(e))return uo(e)?Xi(e):e.length;var i=Kt(e);return i==ve||i==Fe?e.size:_a(e).length}function av(e,i,a){var u=fe(e)?ea:Zd;return a&&Xt(e,i,a)&&(i=t),u(e,ie(i,3))}var cv=we(function(e,i){if(e==null)return[];var a=i.length;return a>1&&Xt(e,i[0],i[1])?i=[]:a>2&&Xt(i[0],i[1],i[2])&&(i=[i[0]]),Tu(e,kt(i,1),[])}),so=Hp||function(){return Pe.Date.now()};function uv(e,i){if(typeof i!="function")throw new br(l);return e=ye(e),function(){if(--e<1)return i.apply(this,arguments)}}function Sh(e,i,a){return i=a?t:i,i=e&&i==null?e.length:i,Yr(e,H,t,t,t,t,i)}function Ph(e,i){var a;if(typeof i!="function")throw new br(l);return e=ye(e),function(){return--e>0&&(a=i.apply(this,arguments)),e<=1&&(i=t),a}}var Ha=we(function(e,i,a){var u=oe;if(a.length){var f=fi(a,an(Ha));u|=he}return Yr(e,u,i,a,f)}),Oh=we(function(e,i,a){var u=oe|be;if(a.length){var f=fi(a,an(Oh));u|=he}return Yr(i,u,e,a,f)});function Rh(e,i,a){i=a?t:i;var u=Yr(e,pe,t,t,t,t,t,i);return u.placeholder=Rh.placeholder,u}function Ch(e,i,a){i=a?t:i;var u=Yr(e,ue,t,t,t,t,t,i);return u.placeholder=Ch.placeholder,u}function Ah(e,i,a){var u,f,g,m,w,I,L=0,F=!1,z=!1,G=!0;if(typeof e!="function")throw new br(l);i=Pr(i)||0,ct(a)&&(F=!!a.leading,z="maxWait"in a,g=z?jt(Pr(a.maxWait)||0,i):g,G="trailing"in a?!!a.trailing:G);function ee(Et){var $r=u,ri=f;return u=f=t,L=Et,m=e.apply(ri,$r),m}function ne(Et){return L=Et,w=Dn(xe,i),F?ee(Et):m}function _e(Et){var $r=Et-I,ri=Et-L,Jh=i-$r;return z?Bt(Jh,g-ri):Jh}function se(Et){var $r=Et-I,ri=Et-L;return I===t||$r>=i||$r<0||z&&ri>=g}function xe(){var Et=so();if(se(Et))return Oe(Et);w=Dn(xe,_e(Et))}function Oe(Et){return w=t,G&&u?ee(Et):(u=f=t,m)}function dr(){w!==t&&zu(w),L=0,u=I=f=w=t}function Zt(){return w===t?m:Oe(so())}function gr(){var Et=so(),$r=se(Et);if(u=arguments,f=this,I=Et,$r){if(w===t)return ne(I);if(z)return zu(w),w=Dn(xe,i),ee(I)}return w===t&&(w=Dn(xe,i)),m}return gr.cancel=dr,gr.flush=Zt,gr}var hv=we(function(e,i){return mu(e,1,i)}),lv=we(function(e,i,a){return mu(e,Pr(i)||0,a)});function fv(e){return Yr(e,ge)}function oo(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new br(l);var a=function(){var u=arguments,f=i?i.apply(this,u):u[0],g=a.cache;if(g.has(f))return g.get(f);var m=e.apply(this,u);return a.cache=g.set(f,m)||g,m};return a.cache=new(oo.Cache||Jr),a}oo.Cache=Jr;function ao(e){if(typeof e!="function")throw new br(l);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function pv(e){return Ph(2,e)}var dv=eg(function(e,i){i=i.length==1&&fe(i[0])?nt(i[0],lr(ie())):nt(kt(i,1),lr(ie()));var a=i.length;return we(function(u){for(var f=-1,g=Bt(u.length,a);++f<g;)u[f]=i[f].call(this,u[f]);return Mt(e,this,u)})}),ka=we(function(e,i){var a=fi(i,an(ka));return Yr(e,he,t,i,a)}),Th=we(function(e,i){var a=fi(i,an(Th));return Yr(e,N,t,i,a)}),gv=Xr(function(e,i){return Yr(e,W,t,t,t,i)});function yv(e,i){if(typeof e!="function")throw new br(l);return i=i===t?i:ye(i),we(e,i)}function vv(e,i){if(typeof e!="function")throw new br(l);return i=i==null?0:jt(ye(i),0),we(function(a){var u=a[i],f=vi(a,0,i);return u&&li(f,u),Mt(e,this,f)})}function _v(e,i,a){var u=!0,f=!0;if(typeof e!="function")throw new br(l);return ct(a)&&(u="leading"in a?!!a.leading:u,f="trailing"in a?!!a.trailing:f),Ah(e,i,{leading:u,maxWait:i,trailing:f})}function mv(e){return Sh(e,1)}function wv(e,i){return ka(Oa(i),e)}function bv(){if(!arguments.length)return[];var e=arguments[0];return fe(e)?e:[e]}function Ev(e){return xr(e,M)}function xv(e,i){return i=typeof i=="function"?i:t,xr(e,M,i)}function Iv(e){return xr(e,D|M)}function Sv(e,i){return i=typeof i=="function"?i:t,xr(e,D|M,i)}function Pv(e,i){return i==null||_u(e,i,zt(i))}function Nr(e,i){return e===i||e!==e&&i!==i}var Ov=Zs(ga),Rv=Zs(function(e,i){return e>=i}),ji=Iu(function(){return arguments}())?Iu:function(e){return vt(e)&&qe.call(e,"callee")&&!hu.call(e,"callee")},fe=R.isArray,Cv=Qt?lr(Qt):jd;function sr(e){return e!=null&&co(e.length)&&!ei(e)}function bt(e){return vt(e)&&sr(e)}function Av(e){return e===!0||e===!1||vt(e)&&Yt(e)==A}var _i=Vp||ec,Tv=Cr?lr(Cr):qd;function Nv(e){return vt(e)&&e.nodeType===1&&!jn(e)}function $v(e){if(e==null)return!0;if(sr(e)&&(fe(e)||typeof e=="string"||typeof e.splice=="function"||_i(e)||cn(e)||ji(e)))return!e.length;var i=Kt(e);if(i==ve||i==Fe)return!e.size;if(Fn(e))return!_a(e).length;for(var a in e)if(qe.call(e,a))return!1;return!0}function Lv(e,i){return Nn(e,i)}function Fv(e,i,a){a=typeof a=="function"?a:t;var u=a?a(e,i):t;return u===t?Nn(e,i,t,a):!!u}function Va(e){if(!vt(e))return!1;var i=Yt(e);return i==b||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!jn(e)}function Dv(e){return typeof e=="number"&&fu(e)}function ei(e){if(!ct(e))return!1;var i=Yt(e);return i==Z||i==ae||i==T||i==_t}function Nh(e){return typeof e=="number"&&e==ye(e)}function co(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=J}function ct(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function vt(e){return e!=null&&typeof e=="object"}var $h=mr?lr(mr):zd;function jv(e,i){return e===i||va(e,i,La(i))}function qv(e,i,a){return a=typeof a=="function"?a:t,va(e,i,La(i),a)}function Mv(e){return Lh(e)&&e!=+e}function zv(e){if(xg(e))throw new ce(c);return Su(e)}function Uv(e){return e===null}function Hv(e){return e==null}function Lh(e){return typeof e=="number"||vt(e)&&Yt(e)==Te}function jn(e){if(!vt(e)||Yt(e)!=Ie)return!1;var i=Fs(e);if(i===null)return!0;var a=qe.call(i,"constructor")&&i.constructor;return typeof a=="function"&&a instanceof a&&Ts.call(a)==qp}var Ba=Mr?lr(Mr):Ud;function kv(e){return Nh(e)&&e>=-J&&e<=J}var Fh=En?lr(En):Hd;function uo(e){return typeof e=="string"||!fe(e)&&vt(e)&&Yt(e)==Qe}function pr(e){return typeof e=="symbol"||vt(e)&&Yt(e)==Ye}var cn=Ci?lr(Ci):kd;function Vv(e){return e===t}function Bv(e){return vt(e)&&Kt(e)==ze}function Kv(e){return vt(e)&&Yt(e)==Xe}var Gv=Zs(ma),Wv=Zs(function(e,i){return e<=i});function Dh(e){if(!e)return[];if(sr(e))return uo(e)?Ar(e):nr(e);if(In&&e[In])return Pp(e[In]());var i=Kt(e),a=i==ve?oa:i==Fe?Rs:un;return a(e)}function ti(e){if(!e)return e===0?e:0;if(e=Pr(e),e===Ae||e===-Ae){var i=e<0?-1:1;return i*B}return e===e?e:0}function ye(e){var i=ti(e),a=i%1;return i===i?a?i-a:i:0}function jh(e){return e?$i(ye(e),0,K):0}function Pr(e){if(typeof e=="number")return e;if(pr(e))return k;if(ct(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=ct(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=ru(e);var a=Fo.test(e);return a||jo.test(e)?le(e.slice(2),a?2:8):Lo.test(e)?k:+e}function qh(e){return Ur(e,or(e))}function Jv(e){return e?$i(ye(e),-J,J):e===0?e:0}function De(e){return e==null?"":fr(e)}var Qv=sn(function(e,i){if(Fn(i)||sr(i)){Ur(i,zt(i),e);return}for(var a in i)qe.call(i,a)&&Cn(e,a,i[a])}),Mh=sn(function(e,i){Ur(i,or(i),e)}),ho=sn(function(e,i,a,u){Ur(i,or(i),e,u)}),Yv=sn(function(e,i,a,u){Ur(i,zt(i),e,u)}),Xv=Xr(fa);function Zv(e,i){var a=nn(e);return i==null?a:vu(a,i)}var e0=we(function(e,i){e=We(e);var a=-1,u=i.length,f=u>2?i[2]:t;for(f&&Xt(i[0],i[1],f)&&(u=1);++a<u;)for(var g=i[a],m=or(g),w=-1,I=m.length;++w<I;){var L=m[w],F=e[L];(F===t||Nr(F,en[L])&&!qe.call(e,L))&&(e[L]=g[L])}return e}),t0=we(function(e){return e.push(t,rh),Mt(zh,t,e)});function r0(e,i){return Xc(e,ie(i,3),zr)}function i0(e,i){return Xc(e,ie(i,3),da)}function n0(e,i){return e==null?e:pa(e,ie(i,3),or)}function s0(e,i){return e==null?e:Eu(e,ie(i,3),or)}function o0(e,i){return e&&zr(e,ie(i,3))}function a0(e,i){return e&&da(e,ie(i,3))}function c0(e){return e==null?[]:Bs(e,zt(e))}function u0(e){return e==null?[]:Bs(e,or(e))}function Ka(e,i,a){var u=e==null?t:Li(e,i);return u===t?a:u}function h0(e,i){return e!=null&&sh(e,i,$d)}function Ga(e,i){return e!=null&&sh(e,i,Ld)}var l0=Yu(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=Ns.call(i)),e[i]=a},Ja(ar)),f0=Yu(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=Ns.call(i)),qe.call(e,i)?e[i].push(a):e[i]=[a]},ie),p0=we(Tn);function zt(e){return sr(e)?gu(e):_a(e)}function or(e){return sr(e)?gu(e,!0):Vd(e)}function d0(e,i){var a={};return i=ie(i,3),zr(e,function(u,f,g){Qr(a,i(u,f,g),u)}),a}function g0(e,i){var a={};return i=ie(i,3),zr(e,function(u,f,g){Qr(a,f,i(u,f,g))}),a}var y0=sn(function(e,i,a){Ks(e,i,a)}),zh=sn(function(e,i,a,u){Ks(e,i,a,u)}),v0=Xr(function(e,i){var a={};if(e==null)return a;var u=!1;i=nt(i,function(g){return g=yi(g,e),u||(u=g.length>1),g}),Ur(e,Na(e),a),u&&(a=xr(a,D|O|M,lg));for(var f=i.length;f--;)Ia(a,i[f]);return a});function _0(e,i){return Uh(e,ao(ie(i)))}var m0=Xr(function(e,i){return e==null?{}:Kd(e,i)});function Uh(e,i){if(e==null)return{};var a=nt(Na(e),function(u){return[u]});return i=ie(i),Nu(e,a,function(u,f){return i(u,f[0])})}function w0(e,i,a){i=yi(i,e);var u=-1,f=i.length;for(f||(f=1,e=t);++u<f;){var g=e==null?t:e[Hr(i[u])];g===t&&(u=f,g=a),e=ei(g)?g.call(e):g}return e}function b0(e,i,a){return e==null?e:$n(e,i,a)}function E0(e,i,a,u){return u=typeof u=="function"?u:t,e==null?e:$n(e,i,a,u)}var Hh=eh(zt),kh=eh(or);function x0(e,i,a){var u=fe(e),f=u||_i(e)||cn(e);if(i=ie(i,4),a==null){var g=e&&e.constructor;f?a=u?new g:[]:ct(e)?a=ei(g)?nn(Fs(e)):{}:a={}}return(f?wr:zr)(e,function(m,w,I){return i(a,m,w,I)}),a}function I0(e,i){return e==null?!0:Ia(e,i)}function S0(e,i,a){return e==null?e:ju(e,i,Oa(a))}function P0(e,i,a,u){return u=typeof u=="function"?u:t,e==null?e:ju(e,i,Oa(a),u)}function un(e){return e==null?[]:sa(e,zt(e))}function O0(e){return e==null?[]:sa(e,or(e))}function R0(e,i,a){return a===t&&(a=i,i=t),a!==t&&(a=Pr(a),a=a===a?a:0),i!==t&&(i=Pr(i),i=i===i?i:0),$i(Pr(e),i,a)}function C0(e,i,a){return i=ti(i),a===t?(a=i,i=0):a=ti(a),e=Pr(e),Fd(e,i,a)}function A0(e,i,a){if(a&&typeof a!="boolean"&&Xt(e,i,a)&&(i=a=t),a===t&&(typeof i=="boolean"?(a=i,i=t):typeof e=="boolean"&&(a=e,e=t)),e===t&&i===t?(e=0,i=1):(e=ti(e),i===t?(i=e,e=0):i=ti(i)),e>i){var u=e;e=i,i=u}if(a||e%1||i%1){var f=pu();return Bt(e+f*(i-e+Ke("1e-"+((f+"").length-1))),i)}return ba(e,i)}var T0=on(function(e,i,a){return i=i.toLowerCase(),e+(a?Vh(i):i)});function Vh(e){return Wa(De(e).toLowerCase())}function Bh(e){return e=De(e),e&&e.replace(Kr,bp).replace(Qo,"")}function N0(e,i,a){e=De(e),i=fr(i);var u=e.length;a=a===t?u:$i(ye(a),0,u);var f=a;return a-=i.length,a>=0&&e.slice(a,f)==i}function $0(e){return e=De(e),e&&rt.test(e)?e.replace(Ii,Ep):e}function L0(e){return e=De(e),e&&Ct.test(e)?e.replace(dt,"\\$&"):e}var F0=on(function(e,i,a){return e+(a?"-":"")+i.toLowerCase()}),D0=on(function(e,i,a){return e+(a?" ":"")+i.toLowerCase()}),j0=Wu("toLowerCase");function q0(e,i,a){e=De(e),i=ye(i);var u=i?Xi(e):0;if(!i||u>=i)return e;var f=(i-u)/2;return Xs(Ms(f),a)+e+Xs(qs(f),a)}function M0(e,i,a){e=De(e),i=ye(i);var u=i?Xi(e):0;return i&&u<i?e+Xs(i-u,a):e}function z0(e,i,a){e=De(e),i=ye(i);var u=i?Xi(e):0;return i&&u<i?Xs(i-u,a)+e:e}function U0(e,i,a){return a||i==null?i=0:i&&(i=+i),Wp(De(e).replace(gt,""),i||0)}function H0(e,i,a){return(a?Xt(e,i,a):i===t)?i=1:i=ye(i),Ea(De(e),i)}function k0(){var e=arguments,i=De(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var V0=on(function(e,i,a){return e+(a?"_":"")+i.toLowerCase()});function B0(e,i,a){return a&&typeof a!="number"&&Xt(e,i,a)&&(i=a=t),a=a===t?K:a>>>0,a?(e=De(e),e&&(typeof i=="string"||i!=null&&!Ba(i))&&(i=fr(i),!i&&Yi(e))?vi(Ar(e),0,a):e.split(i,a)):[]}var K0=on(function(e,i,a){return e+(a?" ":"")+Wa(i)});function G0(e,i,a){return e=De(e),a=a==null?0:$i(ye(a),0,e.length),i=fr(i),e.slice(a,a+i.length)==i}function W0(e,i,a){var u=d.templateSettings;a&&Xt(e,i,a)&&(i=t),e=De(e),i=ho({},i,u,th);var f=ho({},i.imports,u.imports,th),g=zt(f),m=sa(f,g),w,I,L=0,F=i.interpolate||ki,z="__p += '",G=aa((i.escape||ki).source+"|"+F.source+"|"+(F===at?$o:ki).source+"|"+(i.evaluate||ki).source+"|$","g"),ee="//# sourceURL="+(qe.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Yo+"]")+`
`;e.replace(G,function(se,xe,Oe,dr,Zt,gr){return Oe||(Oe=dr),z+=e.slice(L,gr).replace(Mo,xp),xe&&(w=!0,z+=`' +
__e(`+xe+`) +
'`),Zt&&(I=!0,z+=`';
`+Zt+`;
__p += '`),Oe&&(z+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),L=gr+se.length,se}),z+=`';
`;var ne=qe.call(i,"variable")&&i.variable;if(!ne)z=`with (obj) {
`+z+`
}
`;else if(To.test(ne))throw new ce(p);z=(I?z.replace(jr,""):z).replace(Jt,"$1").replace(Br,"$1;"),z="function("+(ne||"obj")+`) {
`+(ne?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(w?", __e = _.escape":"")+(I?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+z+`return __p
}`;var _e=Gh(function(){return Le(g,ee+"return "+z).apply(t,m)});if(_e.source=z,Va(_e))throw _e;return _e}function J0(e){return De(e).toLowerCase()}function Q0(e){return De(e).toUpperCase()}function Y0(e,i,a){if(e=De(e),e&&(a||i===t))return ru(e);if(!e||!(i=fr(i)))return e;var u=Ar(e),f=Ar(i),g=iu(u,f),m=nu(u,f)+1;return vi(u,g,m).join("")}function X0(e,i,a){if(e=De(e),e&&(a||i===t))return e.slice(0,ou(e)+1);if(!e||!(i=fr(i)))return e;var u=Ar(e),f=nu(u,Ar(i))+1;return vi(u,0,f).join("")}function Z0(e,i,a){if(e=De(e),e&&(a||i===t))return e.replace(gt,"");if(!e||!(i=fr(i)))return e;var u=Ar(e),f=iu(u,Ar(i));return vi(u,f).join("")}function e_(e,i){var a=te,u=Ee;if(ct(i)){var f="separator"in i?i.separator:f;a="length"in i?ye(i.length):a,u="omission"in i?fr(i.omission):u}e=De(e);var g=e.length;if(Yi(e)){var m=Ar(e);g=m.length}if(a>=g)return e;var w=a-Xi(u);if(w<1)return u;var I=m?vi(m,0,w).join(""):e.slice(0,w);if(f===t)return I+u;if(m&&(w+=I.length-w),Ba(f)){if(e.slice(w).search(f)){var L,F=I;for(f.global||(f=aa(f.source,De(_r.exec(f))+"g")),f.lastIndex=0;L=f.exec(F);)var z=L.index;I=I.slice(0,z===t?w:z)}}else if(e.indexOf(fr(f),w)!=w){var G=I.lastIndexOf(f);G>-1&&(I=I.slice(0,G))}return I+u}function t_(e){return e=De(e),e&&lt.test(e)?e.replace(ci,Ap):e}var r_=on(function(e,i,a){return e+(a?" ":"")+i.toUpperCase()}),Wa=Wu("toUpperCase");function Kh(e,i,a){return e=De(e),i=a?t:i,i===t?Sp(e)?$p(e):yp(e):e.match(i)||[]}var Gh=we(function(e,i){try{return Mt(e,t,i)}catch(a){return Va(a)?a:new ce(a)}}),i_=Xr(function(e,i){return wr(i,function(a){a=Hr(a),Qr(e,a,Ha(e[a],e))}),e});function n_(e){var i=e==null?0:e.length,a=ie();return e=i?nt(e,function(u){if(typeof u[1]!="function")throw new br(l);return[a(u[0]),u[1]]}):[],we(function(u){for(var f=-1;++f<i;){var g=e[f];if(Mt(g[0],this,u))return Mt(g[1],this,u)}})}function s_(e){return Ad(xr(e,D))}function Ja(e){return function(){return e}}function o_(e,i){return e==null||e!==e?i:e}var a_=Qu(),c_=Qu(!0);function ar(e){return e}function Qa(e){return Pu(typeof e=="function"?e:xr(e,D))}function u_(e){return Ru(xr(e,D))}function h_(e,i){return Cu(e,xr(i,D))}var l_=we(function(e,i){return function(a){return Tn(a,e,i)}}),f_=we(function(e,i){return function(a){return Tn(e,a,i)}});function Ya(e,i,a){var u=zt(i),f=Bs(i,u);a==null&&!(ct(i)&&(f.length||!u.length))&&(a=i,i=e,e=this,f=Bs(i,zt(i)));var g=!(ct(a)&&"chain"in a)||!!a.chain,m=ei(e);return wr(f,function(w){var I=i[w];e[w]=I,m&&(e.prototype[w]=function(){var L=this.__chain__;if(g||L){var F=e(this.__wrapped__),z=F.__actions__=nr(this.__actions__);return z.push({func:I,args:arguments,thisArg:e}),F.__chain__=L,F}return I.apply(e,li([this.value()],arguments))})}),e}function p_(){return Pe._===this&&(Pe._=Mp),this}function Xa(){}function d_(e){return e=ye(e),we(function(i){return Au(i,e)})}var g_=Ca(nt),y_=Ca(Yc),v_=Ca(ea);function Wh(e){return Da(e)?ta(Hr(e)):Gd(e)}function __(e){return function(i){return e==null?t:Li(e,i)}}var m_=Xu(),w_=Xu(!0);function Za(){return[]}function ec(){return!1}function b_(){return{}}function E_(){return""}function x_(){return!0}function I_(e,i){if(e=ye(e),e<1||e>J)return[];var a=K,u=Bt(e,K);i=ie(i),e-=K;for(var f=na(u,i);++a<e;)i(a);return f}function S_(e){return fe(e)?nt(e,Hr):pr(e)?[e]:nr(dh(De(e)))}function P_(e){var i=++jp;return De(e)+i}var O_=Ys(function(e,i){return e+i},0),R_=Aa("ceil"),C_=Ys(function(e,i){return e/i},1),A_=Aa("floor");function T_(e){return e&&e.length?Vs(e,ar,ga):t}function N_(e,i){return e&&e.length?Vs(e,ie(i,2),ga):t}function $_(e){return eu(e,ar)}function L_(e,i){return eu(e,ie(i,2))}function F_(e){return e&&e.length?Vs(e,ar,ma):t}function D_(e,i){return e&&e.length?Vs(e,ie(i,2),ma):t}var j_=Ys(function(e,i){return e*i},1),q_=Aa("round"),M_=Ys(function(e,i){return e-i},0);function z_(e){return e&&e.length?ia(e,ar):0}function U_(e,i){return e&&e.length?ia(e,ie(i,2)):0}return d.after=uv,d.ary=Sh,d.assign=Qv,d.assignIn=Mh,d.assignInWith=ho,d.assignWith=Yv,d.at=Xv,d.before=Ph,d.bind=Ha,d.bindAll=i_,d.bindKey=Oh,d.castArray=bv,d.chain=Eh,d.chunk=Ag,d.compact=Tg,d.concat=Ng,d.cond=n_,d.conforms=s_,d.constant=Ja,d.countBy=zy,d.create=Zv,d.curry=Rh,d.curryRight=Ch,d.debounce=Ah,d.defaults=e0,d.defaultsDeep=t0,d.defer=hv,d.delay=lv,d.difference=$g,d.differenceBy=Lg,d.differenceWith=Fg,d.drop=Dg,d.dropRight=jg,d.dropRightWhile=qg,d.dropWhile=Mg,d.fill=zg,d.filter=Hy,d.flatMap=By,d.flatMapDeep=Ky,d.flatMapDepth=Gy,d.flatten=_h,d.flattenDeep=Ug,d.flattenDepth=Hg,d.flip=fv,d.flow=a_,d.flowRight=c_,d.fromPairs=kg,d.functions=c0,d.functionsIn=u0,d.groupBy=Wy,d.initial=Bg,d.intersection=Kg,d.intersectionBy=Gg,d.intersectionWith=Wg,d.invert=l0,d.invertBy=f0,d.invokeMap=Qy,d.iteratee=Qa,d.keyBy=Yy,d.keys=zt,d.keysIn=or,d.map=no,d.mapKeys=d0,d.mapValues=g0,d.matches=u_,d.matchesProperty=h_,d.memoize=oo,d.merge=y0,d.mergeWith=zh,d.method=l_,d.methodOf=f_,d.mixin=Ya,d.negate=ao,d.nthArg=d_,d.omit=v0,d.omitBy=_0,d.once=pv,d.orderBy=Xy,d.over=g_,d.overArgs=dv,d.overEvery=y_,d.overSome=v_,d.partial=ka,d.partialRight=Th,d.partition=Zy,d.pick=m0,d.pickBy=Uh,d.property=Wh,d.propertyOf=__,d.pull=Xg,d.pullAll=wh,d.pullAllBy=Zg,d.pullAllWith=ey,d.pullAt=ty,d.range=m_,d.rangeRight=w_,d.rearg=gv,d.reject=rv,d.remove=ry,d.rest=yv,d.reverse=za,d.sampleSize=nv,d.set=b0,d.setWith=E0,d.shuffle=sv,d.slice=iy,d.sortBy=cv,d.sortedUniq=hy,d.sortedUniqBy=ly,d.split=B0,d.spread=vv,d.tail=fy,d.take=py,d.takeRight=dy,d.takeRightWhile=gy,d.takeWhile=yy,d.tap=Ty,d.throttle=_v,d.thru=io,d.toArray=Dh,d.toPairs=Hh,d.toPairsIn=kh,d.toPath=S_,d.toPlainObject=qh,d.transform=x0,d.unary=mv,d.union=vy,d.unionBy=_y,d.unionWith=my,d.uniq=wy,d.uniqBy=by,d.uniqWith=Ey,d.unset=I0,d.unzip=Ua,d.unzipWith=bh,d.update=S0,d.updateWith=P0,d.values=un,d.valuesIn=O0,d.without=xy,d.words=Kh,d.wrap=wv,d.xor=Iy,d.xorBy=Sy,d.xorWith=Py,d.zip=Oy,d.zipObject=Ry,d.zipObjectDeep=Cy,d.zipWith=Ay,d.entries=Hh,d.entriesIn=kh,d.extend=Mh,d.extendWith=ho,Ya(d,d),d.add=O_,d.attempt=Gh,d.camelCase=T0,d.capitalize=Vh,d.ceil=R_,d.clamp=R0,d.clone=Ev,d.cloneDeep=Iv,d.cloneDeepWith=Sv,d.cloneWith=xv,d.conformsTo=Pv,d.deburr=Bh,d.defaultTo=o_,d.divide=C_,d.endsWith=N0,d.eq=Nr,d.escape=$0,d.escapeRegExp=L0,d.every=Uy,d.find=ky,d.findIndex=yh,d.findKey=r0,d.findLast=Vy,d.findLastIndex=vh,d.findLastKey=i0,d.floor=A_,d.forEach=xh,d.forEachRight=Ih,d.forIn=n0,d.forInRight=s0,d.forOwn=o0,d.forOwnRight=a0,d.get=Ka,d.gt=Ov,d.gte=Rv,d.has=h0,d.hasIn=Ga,d.head=mh,d.identity=ar,d.includes=Jy,d.indexOf=Vg,d.inRange=C0,d.invoke=p0,d.isArguments=ji,d.isArray=fe,d.isArrayBuffer=Cv,d.isArrayLike=sr,d.isArrayLikeObject=bt,d.isBoolean=Av,d.isBuffer=_i,d.isDate=Tv,d.isElement=Nv,d.isEmpty=$v,d.isEqual=Lv,d.isEqualWith=Fv,d.isError=Va,d.isFinite=Dv,d.isFunction=ei,d.isInteger=Nh,d.isLength=co,d.isMap=$h,d.isMatch=jv,d.isMatchWith=qv,d.isNaN=Mv,d.isNative=zv,d.isNil=Hv,d.isNull=Uv,d.isNumber=Lh,d.isObject=ct,d.isObjectLike=vt,d.isPlainObject=jn,d.isRegExp=Ba,d.isSafeInteger=kv,d.isSet=Fh,d.isString=uo,d.isSymbol=pr,d.isTypedArray=cn,d.isUndefined=Vv,d.isWeakMap=Bv,d.isWeakSet=Kv,d.join=Jg,d.kebabCase=F0,d.last=Sr,d.lastIndexOf=Qg,d.lowerCase=D0,d.lowerFirst=j0,d.lt=Gv,d.lte=Wv,d.max=T_,d.maxBy=N_,d.mean=$_,d.meanBy=L_,d.min=F_,d.minBy=D_,d.stubArray=Za,d.stubFalse=ec,d.stubObject=b_,d.stubString=E_,d.stubTrue=x_,d.multiply=j_,d.nth=Yg,d.noConflict=p_,d.noop=Xa,d.now=so,d.pad=q0,d.padEnd=M0,d.padStart=z0,d.parseInt=U0,d.random=A0,d.reduce=ev,d.reduceRight=tv,d.repeat=H0,d.replace=k0,d.result=w0,d.round=q_,d.runInContext=x,d.sample=iv,d.size=ov,d.snakeCase=V0,d.some=av,d.sortedIndex=ny,d.sortedIndexBy=sy,d.sortedIndexOf=oy,d.sortedLastIndex=ay,d.sortedLastIndexBy=cy,d.sortedLastIndexOf=uy,d.startCase=K0,d.startsWith=G0,d.subtract=M_,d.sum=z_,d.sumBy=U_,d.template=W0,d.times=I_,d.toFinite=ti,d.toInteger=ye,d.toLength=jh,d.toLower=J0,d.toNumber=Pr,d.toSafeInteger=Jv,d.toString=De,d.toUpper=Q0,d.trim=Y0,d.trimEnd=X0,d.trimStart=Z0,d.truncate=e_,d.unescape=t_,d.uniqueId=P_,d.upperCase=r_,d.upperFirst=Wa,d.each=xh,d.eachRight=Ih,d.first=mh,Ya(d,function(){var e={};return zr(d,function(i,a){qe.call(d.prototype,a)||(e[a]=i)}),e}(),{chain:!1}),d.VERSION=n,wr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){d[e].placeholder=d}),wr(["drop","take"],function(e,i){Se.prototype[e]=function(a){a=a===t?1:jt(ye(a),0);var u=this.__filtered__&&!i?new Se(this):this.clone();return u.__filtered__?u.__takeCount__=Bt(a,u.__takeCount__):u.__views__.push({size:Bt(a,K),type:e+(u.__dir__<0?"Right":"")}),u},Se.prototype[e+"Right"]=function(a){return this.reverse()[e](a).reverse()}}),wr(["filter","map","takeWhile"],function(e,i){var a=i+1,u=a==C||a==Me;Se.prototype[e]=function(f){var g=this.clone();return g.__iteratees__.push({iteratee:ie(f,3),type:a}),g.__filtered__=g.__filtered__||u,g}}),wr(["head","last"],function(e,i){var a="take"+(i?"Right":"");Se.prototype[e]=function(){return this[a](1).value()[0]}}),wr(["initial","tail"],function(e,i){var a="drop"+(i?"":"Right");Se.prototype[e]=function(){return this.__filtered__?new Se(this):this[a](1)}}),Se.prototype.compact=function(){return this.filter(ar)},Se.prototype.find=function(e){return this.filter(e).head()},Se.prototype.findLast=function(e){return this.reverse().find(e)},Se.prototype.invokeMap=we(function(e,i){return typeof e=="function"?new Se(this):this.map(function(a){return Tn(a,e,i)})}),Se.prototype.reject=function(e){return this.filter(ao(ie(e)))},Se.prototype.slice=function(e,i){e=ye(e);var a=this;return a.__filtered__&&(e>0||i<0)?new Se(a):(e<0?a=a.takeRight(-e):e&&(a=a.drop(e)),i!==t&&(i=ye(i),a=i<0?a.dropRight(-i):a.take(i-e)),a)},Se.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Se.prototype.toArray=function(){return this.take(K)},zr(Se.prototype,function(e,i){var a=/^(?:filter|find|map|reject)|While$/.test(i),u=/^(?:head|last)$/.test(i),f=d[u?"take"+(i=="last"?"Right":""):i],g=u||/^find/.test(i);f&&(d.prototype[i]=function(){var m=this.__wrapped__,w=u?[1]:arguments,I=m instanceof Se,L=w[0],F=I||fe(m),z=function(xe){var Oe=f.apply(d,li([xe],w));return u&&G?Oe[0]:Oe};F&&a&&typeof L=="function"&&L.length!=1&&(I=F=!1);var G=this.__chain__,ee=!!this.__actions__.length,ne=g&&!G,_e=I&&!ee;if(!g&&F){m=_e?m:new Se(this);var se=e.apply(m,w);return se.__actions__.push({func:io,args:[z],thisArg:t}),new Er(se,G)}return ne&&_e?e.apply(this,w):(se=this.thru(z),ne?u?se.value()[0]:se.value():se)})}),wr(["pop","push","shift","sort","splice","unshift"],function(e){var i=Cs[e],a=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);d.prototype[e]=function(){var f=arguments;if(u&&!this.__chain__){var g=this.value();return i.apply(fe(g)?g:[],f)}return this[a](function(m){return i.apply(fe(m)?m:[],f)})}}),zr(Se.prototype,function(e,i){var a=d[i];if(a){var u=a.name+"";qe.call(rn,u)||(rn[u]=[]),rn[u].push({name:i,func:a})}}),rn[Qs(t,be).name]=[{name:"wrapper",func:t}],Se.prototype.clone=td,Se.prototype.reverse=rd,Se.prototype.value=id,d.prototype.at=Ny,d.prototype.chain=$y,d.prototype.commit=Ly,d.prototype.next=Fy,d.prototype.plant=jy,d.prototype.reverse=qy,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=My,d.prototype.first=d.prototype.head,In&&(d.prototype[In]=Dy),d},Zi=Lp();wt?((wt.exports=Zi)._=Zi,Ge._=Zi):Pe._=Zi}).call(Gn)})($c,$c.exports);var yI=Object.defineProperty,vI=Object.defineProperties,_I=Object.getOwnPropertyDescriptors,Zl=Object.getOwnPropertySymbols,mI=Object.prototype.hasOwnProperty,wI=Object.prototype.propertyIsEnumerable,ef=(o,r,t)=>r in o?yI(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,po=(o,r)=>{for(var t in r||(r={}))mI.call(r,t)&&ef(o,t,r[t]);if(Zl)for(var t of Zl(r))wI.call(r,t)&&ef(o,t,r[t]);return o},bI=(o,r)=>vI(o,_I(r));function _n(o,r,t){var n;const s=O1(o);return((n=r.rpcMap)==null?void 0:n[s.reference])||`${gI}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function Hi(o){return o.includes(":")?o.split(":")[1]:o}function up(o){return o.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function EI(o,r){const t=Object.keys(r.namespaces).filter(s=>s.includes(o));if(!t.length)return[];const n=[];return t.forEach(s=>{const c=r.namespaces[s].accounts;n.push(...c)}),n}function xI(o={},r={}){const t=tf(o),n=tf(r);return $c.exports.merge(t,n)}function tf(o){var r,t,n,s;const c={};if(!vo(o))return c;for(const[l,p]of Object.entries(o)){const _=gf(l)?[l]:p.chains,y=p.methods||[],S=p.events||[],D=p.rpcMap||{},O=Wn(l);c[O]=bI(po(po({},c[O]),p),{chains:rc(_,(r=c[O])==null?void 0:r.chains),methods:rc(y,(t=c[O])==null?void 0:t.methods),events:rc(S,(n=c[O])==null?void 0:n.events),rpcMap:po(po({},D),(s=c[O])==null?void 0:s.rpcMap)})}return c}function II(o){return o.includes(":")?o.split(":")[2]:o}function SI(o){const r={};for(const[t,n]of Object.entries(o)){const s=n.methods||[],c=n.events||[],l=n.accounts||[],p=gf(t)?[t]:n.chains?n.chains:up(n.accounts);r[t]={chains:p,methods:s,events:c,accounts:l}}return r}function pc(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const hp={},xt=o=>hp[o],dc=(o,r)=>{hp[o]=r};class PI{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(xi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var n;const s=Hi(t);r[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProvider(r,t){const n=t||_n(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Ei(new Ui(n,xt("disableProviderPing")))}}class OI{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=xt("events"),this.client=xt("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(parseInt(r),t),this.chainId=parseInt(r),this.events.emit(xi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,t){const n=t||_n(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Ei(new Ui(n,xt("disableProviderPing")))}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var n;const s=parseInt(Hi(t));r[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[t])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}async handleSwitchChain(r){var t,n;let s=r.request.params?(t=r.request.params[0])==null?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const c=parseInt(s,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:s}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class RI{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(xi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var n;const s=Hi(t);r[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProvider(r,t){const n=t||_n(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Ei(new Ui(n,xt("disableProviderPing")))}}class CI{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(xi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var n;const s=Hi(t);r[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProvider(r,t){const n=t||_n(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Ei(new Ui(n,xt("disableProviderPing")))}}class AI{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(xi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{const n=this.getCardanoRPCUrl(t),s=Hi(t);r[s]=this.createHttpProvider(s,n)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}getCardanoRPCUrl(r){const t=this.namespace.rpcMap;if(t)return t[r]}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProvider(r,t){const n=t||this.getCardanoRPCUrl(r);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Ei(new Ui(n,xt("disableProviderPing")))}}class TI{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(xi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var n;const s=Hi(t);r[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProvider(r,t){const n=t||_n(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Ei(new Ui(n,xt("disableProviderPing")))}}class NI{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,t){this.httpProviders[r]||this.setHttpProvider(r,t),this.chainId=r,this.events.emit(xi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(t=>{var n;const s=Hi(t);r[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[t])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,t=this.httpProviders[r];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return t}setHttpProvider(r,t){const n=this.createHttpProvider(r,t);n&&(this.httpProviders[r]=n)}createHttpProvider(r,t){const n=t||_n(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Ei(new Ui(n,xt("disableProviderPing")))}}var $I=Object.defineProperty,LI=Object.defineProperties,FI=Object.getOwnPropertyDescriptors,rf=Object.getOwnPropertySymbols,DI=Object.prototype.hasOwnProperty,jI=Object.prototype.propertyIsEnumerable,nf=(o,r,t)=>r in o?$I(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,go=(o,r)=>{for(var t in r||(r={}))DI.call(r,t)&&nf(o,t,r[t]);if(rf)for(var t of rf(r))jI.call(r,t)&&nf(o,t,r[t]);return o},gc=(o,r)=>LI(o,FI(r));class Jc{constructor(r){this.events=new Mc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Re.pino(Re.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||Yl})),this.disableProviderPing=(r==null?void 0:r.disableProviderPing)||!1}static async init(r){const t=new Jc(r);return await t.initialize(),t}async request(r,t){const[n,s]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:go({},r),chainId:`${n}:${s}`,topic:this.session.topic})}sendAsync(r,t,n){this.request(r,n).then(s=>t(null,s)).catch(s=>t(s,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:tr("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}on(r,t){this.events.on(r,t)}once(r,t){this.events.once(r,t)}removeListener(r,t){this.events.removeListener(r,t)}off(r,t){this.events.off(r,t)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:s}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await s().then(c=>{this.session=c,this.namespaces||(this.namespaces=SI(c.namespaces),this.persist("namespaces",this.namespaces))}).catch(c=>{if(c.message!==ap)throw c;t++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,t){try{if(!this.session)return;const[n,s]=this.validateChain(r);this.getProvider(n).setDefaultChain(s,t)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(yn(t)){for(const n of t)r.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await cI.init({logger:this.providerOpts.logger||Yl,relayUrl:this.providerOpts.relayUrl||fI,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(t=>Wn(t)))];dc("client",this.client),dc("events",this.events),dc("disableProviderPing",this.disableProviderPing),r.forEach(t=>{if(!this.session)return;const n=EI(t,this.session),s=up(n),c=xI(this.namespaces,this.optionalNamespaces),l=gc(go({},c[t]),{accounts:n,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new OI({namespace:l});break;case"solana":this.rpcProviders[t]=new RI({namespace:l});break;case"cosmos":this.rpcProviders[t]=new CI({namespace:l});break;case"polkadot":this.rpcProviders[t]=new PI({namespace:l});break;case"cip34":this.rpcProviders[t]=new AI({namespace:l});break;case"elrond":this.rpcProviders[t]=new TI({namespace:l});break;case"multiversx":this.rpcProviders[t]=new NI({namespace:l});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:t}=r,{event:n}=t;if(n.name==="accountsChanged"){const s=n.data;s&&yn(s)&&this.events.emit("accountsChanged",s.map(II))}else if(n.name==="chainChanged"){const s=t.chainId,c=t.event.data,l=Wn(s),p=pc(s)!==pc(c)?`${l}:${pc(c)}`:s;this.onChainChanged(p)}else this.events.emit(n.name,n.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:t})=>{var n;const{namespaces:s}=t,c=(n=this.client)==null?void 0:n.session.get(r);this.session=gc(go({},c),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:t})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",gc(go({},tr("USER_DISCONNECTED")),{data:r.topic}))}),this.on(xi.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var t;this.getProvider(r).updateNamespace((t=this.session)==null?void 0:t.namespaces[r])})}setNamespaces(r){const{namespaces:t,optionalNamespaces:n,sessionProperties:s}=r;t&&Object.keys(t).length&&(this.namespaces=t),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=s,this.persist("namespaces",t),this.persist("optionalNamespaces",n)}validateChain(r){const[t,n]=(r==null?void 0:r.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,n];if(t&&!Object.keys(this.namespaces||{}).map(l=>Wn(l)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&n)return[t,n];const s=Wn(Object.keys(this.namespaces)[0]),c=this.rpcProviders[s].getDefaultChain();return[s,c]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,t=!1){var n;if(!this.namespaces)return;const[s,c]=this.validateChain(r);t||this.getProvider(s).setDefaultChain(c),((n=this.namespaces[s])!=null?n:this.namespaces[`${s}:${c}`]).defaultChain=c,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",c)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,t){this.client.core.storage.setItem(`${Xl}/${r}`,t)}async getFromStore(r){return await this.client.core.storage.getItem(`${Xl}/${r}`)}}const qI=Jc,MI="wc",zI="ethereum_provider",UI=`${MI}@2:${zI}:`,HI="https://rpc.walletconnect.com/v1/",Lc=["eth_sendTransaction","personal_sign"],kI=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Fc=["chainChanged","accountsChanged"],VI=["chainChanged","accountsChanged","message","disconnect","connect"];var BI=Object.defineProperty,KI=Object.defineProperties,GI=Object.getOwnPropertyDescriptors,sf=Object.getOwnPropertySymbols,WI=Object.prototype.hasOwnProperty,JI=Object.prototype.propertyIsEnumerable,of=(o,r,t)=>r in o?BI(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,Qn=(o,r)=>{for(var t in r||(r={}))WI.call(r,t)&&of(o,t,r[t]);if(sf)for(var t of sf(r))JI.call(r,t)&&of(o,t,r[t]);return o},af=(o,r)=>KI(o,GI(r));function Eo(o){return Number(o[0].split(":")[1])}function yc(o){return`0x${o.toString(16)}`}function QI(o){const{chains:r,optionalChains:t,methods:n,optionalMethods:s,events:c,optionalEvents:l,rpcMap:p}=o;if(!yn(r))throw new Error("Invalid chains");const _={chains:r,methods:n||Lc,events:c||Fc,rpcMap:Qn({},r.length?{[Eo(r)]:p[Eo(r)]}:{})},y=c==null?void 0:c.filter(M=>!Fc.includes(M)),S=n==null?void 0:n.filter(M=>!Lc.includes(M));if(!t&&!l&&!s&&!(y!=null&&y.length)&&!(S!=null&&S.length))return{required:r.length?_:void 0};const D=(y==null?void 0:y.length)&&(S==null?void 0:S.length)||!t,O={chains:[...new Set(D?_.chains.concat(t||[]):t)],methods:[...new Set(_.methods.concat(s!=null&&s.length?s:kI))],events:[...new Set(_.events.concat(l!=null&&l.length?l:VI))],rpcMap:p};return{required:r.length?_:void 0,optional:t.length?O:void 0}}class Qc{constructor(){this.events=new vr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=UI,this.on=(r,t)=>(this.events.on(r,t),this),this.once=(r,t)=>(this.events.once(r,t),this),this.removeListener=(r,t)=>(this.events.removeListener(r,t),this),this.off=(r,t)=>(this.events.off(r,t),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const t=new Qc;return await t.initialize(r),t}async request(r){return await this.signer.request(r,this.formatChainId(this.chainId))}sendAsync(r,t){this.signer.sendAsync(r,t,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:t,optional:n}=QI(this.rpc);try{const s=await new Promise(async(l,p)=>{var _;this.rpc.showQrModal&&((_=this.modal)==null||_.subscribeModal(y=>{!y.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),p(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(af(Qn({namespaces:Qn({},t&&{[this.namespace]:t})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:r==null?void 0:r.pairingTopic})).then(y=>{l(y)}).catch(y=>{p(new Error(y.message))})});if(!s)return;const c=R1(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:yc(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:t}=r,{event:n}=t;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const t=parseInt(r);this.chainId=t,this.events.emit("chainChanged",yc(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",af(Qn({},tr("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var t,n;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(n=this.modal)==null||n.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const t=r.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",yc(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const t=this.parseChainId(r);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(r){const[t,n,s]=r.split(":");return{chainId:`${t}:${n}`,address:s}}setAccounts(r){this.accounts=r.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var t,n;const s=(t=r==null?void 0:r.chains)!=null?t:[],c=(n=r==null?void 0:r.optionalChains)!=null?n:[],l=s.concat(c);if(!l.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const p=s.length?(r==null?void 0:r.methods)||Lc:[],_=s.length?(r==null?void 0:r.events)||Fc:[],y=(r==null?void 0:r.optionalMethods)||[],S=(r==null?void 0:r.optionalEvents)||[],D=(r==null?void 0:r.rpcMap)||this.buildRpcMap(l,r.projectId),O=(r==null?void 0:r.qrModalOptions)||void 0;return{chains:s==null?void 0:s.map(M=>this.formatChainId(M)),optionalChains:c.map(M=>this.formatChainId(M)),methods:p,events:_,optionalMethods:y,optionalEvents:S,rpcMap:D,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:O,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,t){const n={};return r.forEach(s=>{n[s]=this.getRpcUrl(s,t)}),n}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?Eo(this.rpc.chains):Eo(this.rpc.optionalChains),this.signer=await qI.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const{WalletConnectModal:n}=await C1(()=>import("./index-49a2181a.js").then(s=>s.i),["assets/index-49a2181a.js","assets/index-d1400642.js","assets/index-0da8f254.css"]);t=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(t)try{this.modal=new t(Qn({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:t,optionalChains:n,rpcMap:s}=r;t&&yn(t)&&(this.rpc.chains=t.map(c=>this.formatChainId(c)),t.forEach(c=>{this.rpc.rpcMap[c]=(s==null?void 0:s[c])||this.getRpcUrl(c)})),n&&yn(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(c=>this.formatChainId(c)),n.forEach(c=>{this.rpc.rpcMap[c]=(s==null?void 0:s[c])||this.getRpcUrl(c)}))}getRpcUrl(r,t){var n;return((n=this.rpc.rpcMap)==null?void 0:n[r])||`${HI}?chainId=eip155:${r}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:t==null?void 0:t.accounts),this.setAccounts(t==null?void 0:t.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(t=>this.parseAccount(t))}}const oS=Qc;export{oS as EthereumProvider,VI as OPTIONAL_EVENTS,kI as OPTIONAL_METHODS,Fc as REQUIRED_EVENTS,Lc as REQUIRED_METHODS,Qc as default};
